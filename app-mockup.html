<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Totem — App Prototype</title>
<style>

/* ════════════════════════════════════════════════════════
   DESIGN TOKENS — THEME SYSTEM
   Change theme by adding a class to <html>:
   (none)      → Midnight Blue  (default)
   .t-oled     → OLED Black
   .t-light    → Light
   ════════════════════════════════════════════════════════ */

:root {
    /* Surfaces */
    --bg:    #060B18;
    --card:  #0E1525;
    --card2: #152030;
    --border: rgba(255,255,255,0.07);

    /* Brand */
    --brand:       #8B7EFF;
    --brand-light: rgba(139,126,255,0.12);

    /* Semantic */
    --teal:        #4ECDC4;
    --teal-light:  rgba(78,205,196,0.12);
    --amber:       #F7C84B;
    --amber-light: rgba(247,200,75,0.12);
    --red:         #FF6B6B;
    --red-light:   rgba(255,107,107,0.12);
    --green:       #51CF66;
    --green-light: rgba(81,207,102,0.12);

    /* Text */
    --text:  #F0F4FF;
    --text2: #8B95B0;
    --text3: #304060;

    /* Gradients (parameterised for theming) */
    --hero-start:  #130E36;
    --sub-start:   #0d1a26;
    --body-bg:     #030710;

    /* Chrome */
    --nav-bg:      rgba(6,11,24,0.94);
    --status-fill: rgba(240,244,255,0.9);

    --avg-line: rgba(255,255,255,0.5);
}

.t-oled {
    --bg:    #000000;
    --card:  #0C0C12;
    --card2: #121218;
    --border: rgba(255,255,255,0.06);
    --text3: #2E3450;
    --hero-start: #100A30;
    --body-bg: #000000;
    --nav-bg: rgba(0,0,0,0.96);
    --status-fill: rgba(240,244,255,0.9);
    --avg-line: rgba(255,255,255,0.5);
}

.t-light {
    --bg:    #F0F2F8;
    --card:  #FFFFFF;
    --card2: #F5F7FC;
    --border: rgba(0,0,0,0.08);

    --brand:       #6B5FF0;
    --brand-light: rgba(107,95,240,0.10);

    --teal:        #1EA99F;
    --teal-light:  rgba(30,169,159,0.10);
    --amber:       #B87A00;
    --amber-light: rgba(184,122,0,0.10);
    --red:         #D93025;
    --red-light:   rgba(217,48,37,0.10);
    --green:       #1E8C35;
    --green-light: rgba(30,140,53,0.10);

    --text:  #0D1017;
    --text2: #525C78;
    --text3: #B0BAD0;

    --hero-start:  #EAE7FF;
    --sub-start:   #E0F5F4;
    --body-bg:     #E4E8F2;

    --nav-bg:      rgba(255,255,255,0.94);
    --status-fill: rgba(13,16,23,0.8);
    --avg-line: rgba(0,0,0,0.35);
}

/* ════════════════════════════════════════════════════════
   PAGE SHELL
   ════════════════════════════════════════════════════════ */

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    background: var(--body-bg);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 32px 24px 60px;
    transition: background 0.4s;
}

.page-wrapper {
    display: flex;
    gap: 40px;
    align-items: flex-start;
    max-width: 1100px;
    width: 100%;
}

/* ── Sidebar ── */
.sidebar {
    flex: 1;
    max-width: 280px;
    position: sticky;
    top: 32px;
}

.sidebar-logo {
    font-size: 18px;
    font-weight: 800;
    color: var(--text);
    letter-spacing: -0.5px;
    margin-bottom: 3px;
}
.sidebar-logo span { color: var(--brand); }

.sidebar-tagline {
    font-size: 11px;
    color: var(--text2);
    margin-bottom: 24px;
    line-height: 1.5;
}

/* Screen nav */
.sb-section-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 8px;
}

.sb-nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    border-radius: 10px;
    cursor: pointer;
    margin-bottom: 4px;
    transition: background 0.15s;
    border: 1px solid transparent;
}
.sb-nav-item:hover { background: var(--card); }
.sb-nav-item.active {
    background: var(--brand-light);
    border-color: rgba(124,110,250,0.2);
}
.sb-nav-icon { width: 18px; height: 18px; }
.sb-nav-icon svg { width: 18px; height: 18px; }
.sb-nav-item.active .sb-nav-icon svg { fill: var(--brand); }
.sb-nav-item:not(.active) .sb-nav-icon svg { fill: var(--text3); }
.sb-nav-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text2);
}
.sb-nav-item.active .sb-nav-label { color: var(--brand); }

.sb-divider {
    height: 1px;
    background: var(--border);
    margin: 16px 0;
}

/* Theme switcher */
.theme-grid {
    display: flex;
    gap: 8px;
    margin-bottom: 0;
}
.theme-btn {
    flex: 1;
    padding: 8px 6px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--card);
    cursor: pointer;
    font-family: inherit;
    transition: border-color 0.15s, background 0.15s;
    text-align: center;
}
.theme-btn:hover, .theme-btn.active {
    border-color: var(--brand);
    background: var(--brand-light);
}
.theme-swatch {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin: 0 auto 4px;
}
.theme-btn-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.theme-btn.active .theme-btn-label { color: var(--brand); }

/* Notes */
.notes-head {
    font-size: 10px;
    font-weight: 700;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin: 16px 0 10px;
}

.note-item {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
}
.note-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--brand);
    flex-shrink: 0;
    margin-top: 5px;
}
.note-item p {
    font-size: 11px;
    color: var(--text2);
    line-height: 1.6;
}

.note-set { display: none; }
.note-set.active { display: block; }

/* ── Phone column ── */
.phone-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
}

/* ── Phone frame ── */
.phone-outer {
    width: 390px;
    background: #181830;
    border-radius: 54px;
    padding: 14px;
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.1),
        0 40px 100px rgba(0,0,0,0.9),
        inset 0 0 0 1px rgba(255,255,255,0.04);
}

.phone-screen {
    background: var(--bg);
    border-radius: 44px;
    overflow: hidden;
    height: 844px;
    position: relative;
    display: flex;
    flex-direction: column;
    transition: background 0.4s;
}

.dynamic-island {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 34px;
    background: #000;
    border-radius: 20px;
    z-index: 30;
    pointer-events: none;
}

/* Status bar */
.status-bar {
    height: 54px;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    padding: 0 28px 8px;
    flex-shrink: 0;
    position: relative;
    z-index: 5;
}
.status-time { font-size: 15px; font-weight: 600; color: var(--text); }
.status-icons { display: flex; gap: 5px; align-items: center; }
.status-icons svg { fill: var(--status-fill); transition: fill 0.4s; }

/* ════════════════════════════════════════════════════════
   APP SCREEN SYSTEM
   Each screen is position:absolute filling the space above the nav.
   Active screen is visible; others are hidden.
   ════════════════════════════════════════════════════════ */

.app-screen {
    position: absolute;
    top: 54px;   /* below status bar */
    left: 0;
    right: 0;
    bottom: 82px; /* above bottom nav */
    display: flex;
    flex-direction: column;
    opacity: 0;
    pointer-events: none;
    transform: translateX(30px);
    transition: opacity 0.25s ease, transform 0.25s ease;
    overflow: hidden;
}

.app-screen.active {
    opacity: 1;
    pointer-events: all;
    transform: translateX(0);
}

.app-screen.exit-left {
    opacity: 0;
    transform: translateX(-30px);
}

/* ════════════════════════════════════════════════════════
   BOTTOM NAV (persistent — sits outside .app-screen)
   ════════════════════════════════════════════════════════ */

.bottom-nav {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 82px;
    background: var(--nav-bg);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    justify-content: space-around;
    padding: 12px 0 0;
    z-index: 20;
    transition: background 0.4s, border-color 0.4s;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    padding: 2px 10px;
    min-width: 44px;
}
.nav-icon { width: 22px; height: 22px; }
.nav-icon svg { width: 22px; height: 22px; }
.nav-label { font-size: 10px; font-weight: 500; }
.nav-item.active .nav-label { color: var(--brand); font-weight: 700; }
.nav-item.active .nav-icon svg { fill: var(--brand); }
.nav-item:not(.active) .nav-label { color: var(--text3); }
.nav-item:not(.active) .nav-icon svg { fill: var(--text3); }

/* ════════════════════════════════════════════════════════
   FLOATING AI CHAT BUTTON (FAB)
   ════════════════════════════════════════════════════════ */

.fab {
    position: absolute;
    bottom: 96px;
    right: 20px;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    background: var(--brand);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 4px 20px rgba(124,110,250,0.5);
    cursor: pointer;
    z-index: 25;
    border: none;
    font-family: inherit;
    transition: transform 0.15s, box-shadow 0.15s, background 0.4s;
    animation: fabIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) 0.6s both;
}
.fab:hover { transform: scale(1.06); box-shadow: 0 6px 28px rgba(124,110,250,0.65); }
.fab-dot {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--amber);
    border: 2px solid var(--bg);
}

@keyframes fabIn {
    from { transform: scale(0.6); opacity: 0; }
    to   { transform: scale(1);   opacity: 1; }
}

/* ════════════════════════════════════════════════════════
   SHARED COMPONENT STYLES
   ════════════════════════════════════════════════════════ */

.section-hd {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 14px 0 8px;
}
.section-title {
    font-size: 11px;
    font-weight: 700;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.8px;
}
.section-link {
    font-size: 11px;
    font-weight: 600;
    color: var(--brand);
    cursor: pointer;
}

/* Badges */
.badge {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 2px 7px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 700;
}
.badge-green  { background: var(--green-light);  color: var(--green); }
.badge-amber  { background: var(--amber-light);  color: var(--amber); }
.badge-red    { background: var(--red-light);    color: var(--red);   }
.badge-brand  { background: var(--brand-light);  color: var(--brand); }
.badge-muted  { background: rgba(255,255,255,0.06); color: var(--text3); }

/* Progress bars */
.progress-track {
    background: rgba(255,255,255,0.08);
    border-radius: 4px;
    height: 6px;
    overflow: hidden;
    position: relative;
}
.progress-track.overflow-visible { overflow: visible; }
.progress-fill {
    height: 100%;
    border-radius: 4px;
}
.fill-brand { background: linear-gradient(90deg, var(--brand), #9C8FFF); }
.fill-green { background: var(--green); }
.fill-amber { background: var(--amber); }
.fill-red   { background: var(--red); }
.fill-teal  { background: linear-gradient(90deg, var(--teal), #6EDCD5); }

/* Period marker tick */
.period-marker {
    position: absolute;
    top: -3px;
    width: 2px;
    height: 12px;
    background: rgba(255,255,255,0.3);
    border-radius: 1px;
    z-index: 2;
}

/* List card */
.list-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    transition: background 0.4s, border-color 0.4s;
}
.list-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
}
.list-item:last-child { border-bottom: none; }
.list-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
}
.list-info { flex: 1; }
.list-name { font-size: 14px; font-weight: 600; color: var(--text); }
.list-sub  { font-size: 11px; color: var(--text2); margin-top: 1px; }
.list-right { text-align: right; }
.list-amount  { font-size: 14px; font-weight: 700; color: var(--text); }
.list-urgency { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }

/* Metric cards */
.metric-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 14px 16px;
    transition: background 0.4s, border-color 0.4s;
}
.metric-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.7px;
    margin-bottom: 5px;
}
.metric-value {
    font-size: 22px;
    font-weight: 800;
    color: var(--text);
    letter-spacing: -0.8px;
    margin-bottom: 4px;
}
.metric-sub { font-size: 11px; color: var(--text2); }

/* ════════════════════════════════════════════════════════
   SCREEN 1: HOME — DASHBOARD
   ════════════════════════════════════════════════════════ */

/* Tier bar */
.tier-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 20px 4px;
    flex-shrink: 0;
}
.tier-badge-pill {
    font-size: 10px;
    font-weight: 700;
    color: var(--brand);
    background: var(--brand-light);
    padding: 3px 10px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    transition: background 0.4s, color 0.4s;
}
.tier-dots { display: flex; gap: 5px; align-items: center; }
.tdot {
    height: 4px;
    border-radius: 2px;
    background: var(--text3);
    cursor: pointer;
    transition: all 0.3s;
}
.tdot.active { background: var(--brand); width: 18px; }
.tdot:not(.active) { width: 5px; }

/* Tier slider */
.screen-content {
    flex: 1;
    overflow: hidden;
    position: relative;
}
.tier-slider {
    display: flex;
    width: 300%;
    height: 100%;
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
.tier-panel {
    width: 33.333%;
    height: 100%;
    overflow-y: auto;
    padding: 4px 20px 16px;
    scrollbar-width: none;
}
.tier-panel::-webkit-scrollbar { display: none; }

/* Dashboard header */
.dash-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 10px 0 12px;
}
.greeting      { font-size: 21px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; }
.greeting-date { font-size: 12px; color: var(--text2); margin-top: 2px; }
.avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--brand), #9C8FFF);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 700;
    color: #fff;
}

/* Payday pill */
.payday-pill {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 8px 16px;
    margin-bottom: 14px;
    transition: background 0.4s, border-color 0.4s;
}
.pay-dot  { width: 7px; height: 7px; border-radius: 50%; background: var(--amber); flex-shrink: 0; }
.pay-text { font-size: 13px; color: var(--text2); flex: 1; }
.pay-text strong { color: var(--amber); }
.pay-cycle { font-size: 11px; color: var(--text3); white-space: nowrap; }

/* Safe to Spend hero */
.hero-card {
    background: linear-gradient(135deg, var(--hero-start) 0%, var(--card) 65%);
    border: 1px solid rgba(124,110,250,0.3);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 12px;
    position: relative;
    overflow: hidden;
    transition: background 0.4s, border-color 0.4s;
}
.hero-card::before {
    content: '';
    position: absolute;
    top: -50px; right: -50px;
    width: 180px; height: 180px;
    background: radial-gradient(circle, rgba(124,110,250,0.18) 0%, transparent 70%);
    pointer-events: none;
}
.hero-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--brand);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 4px;
}
.hero-amount {
    font-size: 48px;
    font-weight: 800;
    color: var(--text);
    letter-spacing: -2.5px;
    line-height: 1;
    margin-bottom: 3px;
}
.hero-amount .dollar {
    font-size: 24px;
    font-weight: 600;
    color: var(--text2);
    vertical-align: top;
    margin-top: 10px;
    display: inline-block;
}
.hero-sub { font-size: 12px; color: var(--text2); margin-bottom: 14px; }
.progress-labels { display: flex; justify-content: space-between; }
.progress-labels span { font-size: 10px; color: var(--text3); }

/* Two-col grid */
.two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

/* AI Insight card */
.insight-card {
    background: var(--card);
    border: 1px solid rgba(247,200,75,0.25);
    border-radius: 16px;
    padding: 14px 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
    transition: background 0.4s;
}
.insight-icon {
    width: 36px; height: 36px;
    border-radius: 10px;
    background: var(--amber-light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 17px;
    flex-shrink: 0;
}
.insight-tag {
    font-size: 10px;
    font-weight: 700;
    color: var(--amber);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 4px;
}
.insight-text { font-size: 13px; color: var(--text); line-height: 1.5; font-weight: 500; }
.insight-cta  { font-size: 12px; font-weight: 600; color: var(--brand); margin-top: 6px; cursor: pointer; }

/* Tier 2 */
.tier-heading { font-size: 20px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; padding-top: 10px; margin-bottom: 2px; }
.tier-sub     { font-size: 12px; color: var(--text2); margin-bottom: 4px; }

/* Burn rate */
.burn-item { padding: 13px 16px; border-bottom: 1px solid var(--border); }
.burn-item:last-child { border-bottom: none; }
.burn-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.burn-cat { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text); }
.burn-right { text-align: right; }
.burn-spent  { font-size: 14px; font-weight: 700; color: var(--text); }
.burn-budget { font-size: 10px; color: var(--text2); }
.burn-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: 6px; }
.burn-pct    { font-size: 10px; color: var(--text3); }
.progress-wrap { position: relative; }

/* Subscription card */
.sub-card {
    background: linear-gradient(135deg, var(--sub-start) 0%, var(--card) 100%);
    border: 1px solid rgba(78,205,196,0.2);
    border-radius: 16px;
    padding: 18px;
    transition: background 0.4s;
}
.sub-top  { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; }
.sub-head-label { font-size: 10px; font-weight: 700; color: var(--teal); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
.sub-count { font-size: 30px; font-weight: 800; color: var(--text); letter-spacing: -1px; }
.sub-count span { font-size: 14px; font-weight: 500; color: var(--text2); letter-spacing: 0; }
.sub-grid  { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.sub-metric { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px 12px; }
.sub-metric-label { font-size: 10px; color: var(--text2); margin-bottom: 3px; }
.sub-metric-value { font-size: 19px; font-weight: 700; letter-spacing: -0.5px; }

/* Health cards */
.health-pair { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.health-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; transition: background 0.4s, border-color 0.4s; }
.health-icon  { font-size: 20px; margin-bottom: 8px; }
.health-label { font-size: 10px; font-weight: 700; color: var(--text2); text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 4px; }
.health-value { font-size: 28px; font-weight: 800; color: var(--text); letter-spacing: -1px; line-height: 1; }
.health-unit  { font-size: 11px; color: var(--text2); margin-top: 3px; }

/* Lifestyle creep */
.creep-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 18px; transition: background 0.4s, border-color 0.4s; }
.creep-top  { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; }
.creep-building-label { font-size: 10px; font-weight: 700; color: var(--brand); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
.creep-status { font-size: 15px; font-weight: 700; color: var(--text); }
.creep-desc   { font-size: 12px; color: var(--text2); line-height: 1.6; margin-top: 10px; }
.creep-desc strong { color: var(--brand); }

/* Category % */
.cat-item  { display: flex; align-items: center; gap: 10px; padding: 11px 16px; border-bottom: 1px solid var(--border); }
.cat-item:last-child { border-bottom: none; }
.cat-emoji { font-size: 14px; width: 20px; text-align: center; }
.cat-name  { font-size: 13px; font-weight: 500; color: var(--text); flex: 1; }
.cat-bar   { width: 80px; position: relative; }
.cat-track { height: 4px; background: rgba(255,255,255,0.08); border-radius: 2px; overflow: hidden; }
.cat-fill  { height: 100%; border-radius: 2px; }
.cat-pct   { font-size: 12px; font-weight: 700; color: var(--text); width: 30px; text-align: right; }
.cat-avg-line { position: absolute; top: -4px; bottom: -4px; width: 2px; background: var(--avg-line); border-radius: 1px; z-index: 2; pointer-events: none; }

/* Mini bar chart */
.mini-chart { display: flex; gap: 8px; align-items: flex-end; height: 48px; margin-top: 12px; }
.mini-bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; height: 100%; justify-content: flex-end; }
.mini-bar  { width: 100%; border-radius: 4px 4px 0 0; }
.mini-label { font-size: 10px; color: var(--text2); }
.mini-label.active { color: var(--brand); }

/* ════════════════════════════════════════════════════════
   SCREEN 2: PLAN — GOALS + BUDGETS
   ════════════════════════════════════════════════════════ */

/* Plan screen header */
.screen-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 20px 8px;
    flex-shrink: 0;
}
.screen-title { font-size: 22px; font-weight: 800; letter-spacing: -0.5px; color: var(--text); }
.header-action { font-size: 14px; font-weight: 600; color: var(--brand); cursor: pointer; }

/* Sub-tab bar */
.subtab-bar {
    display: flex;
    padding: 0 20px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
}
.subtab {
    padding: 8px 0 10px;
    margin-right: 24px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text2);
    cursor: pointer;
    position: relative;
    transition: color 0.2s;
    white-space: nowrap;
}
.subtab.active { font-weight: 700; color: var(--text); }
.subtab.active::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0;
    width: 100%;
    height: 2px;
    background: var(--brand);
    border-radius: 2px 2px 0 0;
}

/* Scrollable tab content */
.tab-scroll {
    flex: 1;
    overflow-y: auto;
    scrollbar-width: none;
}
.tab-scroll::-webkit-scrollbar { display: none; }

.tab-pane { display: none; padding: 12px 20px 16px; }
.tab-pane.active { display: block; }

/* Goal cards — type accent system */
.goal-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 15px 15px 14px;
    margin-bottom: 10px;
    position: relative;
    transition: background 0.4s, border-color 0.4s;
}
.goal-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    border-radius: 16px 0 0 16px;
}
.gc-save::before    { background: var(--brand); }
.gc-spend::before   { background: var(--teal); }
.gc-debt::before    { background: var(--green); }
.goal-card.gc-completed::before { background: var(--text3); opacity: 0.5; }
.goal-card.gc-completed { opacity: 0.55; }

/* Goal header */
.goal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
.goal-header-left { display: flex; align-items: center; gap: 10px; }
.goal-icon {
    width: 34px; height: 34px;
    border-radius: 9px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
}
.gc-save  .goal-icon { background: var(--brand-light); }
.gc-spend .goal-icon { background: var(--teal-light); }
.gc-debt  .goal-icon { background: var(--green-light); }
.gc-completed .goal-icon { background: rgba(255,255,255,0.06); }

.goal-name       { font-size: 15px; font-weight: 700; color: var(--text); line-height: 1.2; }
.goal-type-label { font-size: 11px; color: var(--text2); margin-top: 1px; }

/* Goal amounts */
.goal-amounts {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 6px;
}
.goal-amount-main { font-size: 22px; font-weight: 800; letter-spacing: -0.8px; color: var(--text); }
.goal-amount-main .unit { font-size: 13px; font-weight: 500; color: var(--text2); letter-spacing: 0; }
.goal-pct-brand { font-size: 16px; font-weight: 700; color: var(--brand); }
.goal-pct-teal  { font-size: 16px; font-weight: 700; color: var(--teal); }
.goal-pct-green { font-size: 16px; font-weight: 700; color: var(--green); }

/* Bar labels */
.bar-labels { display: flex; justify-content: space-between; margin-top: 4px; }
.bar-lbl    { font-size: 11px; color: var(--text2); }
.bar-val-red    { font-size: 11px; font-weight: 600; color: var(--red); }
.bar-val-green  { font-size: 11px; font-weight: 600; color: var(--green); }

/* Goal footer */
.goal-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
.goal-footer-lbl { font-size: 11px; color: var(--text2); }
.goal-footer-val { font-size: 12px; font-weight: 600; color: var(--text); }

/* Streak */
.streak-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
}
.streak-text-amber { font-size: 12px; font-weight: 600; color: var(--amber); }
.streak-best       { font-size: 11px; color: var(--text3); margin-left: auto; }

/* Inline pill */
.inline-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255,255,255,0.04);
    border-radius: 20px;
    padding: 4px 10px;
    font-size: 11px;
    color: var(--text2);
    margin-top: 8px;
}
.inline-pill-teal  { background: rgba(78,205,196,0.08);  color: var(--teal); }
.inline-pill-green { background: rgba(81,207,102,0.08);  color: var(--green); }

/* Add goal / budget buttons */
.add-btn {
    width: 100%;
    height: 48px;
    border: 1px dashed rgba(124,110,250,0.3);
    border-radius: 12px;
    background: transparent;
    color: var(--brand);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    margin-top: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: background 0.15s;
}
.add-btn:hover { background: var(--brand-light); }

/* Milestone card */
.milestone-card {
    background: var(--card);
    border: 1px solid rgba(124,110,250,0.2);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    transition: background 0.4s;
}
.milestone-top { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.milestone-icon {
    width: 36px; height: 36px;
    border-radius: 10px;
    background: var(--brand-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 17px; flex-shrink: 0;
}
.ai-tag { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--brand); }
.milestone-title { font-size: 14px; font-weight: 700; color: var(--text); margin-top: 1px; }
.milestone-bar-track { height: 8px; background: rgba(255,255,255,0.08); border-radius: 4px; overflow: hidden; margin: 10px 0 6px; }
.milestone-bar-fill  { height: 100%; background: linear-gradient(90deg, var(--brand), #9C8FFF); border-radius: 4px; }
.milestone-labels    { display: flex; justify-content: space-between; margin-bottom: 8px; }
.ms-lbl-left  { font-size: 12px; color: var(--text2); }
.ms-lbl-right { font-size: 12px; font-weight: 600; color: var(--brand); }
.milestone-sub { font-size: 12px; color: var(--text2); line-height: 1.5; }
.milestone-cta { font-size: 13px; font-weight: 600; color: var(--brand); margin-top: 10px; display: block; cursor: pointer; }

/* AI Suggestion card (Plan) */
.plan-ai-card {
    background: var(--card);
    border: 1px solid rgba(124,110,250,0.25);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    display: none;
    transition: background 0.4s;
}
.plan-ai-card.visible { display: block; }
.ai-card-top { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 10px; }
.ai-card-icon { width: 36px; height: 36px; border-radius: 10px; background: var(--brand-light); display: flex; align-items: center; justify-content: center; font-size: 17px; flex-shrink: 0; }
.ai-card-type { font-size: 12px; color: var(--text2); margin-top: 1px; }
.ai-insight-text  { font-size: 14px; font-weight: 600; color: var(--text); line-height: 1.5; margin-bottom: 4px; }
.ai-preview-text  { font-size: 12px; color: var(--text2); line-height: 1.5; background: rgba(255,255,255,0.04); border-radius: 8px; padding: 8px 10px; margin-bottom: 12px; }
.ai-actions { display: flex; gap: 8px; }
.btn-primary {
    background: var(--brand); color: #fff;
    border: none; padding: 8px 16px; border-radius: 20px;
    font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit;
    transition: background 0.4s;
}
.btn-ghost {
    background: transparent; color: var(--text2);
    border: 1px solid var(--border); padding: 8px 12px; border-radius: 20px;
    font-size: 13px; font-weight: 500; cursor: pointer; font-family: inherit;
}

/* Completed section */
.completed-toggle {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 0; cursor: pointer;
    border-top: 1px solid var(--border); margin-top: 6px;
}
.completed-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text2); }
.completed-count { background: var(--brand-light); color: var(--brand); border-radius: 20px; padding: 2px 8px; font-size: 10px; font-weight: 700; }
.completed-chevron { margin-left: auto; font-size: 12px; color: var(--text3); transition: transform 0.25s ease; }
.completed-chevron.open { transform: rotate(180deg); }
.completed-goals { display: none; }
.completed-goals.visible { display: block; }

/* Budgets tab */
.period-banner {
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 14px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.period-day { font-size: 13px; font-weight: 500; color: var(--text); }
.period-pct { font-size: 12px; color: var(--text2); }

.budget-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
.bsc { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 14px; transition: background 0.4s, border-color 0.4s; }
.bsc-label  { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.7px; color: var(--text2); margin-bottom: 4px; }
.bsc-amount { font-size: 22px; font-weight: 800; letter-spacing: -0.8px; color: var(--text); }

.budget-list { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 12px; transition: background 0.4s, border-color 0.4s; }
.budget-row { padding: 14px 16px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.1s; }
.budget-row:last-child { border-bottom: none; }
.budget-row:hover { background: rgba(255,255,255,0.02); }
.budget-row-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.budget-cat { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text); }
.budget-goal-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--teal); flex-shrink: 0; }
.budget-amounts { display: flex; align-items: baseline; gap: 3px; }
.budget-spent { font-size: 14px; font-weight: 700; color: var(--text); }
.budget-limit { font-size: 11px; color: var(--text2); }
.budget-row-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: 6px; }
.budget-pct { font-size: 10px; color: var(--text3); }

/* ════════════════════════════════════════════════════════
   SCREEN 3: CALENDAR
   ════════════════════════════════════════════════════════ */

/* Month nav bar */
.cal-month-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 20px 8px;
    flex-shrink: 0;
}
.cal-nav-btn {
    width: 32px; height: 32px;
    border: 1px solid var(--border);
    border-radius: 50%;
    background: var(--card);
    color: var(--text2);
    font-size: 18px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: border-color 0.15s, color 0.15s;
    font-family: inherit;
}
.cal-nav-btn:hover { border-color: var(--brand); color: var(--brand); }
.cal-nav-btn:disabled { opacity: 0.3; pointer-events: none; }
.cal-month-title { font-size: 18px; font-weight: 800; color: var(--text); letter-spacing: -0.5px; }

/* Summary strip */
.cal-summary-strip {
    display: flex;
    background: var(--card);
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    transition: background 0.4s;
}
.cal-sum-cell {
    flex: 1; padding: 10px 0; text-align: center;
    border-right: 1px solid var(--border);
}
.cal-sum-cell:last-child { border-right: none; }
.cal-sum-label { font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
.cal-sum-value { font-size: 16px; font-weight: 800; color: var(--text); letter-spacing: -0.5px; margin-top: 2px; }

/* Weekday headers */
.cal-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    padding: 8px 16px 4px;
    flex-shrink: 0;
}
.cal-weekday {
    text-align: center;
    font-size: 10px; font-weight: 700; color: var(--text3);
    text-transform: uppercase; letter-spacing: 0.4px;
}

/* Calendar grid */
.cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    grid-auto-rows: 1fr;
    gap: 3px;
    padding: 0 16px 10px;
    flex: 1;
    min-height: 0;
    transition: opacity 0.2s;
}

/* Day cells */
.cal-day {
    border-radius: 10px;
    padding: 6px 5px 5px;
    cursor: pointer;
    position: relative;
    display: flex;
    flex-direction: column;
    transition: background 0.15s;
    border: 1.5px solid transparent;
    overflow: hidden;
}
.cal-day:hover { border-color: var(--border); }
.cal-day.selected { border-color: var(--brand) !important; }
.cal-day.blank { pointer-events: none; opacity: 0; }
.cal-day.future { opacity: 0.65; }

/* Safety tints */
.cal-day.tint-g { background: rgba(81,207,102,0.09); }
.cal-day.tint-a { background: rgba(247,200,75,0.09); }
.cal-day.tint-r { background: rgba(255,107,107,0.10); }
.cal-day.tint-p { background: rgba(139,126,255,0.13); }

/* Date number */
.cal-date-num {
    font-size: 11px; font-weight: 700; color: var(--text2);
    line-height: 1; margin-bottom: 2px; flex-shrink: 0;
}
.cal-day.is-today .cal-date-num {
    background: var(--brand); color: #fff;
    border-radius: 50%;
    width: 20px; height: 20px;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 700;
}

/* Payday micro-label */
.cal-payday-tag {
    font-size: 8px; font-weight: 700; color: var(--brand);
    text-transform: uppercase; letter-spacing: 0.3px;
    line-height: 1; margin-top: 1px; flex-shrink: 0;
}

/* Amount */
.cal-amount { font-size: 10px; font-weight: 700; color: var(--text); line-height: 1.2; flex-shrink: 0; }
.cal-amount.income { color: var(--brand); font-size: 9px; }

/* Category dots */
.cal-dots { display: flex; gap: 2px; margin-top: auto; flex-wrap: wrap; }
.cal-dot { width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }

/* Bill flag (top-right corner) */
.cal-bill-flag {
    position: absolute; top: 4px; right: 4px;
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--amber);
}
.cal-bill-flag.urgent { background: var(--red); }

/* Legend */
.cal-legend {
    display: flex; justify-content: center; gap: 14px;
    padding: 6px 16px 8px; flex-shrink: 0;
}
.cal-legend-item { display: flex; align-items: center; gap: 5px; font-size: 10px; color: var(--text2); }
.cal-legend-swatch { width: 10px; height: 10px; border-radius: 3px; }

/* Calendar day detail sheet */
.cal-sheet-date-hd {
    font-size: 12px; font-weight: 600; color: var(--text2);
    text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;
}
.cal-sheet-total-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 0 14px; border-bottom: 1px solid var(--border); margin-bottom: 12px;
}
.cal-sheet-total-lbl { font-size: 13px; color: var(--text2); }
.cal-sheet-total-amt { font-size: 22px; font-weight: 800; color: var(--text); letter-spacing: -0.8px; }
.cal-sheet-total-amt.income { color: var(--brand); }
.cal-upcoming-hd {
    font-size: 11px; font-weight: 700; text-transform: uppercase;
    letter-spacing: 0.7px; color: var(--text2); margin: 12px 0 8px;
}

/* View toggle bar (Month | Week | Day) */
.cal-view-bar {
    padding: 8px 16px;
    flex-shrink: 0;
}
.cal-view-seg {
    display: flex;
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    transition: background 0.4s, border-color 0.4s;
}
.cal-view-btn {
    flex: 1;
    padding: 7px 0;
    border: none;
    border-right: 1px solid var(--border);
    font-size: 13px; font-weight: 500;
    cursor: pointer; font-family: inherit;
    background: transparent; color: var(--text2);
    transition: background 0.15s, color 0.15s, border-color 0.4s;
}
.cal-view-btn:last-child { border-right: none; }
.cal-view-btn.active { background: var(--brand); color: #fff; font-weight: 700; }

/* Week grid */
/* Week view — horizontal tile list */
.cal-week-list {
    display: none;
    flex-direction: column;
    gap: 5px;
    padding: 6px 16px 10px;
    flex: 1; min-height: 0;
    overflow-y: auto;
    scrollbar-width: none;
}
.cal-week-list::-webkit-scrollbar { display: none; }
.cal-week-list.vis { display: flex; }
.cal-week-row {
    display: flex; align-items: center; gap: 14px;
    padding: 11px 14px; border-radius: 13px;
    border: 1.5px solid transparent; cursor: pointer;
    transition: border-color 0.15s; flex-shrink: 0;
}
.cal-week-row:hover    { border-color: var(--border); }
.cal-week-row.selected { border-color: var(--brand); }
.cal-week-row.tint-g { background: rgba(81,207,102,0.09); }
.cal-week-row.tint-a { background: rgba(247,200,75,0.09); }
.cal-week-row.tint-r { background: rgba(255,107,107,0.10); }
.cal-week-row.tint-p { background: rgba(139,126,255,0.13); }
/* Left: date label — DOW is primary, date is secondary */
.cal-week-day-label { width: 46px; flex-shrink: 0; }
.cal-week-dow {
    font-size: 16px; font-weight: 800; color: var(--text);
    text-transform: uppercase; letter-spacing: -0.3px; line-height: 1;
}
.cal-week-date {
    font-size: 12px; font-weight: 600; color: var(--text3);
    line-height: 1; margin-top: 4px;
}
.cal-week-row.is-today .cal-week-dow  { color: var(--brand); }
.cal-week-row.is-today .cal-week-date { color: var(--brand); font-weight: 700; }
/* Center: dots + spend bar */
.cal-week-center { flex: 1; min-width: 0; }
.cal-week-dots { display: flex; gap: 4px; margin-bottom: 7px; }
.cal-week-dot  { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.cal-week-bar-row   { display: flex; align-items: center; gap: 8px; }
.cal-week-bar-track {
    flex: 1; height: 3px; background: var(--card2);
    border-radius: 2px; overflow: hidden;
}
.cal-week-bar-fill { height: 100%; border-radius: 2px; }
.cal-week-row.tint-g .cal-week-bar-fill { background: var(--green); }
.cal-week-row.tint-a .cal-week-bar-fill { background: var(--amber); }
.cal-week-row.tint-r .cal-week-bar-fill { background: var(--red); }
.cal-week-bar-pct {
    font-size: 10px; font-weight: 700; color: var(--text3);
    flex-shrink: 0; min-width: 30px; text-align: right;
}
.cal-week-row.tint-g .cal-week-bar-pct { color: var(--green); }
.cal-week-row.tint-a .cal-week-bar-pct { color: var(--amber); }
.cal-week-row.tint-r .cal-week-bar-pct { color: var(--red); }
/* Future day labels */
.cal-week-future-lbl { font-size: 11px; color: var(--text3); line-height: 1.4; }
.cal-week-bill-name  { font-size: 11px; font-weight: 600; color: var(--amber); }
/* Right: amount */
.cal-week-amount {
    font-size: 16px; font-weight: 800; color: var(--text);
    letter-spacing: -0.4px; text-align: right; flex-shrink: 0;
}
.cal-week-amount.future-amt { font-size: 13px; color: var(--amber); font-weight: 700; }
.cal-week-amount.zero-amt   { font-size: 13px; color: var(--text3); font-weight: 600; }

/* Day view */
.cal-day-view {
    display: none; flex: 1; flex-direction: column;
    overflow: hidden;
}
.cal-day-view.vis { display: flex; }
.cal-day-content {
    flex: 1; padding: 14px 20px;
    overflow-y: auto; scrollbar-width: none;
}
.cal-day-content::-webkit-scrollbar { display: none; }
.cal-day-stat-card {
    display: flex; justify-content: space-around;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 14px; padding: 14px 16px; margin-bottom: 14px;
    transition: background 0.4s, border-color 0.4s;
}
.cal-day-stat { text-align: center; }
.cal-day-stat-lbl { font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
.cal-day-stat-val { font-size: 20px; font-weight: 800; color: var(--text); letter-spacing: -0.6px; margin-top: 3px; }

/* ════════════════════════════════════════════════════════
   PLACEHOLDER SCREENS (Accounts, Insights)
   ════════════════════════════════════════════════════════ */

.placeholder-screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 32px;
    text-align: center;
}
.placeholder-icon { font-size: 48px; margin-bottom: 16px; }
.placeholder-title { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; color: var(--text); margin-bottom: 8px; }
.placeholder-desc  { font-size: 13px; color: var(--text2); line-height: 1.7; max-width: 240px; }
.placeholder-badge { display: inline-flex; margin-top: 20px; background: var(--brand-light); color: var(--brand); border-radius: 20px; padding: 4px 14px; font-size: 11px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; }

/* ════════════════════════════════════════════════════════
   BOTTOM SHEET
   ════════════════════════════════════════════════════════ */

.sheet-backdrop {
    position: absolute; inset: 0;
    background: rgba(0,0,0,0);
    z-index: 35;
    display: none;
    border-radius: 44px;
    overflow: hidden;
    transition: background 0.35s;
}
.sheet-backdrop.visible,
.sheet-backdrop.open { display: block; background: rgba(0,0,0,0.6); }

.bottom-sheet {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: var(--card);
    border-radius: 20px 20px 0 0;
    padding: 8px 20px 40px;
    z-index: 36;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94), background 0.4s;
}
.bottom-sheet.open { transform: translateY(0); }
.sheet-handle { width: 32px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin: 12px auto 20px; }
.sheet-title  { font-size: 17px; font-weight: 800; letter-spacing: -0.5px; color: var(--text); margin-bottom: 6px; }
.sheet-sub    { font-size: 13px; color: var(--text2); margin-bottom: 20px; }

.type-option {
    display: flex; align-items: center; gap: 14px;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 16px; margin-bottom: 10px;
    cursor: pointer;
    transition: background 0.15s;
    position: relative;
}
.type-option:hover { background: rgba(255,255,255,0.07); }
.type-option.to-save   { border-left: 3px solid var(--brand); }
.type-option.to-spend  { border-left: 3px solid var(--teal); }
.type-option.to-debt   { border-left: 3px solid var(--green); }
.type-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
.to-save  .type-icon { background: var(--brand-light); }
.to-spend .type-icon { background: var(--teal-light); }
.to-debt  .type-icon { background: var(--green-light); }
.type-name { font-size: 15px; font-weight: 700; color: var(--text); }
.type-desc { font-size: 12px; color: var(--text2); line-height: 1.4; margin-top: 2px; }
.type-chevron { font-size: 16px; color: var(--text3); margin-left: auto; }

/* ════════════════════════════════════════════════════════
   AI CHAT OVERLAY
   ════════════════════════════════════════════════════════ */

.chat-overlay {
    position: absolute; inset: 0;
    background: var(--bg);
    border-radius: 44px;
    z-index: 40;
    display: none;
    flex-direction: column;
    overflow: hidden;
    transition: background 0.4s;
}
.chat-overlay.open { display: flex; }

.chat-header {
    padding: 58px 20px 14px;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
}
.chat-ai-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--brand); }
.chat-title    { font-size: 17px; font-weight: 800; letter-spacing: -0.5px; color: var(--text); }
.chat-close {
    width: 30px; height: 30px; border-radius: 50%;
    background: rgba(255,255,255,0.08);
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; cursor: pointer; color: var(--text2);
    border: none; font-family: inherit;
}

.chat-messages { flex: 1; overflow-y: auto; padding: 16px 20px; scrollbar-width: none; }
.chat-messages::-webkit-scrollbar { display: none; }

.chat-msg { margin-bottom: 12px; max-width: 84%; }
.chat-msg.user { margin-left: auto; }
.msg-bubble    { padding: 10px 14px; border-radius: 16px; font-size: 13px; line-height: 1.5; }
.ai .msg-bubble   { background: var(--card2); color: var(--text); border-radius: 4px 16px 16px 16px; }
.user .msg-bubble { background: var(--brand);  color: #fff; border-radius: 16px 4px 16px 16px; }
.msg-ai-tag { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: var(--brand); margin-bottom: 4px; }

.chat-suggestions { padding: 0 20px 12px; flex-shrink: 0; }
.chat-sugg-label  { font-size: 11px; color: var(--text2); margin-bottom: 8px; }
.chat-chips { display: flex; flex-wrap: wrap; gap: 8px; }
.chat-chip {
    background: var(--card); border: 1px solid var(--border); border-radius: 20px;
    padding: 6px 12px; font-size: 12px; color: var(--text);
    cursor: pointer; font-family: inherit; transition: border-color 0.15s;
}
.chat-chip:hover { border-color: var(--brand); color: var(--brand); }

.chat-input-row { padding: 12px 20px 32px; display: flex; gap: 10px; border-top: 1px solid var(--border); flex-shrink: 0; }
.chat-input {
    flex: 1; background: var(--card2);
    border: 1px solid var(--border); border-radius: 20px;
    padding: 10px 16px; font-size: 14px; color: var(--text);
    font-family: inherit; outline: none;
}
.chat-input::placeholder { color: var(--text3); }
.chat-input:focus { border-color: rgba(124,110,250,0.4); }
.chat-send {
    width: 40px; height: 40px; border-radius: 50%;
    background: var(--brand); border: none;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; cursor: pointer; flex-shrink: 0; color: #fff;
    transition: background 0.4s;
}

/* ── Archetype quiz chips ── */
.quiz-chips { display: flex; flex-direction: column; gap: 7px; margin-top: 10px; }
.quiz-chip {
    background: var(--card); border: 1.5px solid var(--border); border-radius: 12px;
    padding: 10px 14px; font-size: 12.5px; color: var(--text);
    cursor: pointer; font-family: inherit; transition: border-color 0.15s, background 0.15s, color 0.15s;
    text-align: left; line-height: 1.4; width: 100%;
}
.quiz-chip:hover:not(:disabled) { border-color: var(--brand); background: var(--brand-light); }
.quiz-chip:disabled { cursor: default; }

/* ── Archetype reveal card (inside chat bubble) ── */
.archetype-card {
    background: var(--card2); border-radius: 14px;
    padding: 14px 16px; margin-top: 8px;
    border-left: 3px solid var(--brand);
}
.archetype-card-top  { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.archetype-card-icon { font-size: 26px; line-height: 1; flex-shrink: 0; }
.archetype-card-name { font-size: 16px; font-weight: 800; letter-spacing: -0.5px; }
.archetype-card-type { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; margin-top: 2px; }
.archetype-card-desc { font-size: 12px; color: var(--text2); line-height: 1.6; margin-bottom: 8px; }
.archetype-card-note { font-size: 11px; color: var(--text3); padding-top: 8px; border-top: 1px solid var(--border); }

/* ── Archetype chip in chat header ── */
.chat-archetype-chip {
    display: none; align-items: center; gap: 5px;
    background: var(--brand-light); border: 1px solid rgba(124,110,250,0.25);
    border-radius: 20px; padding: 3px 9px;
    font-size: 10px; font-weight: 700; color: var(--brand);
    margin-top: 5px; cursor: pointer; width: fit-content;
    transition: opacity 0.3s;
}
.chat-archetype-chip.visible { display: inline-flex; }

/* ── Profile bottom sheet ── */
.profile-arch-banner {
    border-radius: 14px; padding: 16px; margin-bottom: 14px;
    border-left: 4px solid var(--brand); background: var(--card2);
}
.profile-arch-banner-top { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.profile-arch-big-icon   { font-size: 30px; flex-shrink: 0; }
.profile-arch-name  { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; color: var(--text); }
.profile-arch-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; margin-top: 2px; }
.profile-arch-desc  { font-size: 12px; color: var(--text2); line-height: 1.6; margin-bottom: 10px; }
.profile-arch-note  { font-size: 11px; color: var(--text3); padding-top: 10px; border-top: 1px solid var(--border); }

/* ════════════════════════════════════════════════════════
   ARROW CONTROLS (below phone)
   ════════════════════════════════════════════════════════ */
.arrow-row {
    display: flex; align-items: center; gap: 14px;
}
.arrow-btn {
    width: 38px; height: 38px;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; color: var(--text2); font-size: 16px;
    user-select: none; transition: all 0.2s;
}
.arrow-btn:hover { border-color: var(--brand); color: var(--brand); background: var(--brand-light); }
.arrow-label { font-size: 12px; color: var(--text2); }
.arrow-row-hidden { display: none; }

/* ════════════════════════════════════════════════
   INSIGHTS SCREEN
════════════════════════════════════════════════ */
.ins-period-bar { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
.ins-period-chip {
    padding: 5px 13px; border-radius: 20px;
    font-size: 12px; font-weight: 600;
    border: 1px solid var(--border); color: var(--text2);
    cursor: pointer; transition: all 0.2s; white-space: nowrap;
}
.ins-period-chip.active { background: var(--brand-light); color: var(--brand); border-color: var(--brand); }

.ins-kpi-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 14px; }
.ins-kpi-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 14px; padding: 11px 12px;
    transition: background 0.4s, border-color 0.4s;
}
.ins-kpi-label { font-size: 9px; font-weight: 700; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px; }
.ins-kpi-value { font-size: 16px; font-weight: 800; color: var(--text); letter-spacing: -0.5px; line-height: 1.1; }
.ins-kpi-sub   { font-size: 9px; color: var(--text3); margin-top: 2px; }

.ins-dual-chart { display: flex; gap: 5px; align-items: flex-end; height: 80px; margin: 12px 0 4px; }
.ins-month-col  { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; height: 100%; justify-content: flex-end; }
.ins-bar-pair   { display: flex; gap: 2px; align-items: flex-end; width: 100%; }
.ins-bar-i      { flex: 1; border-radius: 3px 3px 0 0; background: var(--brand); opacity: 0.65; }
.ins-bar-s      { flex: 1; border-radius: 3px 3px 0 0; background: var(--red); opacity: 0.75; }
.ins-chart-label        { font-size: 9px; color: var(--text3); }
.ins-chart-label.active { color: var(--brand); font-weight: 700; }
.ins-chart-legend { display: flex; gap: 14px; margin-top: 10px; }
.ins-legend-item  { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--text2); }
.ins-legend-dot   { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }

.ins-creep-detail { margin-top: 12px; }
.ins-creep-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 0; border-bottom: 1px solid var(--border);
}
.ins-creep-row:last-child { border-bottom: none; }
.ins-creep-row-label { font-size: 12px; color: var(--text2); }
.ins-creep-row-val   { font-size: 14px; font-weight: 700; }

.ins-merchant-row {
    display: flex; align-items: center; gap: 12px;
    padding: 10px 16px; border-bottom: 1px solid var(--border);
}
.ins-merchant-row:last-child { border-bottom: none; }
.ins-merchant-name  { font-size: 13px; font-weight: 600; color: var(--text); width: 90px; flex-shrink: 0; }
.ins-merchant-bar-wrap  { flex: 1; }
.ins-merchant-bar-track { height: 4px; background: rgba(255,255,255,0.08); border-radius: 2px; overflow: hidden; }
.ins-merchant-bar-fill  { height: 100%; border-radius: 2px; background: var(--brand); }
.ins-merchant-amount { font-size: 13px; font-weight: 700; color: var(--text); flex-shrink: 0; width: 52px; text-align: right; }

.ins-pay-row {
    display: flex; align-items: center; gap: 12px;
    padding: 11px 16px; border-bottom: 1px solid var(--border);
}
.ins-pay-row:last-child { border-bottom: none; }

.ins-proj-card {
    background: linear-gradient(135deg, var(--hero-start) 0%, var(--card) 65%);
    border: 1px solid rgba(124,110,250,0.3);
    border-radius: 20px; padding: 18px 20px; margin-bottom: 12px;
    position: relative; overflow: hidden;
    transition: background 0.4s, border-color 0.4s;
}
.ins-proj-card::before {
    content: ''; position: absolute; top: -50px; right: -50px;
    width: 180px; height: 180px;
    background: radial-gradient(circle, rgba(124,110,250,0.12) 0%, transparent 70%);
    pointer-events: none;
}
.ins-proj-label { font-size: 11px; font-weight: 700; color: var(--brand); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
.ins-proj-amount { font-size: 40px; font-weight: 800; letter-spacing: -2px; line-height: 1; margin-bottom: 12px; }
.ins-proj-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.ins-proj-cell { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 8px 10px; }
.ins-proj-cell-label { font-size: 9px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; white-space: nowrap; }
.ins-proj-cell-val { font-size: 14px; font-weight: 700; color: var(--text); }

.ins-goal-row {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px; border-bottom: 1px solid var(--border);
}
.ins-goal-row:last-child { border-bottom: none; }
.ins-goal-info { flex: 1; min-width: 0; }
.ins-goal-name { font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.ins-goal-bar-row { display: flex; align-items: center; gap: 8px; }
.ins-goal-eta { font-size: 11px; font-weight: 700; color: var(--brand); flex-shrink: 0; text-align: right; }

.ins-risk-item {
    display: flex; gap: 10px; align-items: flex-start;
    padding: 11px 16px; border-bottom: 1px solid var(--border);
}
.ins-risk-item:last-child { border-bottom: none; }
.ins-risk-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; margin-top: 4px; }
.ins-risk-text { font-size: 12px; color: var(--text2); line-height: 1.5; }

/* ════════════════════════════════════════════════
   ACCOUNTS SCREEN
════════════════════════════════════════════════ */
@keyframes acctPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50%       { opacity: 0.4; transform: scale(0.7); }
}
.acct-net-card {
    background: linear-gradient(135deg, var(--hero-start) 0%, var(--card) 65%);
    border: 1px solid rgba(124,110,250,0.3);
    border-radius: 20px;
    padding: 18px 20px;
    margin-bottom: 12px;
    position: relative;
    overflow: hidden;
    transition: background 0.4s, border-color 0.4s;
}
.acct-net-card::before {
    content: '';
    position: absolute;
    top: -50px; right: -50px;
    width: 180px; height: 180px;
    background: radial-gradient(circle, rgba(124,110,250,0.15) 0%, transparent 70%);
    pointer-events: none;
}
.acct-net-label {
    font-size: 11px; font-weight: 700; color: var(--brand);
    text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;
}
.acct-net-amount {
    font-size: 42px; font-weight: 800; color: var(--green);
    letter-spacing: -2px; line-height: 1; margin-bottom: 12px;
}
.acct-net-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.acct-net-cell {
    background: rgba(255,255,255,0.04);
    border-radius: 10px; padding: 8px 10px;
}
.acct-net-cell-label {
    font-size: 10px; font-weight: 600; color: var(--text3);
    text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px;
}
.acct-net-cell-val { font-size: 16px; font-weight: 700; color: var(--text); }
.acct-live-dot {
    display: inline-block;
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--green);
    animation: acctPulse 2s ease-in-out infinite;
    flex-shrink: 0;
}
.acct-review-item {
    max-height: 200px; overflow: hidden;
    transition: max-height 0.32s ease, opacity 0.32s ease, padding 0.32s ease;
    border-bottom: 1px solid var(--border);
}
.acct-review-item:last-child { border-bottom: none; }
.acct-review-item.removing { opacity: 0; max-height: 0; padding: 0; }
.acct-review-inner {
    display: flex; align-items: flex-start; gap: 12px;
    padding: 12px 16px 8px;
}
.acct-review-actions {
    display: flex; gap: 8px;
    padding: 0 16px 12px; align-items: center; justify-content: flex-end;
}
.acct-approve-btn {
    display: flex; align-items: center; gap: 5px;
    padding: 7px 16px; border-radius: 20px; border: none;
    background: var(--green-light); color: var(--green);
    font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.2s;
}
.acct-approve-btn:hover { background: var(--green); color: #fff; }
.acct-rule-btn {
    display: flex; align-items: center; gap: 4px;
    padding: 7px 14px; border-radius: 20px;
    border: 1px solid var(--border); background: transparent;
    color: var(--text2); font-size: 12px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
}
.acct-rule-btn:hover { border-color: var(--brand); color: var(--brand); background: var(--brand-light); }
.acct-ai-pill {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 2px 8px; border-radius: 20px;
    background: var(--brand-light); color: var(--brand);
    font-size: 10px; font-weight: 700;
}
.acct-conf-high {
    display: inline-flex; align-items: center;
    padding: 2px 7px; border-radius: 20px;
    background: var(--green-light); color: var(--green);
    font-size: 10px; font-weight: 700;
}
.acct-conf-medium {
    display: inline-flex; align-items: center;
    padding: 2px 7px; border-radius: 20px;
    background: var(--amber-light); color: var(--amber);
    font-size: 10px; font-weight: 700;
}
.acct-milestone-banner {
    background: var(--card);
    border: 1px solid rgba(124,110,250,0.3);
    border-radius: 16px; padding: 14px 16px; margin-bottom: 12px;
    transition: background 0.4s, border-color 0.4s;
}
.acct-milestone-title { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
.acct-milestone-sub   { font-size: 11px; color: var(--text2); margin-bottom: 10px; }
.acct-empty-state {
    display: none; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 40px 20px; text-align: center; gap: 8px;
}
.acct-empty-state.visible { display: flex; }
.acct-empty-icon  { font-size: 40px; margin-bottom: 4px; }
.acct-empty-title { font-size: 17px; font-weight: 700; color: var(--text); }
.acct-empty-sub   { font-size: 13px; color: var(--text2); line-height: 1.5; }
.acct-cat-grid {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;
    padding: 0 4px;
}
.acct-cat-option {
    display: flex; flex-direction: column; align-items: center; gap: 6px;
    padding: 12px 8px; border-radius: 14px;
    border: 1px solid var(--border); background: var(--card);
    cursor: pointer; transition: all 0.2s; text-align: center;
}
.acct-cat-option:hover { background: var(--brand-light); border-color: var(--brand); }
.acct-cat-icon { font-size: 22px; }
.acct-cat-name { font-size: 10px; font-weight: 600; color: var(--text2); line-height: 1.2; }
.acct-rule-row {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px; border-bottom: 1px solid var(--border);
}
.acct-rule-row:last-child { border-bottom: none; }
.acct-rule-info    { flex: 1; min-width: 0; }
.acct-rule-merchant { font-size: 13px; font-weight: 600; color: var(--text); }
.acct-rule-arrow   { font-size: 11px; color: var(--text3); margin: 2px 0; }
.acct-toggle       { display: flex; align-items: center; }
.acct-toggle-track {
    width: 34px; height: 20px; border-radius: 10px;
    background: var(--green); position: relative; flex-shrink: 0;
}
.acct-toggle-thumb {
    position: absolute; top: 3px; right: 3px;
    width: 14px; height: 14px; border-radius: 50%;
    background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
.acct-delete-btn {
    width: 28px; height: 28px; border-radius: 50%;
    border: none; background: rgba(255,255,255,0.05); color: var(--text3);
    font-size: 14px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; flex-shrink: 0;
}
.acct-delete-btn:hover { background: var(--red-light); color: var(--red); }
.acct-link-btn {
    display: flex; align-items: center; justify-content: center;
    width: 100%; padding: 13px; border-radius: 14px;
    border: 1.5px dashed var(--brand); background: transparent;
    color: var(--brand); font-size: 14px; font-weight: 700;
    cursor: pointer; transition: all 0.2s; margin-top: 10px;
    box-sizing: border-box;
}
.acct-link-btn:hover { background: var(--brand-light); }
.acct-info-card {
    background: var(--brand-light);
    border: 1px solid rgba(124,110,250,0.2);
    border-radius: 14px; padding: 13px 15px; margin-top: 10px;
    font-size: 12px; color: var(--text2); line-height: 1.5;
}
.acct-info-card strong { color: var(--brand); }
.acct-ai-pill.acct-pill-tap { cursor: pointer; }
.acct-ai-pill.acct-pill-tap:hover { background: var(--brand); color: #fff; }
.acct-bulk-banner {
    display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
    padding: 8px 16px 10px; background: var(--brand-light);
    border-top: 1px solid rgba(139,126,255,0.2);
    font-size: 11px; color: var(--text2);
}
.acct-bulk-banner button {
    padding: 4px 12px; border-radius: 20px; cursor: pointer;
    font-size: 11px; font-weight: 700; border: none;
}
.acct-bulk-banner button:first-of-type { background: var(--brand); color: #fff; }
.acct-bulk-banner button:last-of-type { background: transparent; color: var(--text2); border: 1px solid var(--border); }
.acct-rule-select {
    background: var(--bg); color: var(--text); border: 1px solid var(--border);
    border-radius: 8px; padding: 6px 10px; font-size: 12px; font-family: inherit;
    cursor: pointer; appearance: auto;
}
.acct-rule-input {
    background: var(--card); color: var(--text); border: 1px solid var(--border);
    border-radius: 8px; padding: 6px 10px; font-size: 12px; font-family: inherit; flex: 1;
}
.acct-cat-option.selected { background: var(--brand-light); border-color: var(--brand); }

/* ════════════════════ PLAN SCREEN ADDITIONS ════════════════════ */
/* Pending allocation card */
.plan-alloc-card { background: var(--brand-light); border: 1px solid rgba(139,126,255,0.3); border-radius: 16px; padding: 14px 16px; margin-bottom: 14px; cursor: pointer; }
.plan-alloc-icon { width: 36px; height: 36px; background: var(--brand); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
.plan-alloc-amount { font-size: 22px; font-weight: 800; color: var(--brand); }

/* Goal contribution rows */
.goal-contr-row { display: flex; align-items: center; gap: 10px; padding: 11px 0; border-bottom: 1px solid var(--border); }
.goal-contr-row:last-child { border-bottom: none; }
.goal-contr-date { font-size: 11px; color: var(--text2); width: 40px; flex-shrink: 0; text-align: center; }
.goal-contr-info { flex: 1; }
.goal-contr-name { font-size: 13px; font-weight: 600; color: var(--text); }
.goal-contr-source { font-size: 11px; color: var(--text2); }
.goal-contr-amount { font-size: 13px; font-weight: 700; color: var(--green); margin-right: 8px; }
.goal-contr-reassign { font-size: 11px; color: var(--brand); cursor: pointer; padding: 3px 8px; border: 1px solid rgba(139,126,255,0.3); border-radius: 8px; white-space: nowrap; }

/* Add goal / budget step header */
.ag-step-hd { display: flex; align-items: center; gap: 10px; padding: 0 20px 18px; }
.ag-step-back { width: 32px; height: 32px; border-radius: 50%; background: var(--card); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 18px; color: var(--text); cursor: pointer; flex-shrink: 0; line-height: 1; }
.ag-step-dots { flex: 1; display: flex; gap: 4px; }
.ag-step-dot { height: 3px; flex: 1; background: var(--border); border-radius: 2px; }
.ag-step-dot.done { background: var(--green); }
.ag-step-dot.active { background: var(--brand); }
.ag-step-lbl { font-size: 11px; color: var(--text3); width: 50px; text-align: right; flex-shrink: 0; }

/* Emoji picker row */
.ag-emoji-row { display: flex; gap: 8px; flex-wrap: wrap; margin: 8px 0 16px; }
.ag-emoji-btn { width: 40px; height: 40px; border-radius: 10px; border: 2px solid var(--border); background: var(--card); font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: border-color 0.15s, background 0.15s; }
.ag-emoji-btn.selected { border-color: var(--brand); background: var(--brand-light); }

/* Option chips (goal target options) */
.ag-option-chips { display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
.ag-chip { padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--card); font-size: 13px; font-weight: 600; color: var(--text2); cursor: pointer; transition: all 0.15s; }
.ag-chip.selected { border-color: var(--brand); background: var(--brand-light); color: var(--brand); }

/* Category select grid (add goal habit / add budget) */
.ag-cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 10px 0; }
.ag-cat-item { padding: 10px 8px; border: 2px solid var(--border); border-radius: 12px; background: var(--card); text-align: center; cursor: pointer; transition: all 0.15s; }
.ag-cat-item.selected { border-color: var(--brand); background: var(--brand-light); }
.ag-cat-emoji { font-size: 20px; display: block; margin-bottom: 4px; }
.ag-cat-name { font-size: 11px; font-weight: 600; color: var(--text2); }
.ag-cat-item.selected .ag-cat-name { color: var(--brand); }

/* Goal allocation sheet split rows */
.goal-alloc-split { display: flex; align-items: center; gap: 10px; padding: 11px 0; border-bottom: 1px solid var(--border); }
.goal-alloc-split:last-child { border-bottom: none; }
.goal-alloc-input { width: 76px; background: var(--card); border: 1.5px solid var(--border); border-radius: 8px; padding: 7px 10px; font-size: 13px; font-weight: 700; color: var(--text); text-align: right; font-family: inherit; }
.goal-alloc-input:focus { border-color: var(--brand); outline: none; }

/* Budget txn rows */
.budget-txn-row { display: flex; align-items: center; gap: 10px; padding: 11px 0; border-bottom: 1px solid var(--border); }
.budget-txn-row:last-child { border-bottom: none; }

/* Goal card & budget row — clickable */
.goal-card { cursor: pointer; }
.budget-row { cursor: pointer; }

/* ════════════════════ DASHBOARD SHEETS ════════════════════ */
/* Profile */
.profile-avatar { width: 60px; height: 60px; border-radius: 50%; background: var(--brand); display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 800; color: #fff; margin: 0 auto 10px; }
.profile-name   { font-size: 18px; font-weight: 800; color: var(--text); text-align: center; }
.profile-email  { font-size: 13px; color: var(--text2); text-align: center; margin-top: 2px; }
.profile-row    { display: flex; align-items: center; gap: 12px; padding: 13px 0; border-bottom: 1px solid var(--border); cursor: pointer; }
.profile-row:last-child { border-bottom: none; }
.profile-row-icon  { font-size: 16px; width: 22px; text-align: center; }
.profile-row-label { font-size: 14px; color: var(--text); flex: 1; }
.profile-row-val   { font-size: 13px; color: var(--text2); }
.profile-row-arrow { font-size: 14px; color: var(--text3); margin-left: 4px; }

/* Insight breakdown */
.ins-break-stat { background: var(--card); border-radius: 12px; padding: 12px 14px; flex: 1; }
.ins-break-stat-label { font-size: 11px; color: var(--text2); margin-bottom: 3px; }
.ins-break-stat-val   { font-size: 18px; font-weight: 800; color: var(--text); }
.ins-txn-row    { display: flex; align-items: center; padding: 10px 14px; border-bottom: 1px solid var(--border); }
.ins-txn-row:last-child { border-bottom: none; }

/* Subscription toggle */
.sub-row        { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
.list-card .sub-row { padding-left: 16px; padding-right: 16px; }
.sub-row:last-child { border-bottom: none; }
.sub-row-icon   { font-size: 20px; width: 28px; text-align: center; flex-shrink: 0; }
.sub-row-info   { flex: 1; }
.sub-row-name   { font-size: 13px; font-weight: 600; color: var(--text); }
.sub-row-meta   { font-size: 11px; color: var(--text2); margin-top: 1px; }
.sub-row-amt    { font-size: 13px; font-weight: 700; color: var(--text); margin-right: 10px; }
.sub-toggle-track { width: 40px; height: 22px; border-radius: 11px; background: var(--green); transition: background 0.2s; flex-shrink: 0; cursor: pointer; position: relative; }
.sub-toggle-track.off { background: rgba(255,255,255,0.12); }
.sub-toggle-thumb { position: absolute; top: 3px; right: 3px; width: 16px; height: 16px; border-radius: 50%; background: #fff; transition: transform 0.2s; pointer-events: none; }
.sub-toggle-track.off .sub-toggle-thumb { transform: translateX(-18px); }

/* ════════════════════════════════════════════════════════
   ONBOARDING OVERLAY
   Full-screen overlay, z-index 35, shown before main app.
   Hidden class slides it away; .ob-screen system mirrors
   the .app-screen pattern for consistent transitions.
   ════════════════════════════════════════════════════════ */

.ob-overlay {
    position: absolute;
    top: 54px; left: 0; right: 0; bottom: 0;
    z-index: 35;
    background: var(--bg);
    transition: opacity 0.4s, transform 0.4s;
}
.ob-overlay.hidden {
    opacity: 0;
    pointer-events: none;
    transform: translateY(16px);
}
.ob-overlay.hidden .ob-screen { pointer-events: none; }
.ob-screen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex; flex-direction: column;
    overflow-y: auto; scrollbar-width: none;
    opacity: 0; pointer-events: none;
    transform: translateX(30px);
    transition: opacity 0.25s ease, transform 0.25s ease;
}
.ob-screen::-webkit-scrollbar { display: none; }
.ob-screen.active    { opacity: 1; pointer-events: all; transform: translateX(0); }
.ob-screen.exit-left { opacity: 0; transform: translateX(-30px); }

.ob-header {
    display: flex; align-items: center; padding: 14px 20px 6px; gap: 12px; flex-shrink: 0;
}
.ob-back {
    width: 36px; height: 36px; border-radius: 50%;
    background: var(--card); border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; cursor: pointer; color: var(--text); flex-shrink: 0; line-height: 1;
}
.ob-step-dots { display: flex; gap: 5px; flex: 1; justify-content: center; }
.ob-step-dot { height: 4px; border-radius: 2px; background: var(--text3); transition: all 0.3s; }
.ob-step-dot.active      { width: 18px; background: var(--brand); }
.ob-step-dot:not(.active){ width: 5px; }
.ob-spacer { width: 36px; flex-shrink: 0; }

.ob-body { flex: 1; padding: 10px 24px 24px; display: flex; flex-direction: column; }

.ob-btn {
    width: 100%; padding: 15px; border-radius: 16px; border: none;
    font-family: inherit; font-size: 15px; font-weight: 700; cursor: pointer;
    transition: transform 0.1s; letter-spacing: -0.3px;
}
.ob-btn:active { transform: scale(0.98); }
.ob-btn-primary   { background: var(--brand); color: #fff; box-shadow: 0 4px 20px rgba(139,126,255,0.35); }
.ob-btn-secondary { background: var(--card); color: var(--text); border: 1px solid var(--border); }
.ob-btn-ghost     { background: transparent; color: var(--brand); font-size: 14px; padding: 12px; }

.ob-feature-row {
    display: flex; align-items: center; gap: 14px; padding: 13px 16px;
    background: var(--card); border: 1px solid var(--border); border-radius: 14px;
}
.ob-feature-icon {
    width: 40px; height: 40px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0;
}
.ob-feature-title { font-size: 14px; font-weight: 600; color: var(--text); }
.ob-feature-sub   { font-size: 12px; color: var(--text2); margin-top: 2px; }

.ob-input {
    width: 100%; padding: 14px 16px; background: var(--card); border: 1px solid var(--border);
    border-radius: 14px; font-family: inherit; font-size: 15px; color: var(--text);
    outline: none; transition: border-color 0.2s;
}
.ob-input:focus { border-color: rgba(139,126,255,0.5); }
.ob-input::placeholder { color: var(--text3); }

.ob-option-card {
    display: flex; align-items: center; padding: 14px 16px; gap: 14px;
    background: var(--card); border: 2px solid var(--border);
    border-radius: 14px; cursor: pointer; transition: border-color 0.15s, background 0.15s;
}
.ob-option-card.selected { border-color: var(--brand); background: var(--brand-light); }
.ob-option-check {
    width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--text3);
    margin-left: auto; flex-shrink: 0; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; color: #fff; font-weight: 700;
}
.ob-option-card.selected .ob-option-check { border-color: var(--brand); background: var(--brand); }
.ob-option-title { font-size: 14px; font-weight: 600; color: var(--text); }
.ob-option-sub   { font-size: 12px; color: var(--text2); margin-top: 2px; }

.ob-bank-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.ob-bank-card {
    padding: 14px; background: var(--card); border: 2px solid var(--border);
    border-radius: 14px; text-align: center; cursor: pointer;
    transition: border-color 0.15s, background 0.15s;
}
.ob-bank-card.selected { border-color: var(--brand); background: var(--brand-light); }
.ob-bank-emoji { font-size: 24px; display: block; margin-bottom: 6px; }
.ob-bank-name  { font-size: 13px; font-weight: 700; color: var(--text); }

.ob-trust-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
.ob-trust-badge {
    display: flex; align-items: center; gap: 5px; padding: 5px 10px;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; font-size: 11px; font-weight: 600; color: var(--text2);
}

.ob-step-row {
    display: flex; align-items: center; gap: 12px;
    padding: 13px 0; border-bottom: 1px solid var(--border);
}
.ob-step-row:last-child { border-bottom: none; }
.ob-step-icon {
    width: 28px; height: 28px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 700; flex-shrink: 0;
}
.ob-step-done    { background: var(--green-light); color: var(--green); }
.ob-step-active  { background: var(--brand-light); color: var(--brand); }
.ob-step-pending { background: rgba(255,255,255,0.05); color: var(--text3); }

@keyframes ob-pulse {
    0%,100% { opacity: .3; transform: scale(.85); }
    50%      { opacity: 1;  transform: scale(1);   }
}
.ob-conn-dots span {
    display: inline-block; width: 8px; height: 8px; border-radius: 50%;
    background: var(--brand); margin: 0 3px; animation: ob-pulse 1.4s infinite;
}
.ob-conn-dots span:nth-child(2) { animation-delay: .2s; }
.ob-conn-dots span:nth-child(3) { animation-delay: .4s; }

@keyframes ob-spin { to { transform: rotate(360deg); } }
.ob-spinner {
    width: 48px; height: 48px;
    border: 3px solid var(--border); border-top-color: var(--brand);
    border-radius: 50%; animation: ob-spin 0.9s linear infinite;
}

.ob-reveal-card {
    background: linear-gradient(135deg, var(--hero-start) 0%, var(--card) 65%);
    border: 1px solid rgba(139,126,255,0.3); border-radius: 20px; padding: 18px;
}

</style>
</head>
<body>
<div class="page-wrapper">

<!-- ════════════════════════════════════════════════════════
     SIDEBAR
════════════════════════════════════════════════════════ -->
<div class="sidebar">

    <div class="sidebar-logo">Totem <span>App</span></div>
    <div class="sidebar-tagline">Full app prototype · Click the nav below or use the phone's bottom bar to switch screens.</div>

    <!-- Screen navigator -->
    <div class="sb-section-label">Navigate</div>

    <div class="sb-nav-item active" id="sb-home" onclick="navigate('home')">
        <div class="sb-nav-icon"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
        <span class="sb-nav-label">Home — Dashboard</span>
    </div>
    <div class="sb-nav-item" id="sb-plan" onclick="navigate('plan')">
        <div class="sb-nav-icon"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l7.59-7.59L21 8l-9 9z"/></svg></div>
        <span class="sb-nav-label">Plan — Goals + Budgets</span>
    </div>
    <div class="sb-nav-item" id="sb-calendar" onclick="navigate('calendar')">
        <div class="sb-nav-icon"><svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg></div>
        <span class="sb-nav-label">Calendar</span>
    </div>
    <div class="sb-nav-item" id="sb-accounts" onclick="navigate('accounts')">
        <div class="sb-nav-icon"><svg viewBox="0 0 24 24"><path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zM11.5 1L2 6v2h19V6l-9.5-5z"/></svg></div>
        <span class="sb-nav-label">Accounts</span>
    </div>
    <div class="sb-nav-item" id="sb-insights" onclick="navigate('insights')">
        <div class="sb-nav-icon"><svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg></div>
        <span class="sb-nav-label">Insights</span>
    </div>

    <div class="sb-divider" style="margin:10px 0 12px"></div>
    <div class="sb-section-label">Prototype Flows</div>
    <div class="sb-nav-item" id="sb-onboarding" onclick="showOnboarding()">
        <div class="sb-nav-icon"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg></div>
        <span class="sb-nav-label">Onboarding Flow</span>
    </div>

    <div class="sb-divider"></div>

    <!-- Theme switcher -->
    <div class="sb-section-label">Theme</div>
    <div class="theme-grid">
        <button class="theme-btn active" id="t-midnight" onclick="setTheme('midnight')">
            <div class="theme-swatch" style="background:linear-gradient(135deg,#060B18,#0E1525)"></div>
            <div class="theme-btn-label">Midnight</div>
        </button>
        <button class="theme-btn" id="t-oled" onclick="setTheme('oled')">
            <div class="theme-swatch" style="background:linear-gradient(135deg,#000,#0C0C12)"></div>
            <div class="theme-btn-label">OLED</div>
        </button>
        <button class="theme-btn" id="t-light" onclick="setTheme('light')">
            <div class="theme-swatch" style="background:linear-gradient(135deg,#F0F2F8,#FFFFFF);border:1px solid rgba(0,0,0,0.08)"></div>
            <div class="theme-btn-label">Light</div>
        </button>
    </div>

    <div class="sb-divider"></div>

    <!-- Dynamic notes -->
    <div class="notes-head">Design Notes</div>

    <div class="note-set active" id="notes-home">
        <div class="note-item"><div class="note-dot"></div><p>Mock user: Alex, 26, Melbourne. Fortnightly pay $3,200 net. Day 11 of 14-day cycle. Payday Friday.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Safe to Spend = income − already spent − committed bills before payday − auto-savings.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Burn rate bars show a vertical tick at "where you should be" — the key differentiator from a plain progress bar.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>AI Insight card uses a priority score (dollar impact × urgency × severity). One insight only — no feed.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Use ← → below the phone (or keyboard arrows) to swipe between Dashboard tiers.</p></div>
    </div>
    <div class="note-set" id="notes-plan">
        <div class="note-item"><div class="note-dot"></div><p>3px left-border colour codes goal type instantly: purple=Save Up, teal=Spending Habit, green=Debt Paydown.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Spending Habit is unique to Totem — no other AU/NZ app tracks category spend against a self-set monthly target with streaks.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>The white tick on burn bars shows where spending should be at this point in the month.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Toggle the AI state buttons below the phone. The milestone card → AI suggestion card transition shows the 30-transaction activation flow.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Teal dot on Dining Out in Budgets tab = budget synced with a Spending Habit goal.</p></div>
    </div>
    <div class="note-set" id="notes-calendar">
        <div class="note-item"><div class="note-dot"></div><p>February 2026 — Alex's view. Today = Thu 19 Feb (white circle). Tap any day cell to open the detail drawer.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Safety tinting is Totem's key differentiator: green/amber/red cell backgrounds show spend vs daily discretionary budget — scannable at a glance, absent in all competitors.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Coloured dots = category fingerprint (red=eating out, green=groceries, teal=transport, amber=entertainment). Max 3 per cell.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Purple cells = payday (Feb 8 past, Feb 22 upcoming). Red dots in top-right corner = urgent bill due (Netflix Feb 20, Rent Feb 21). Use ‹ button to view January 2026.</p></div>
    </div>
    <div class="note-set" id="notes-accounts">
        <div class="note-item"><div class="note-dot"></div><p>Net Position hero card = Assets − Debt. Pulsing green dot = live bank feed via Basiq. Tap any account row to open the detail sheet with last 5 transactions.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>To Review tab is the 30-transaction AI activation gate. Alex is at 24/30 (80%). Tap ✓ to collapse a row with a smooth animation; tap ✗ to open the category picker sheet first.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Rules tab shows 8 auto-categorisation rules — 4 user-created (You badge) and 4 AI-detected (✨ AI badge). Toggles are visual-only ON state; trash icon is decorative in the mockup.</p></div>
    </div>
    <div class="note-set" id="notes-insights">
        <div class="note-item"><div class="note-dot"></div><p>Spend tab: category bars are scaled to the highest category (Dining Out $341). Red bar = over 5% of income. Period chips are visual-only in the mockup.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Trends tab: Lifestyle Creep shows full activated state (+6% = spend grew 11% vs income grew 5%). Dec spike in bar charts = holiday season. Safety Net at 2.6 months = amber warning (below 3-month target).</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Income tab: dual bar chart pairs income (brand) vs spend (red) per month. Feb income bar is dashed/partial because only one of two fortnightly pays has landed. Savings breakdown shows goal progress.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Forecast tab: projects Feb month-end surplus ($2,241), 90-day cash flow, goal completion ETAs (Japan May · Safety Net Apr · Car Dec), known upcoming expenses, and 4 AI risk/opportunity flags.</p></div>
    </div>
    <div class="note-set" id="notes-onboarding">
        <div class="note-item"><div class="note-dot"></div><p>8-screen onboarding flow. Screen 1: Welcome — "Explore with sample data" skips to main app immediately. "Get started" begins the full auth flow.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Screen 3: Bank selection — tap any bank card to highlight it. "I'll connect later" also skips to the main app with sample data.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Screen 5→6: "Open ANZ to authorise →" triggers the animated processing sequence — watch the step list animate through all 4 stages before auto-advancing to The Reveal.</p></div>
        <div class="note-item"><div class="note-dot"></div><p>Screen 7: The Reveal shows a mini-preview of the user's real dashboard. Screen 8: "Start reviewing →" exits onboarding and opens Accounts at the To Review tab.</p></div>
    </div>

</div><!-- /sidebar -->


<!-- ════════════════════════════════════════════════════════
     PHONE
════════════════════════════════════════════════════════ -->
<div class="phone-col">
<div class="phone-outer">
<div class="phone-screen">

    <div class="dynamic-island"></div>

    <!-- Persistent status bar -->
    <div class="status-bar">
        <span class="status-time">9:41</span>
        <div class="status-icons">
            <svg width="17" height="12" viewBox="0 0 17 12" fill="rgba(240,244,255,0.9)"><rect x="0" y="3" width="3" height="9" rx="1"/><rect x="4.5" y="1.5" width="3" height="10.5" rx="1"/><rect x="9" y="0" width="3" height="12" rx="1"/><rect x="13.5" y="0" width="3" height="12" rx="1" opacity="0.25"/></svg>
            <svg width="16" height="12" viewBox="0 0 16 12" fill="rgba(240,244,255,0.9)"><path d="M8 2.5C10.2 2.5 12.2 3.4 13.6 4.9L15 3.4C13.2 1.4 10.7 0 8 0S2.8 1.4 1 3.4l1.4 1.5C3.8 3.4 5.8 2.5 8 2.5z"/><path d="M8 5.5c1.5 0 2.8.6 3.8 1.6l1.4-1.5C11.7 3.9 9.9 3 8 3S4.3 3.9 2.8 5.6l1.4 1.5C5.2 6.1 6.5 5.5 8 5.5z"/><circle cx="8" cy="10" r="2"/></svg>
            <svg width="26" height="13" viewBox="0 0 26 13" fill="none"><rect x=".75" y=".75" width="21.5" height="11.5" rx="2.75" stroke="rgba(240,244,255,0.35)" stroke-width="1.5"/><rect x="2" y="2" width="17" height="9" rx="1.5" fill="rgba(240,244,255,0.9)"/><path d="M23.5 4.5v4a2 2 0 000-4z" fill="rgba(240,244,255,0.4)"/></svg>
        </div>
    </div>

    <!-- ══════════════════════════════════════════════
         SCREEN: HOME (Dashboard)
    ══════════════════════════════════════════════ -->
    <div class="app-screen active" id="screen-home">

        <!-- Tier indicator bar -->
        <div class="tier-bar">
            <span class="tier-badge-pill" id="tierBadge">Tier 1 · Overview</span>
            <div class="tier-dots">
                <div class="tdot active" id="d0" onclick="goTo(0)"></div>
                <div class="tdot" id="d1" onclick="goTo(1)"></div>
                <div class="tdot" id="d2" onclick="goTo(2)"></div>
            </div>
        </div>

        <!-- Tier slider -->
        <div class="screen-content">
        <div class="tier-slider" id="slider">

            <!-- ── Tier 1: Overview ── -->
            <div class="tier-panel">
                <div class="dash-header">
                    <div>
                        <div class="greeting">Hey Alex 👋</div>
                        <div class="greeting-date">Wednesday, 19 Feb 2026</div>
                    </div>
                    <div class="avatar" onclick="openProfileSheet()" style="cursor:pointer">AL</div>
                </div>

                <div class="payday-pill">
                    <div class="pay-dot"></div>
                    <div class="pay-text">Payday in <strong>3 days</strong> · ANZ · $3,200</div>
                    <div class="pay-cycle">Day 11 / 14</div>
                </div>

                <div class="hero-card">
                    <div class="hero-label">Safe to Spend</div>
                    <div class="hero-amount"><span class="dollar">$</span>312</div>
                    <div class="hero-sub">until payday · after bills &amp; savings</div>
                    <div class="progress-track" style="margin-bottom:6px">
                        <div class="progress-fill fill-brand" style="width:90%"></div>
                    </div>
                    <div class="progress-labels">
                        <span>$0</span><span>78% of period elapsed</span><span>$3,200</span>
                    </div>
                </div>

                <div class="section-hd"><div class="section-title">This Month</div></div>
                <div class="two-col" style="margin-bottom:0">
                    <div class="metric-card">
                        <div class="metric-label">Month Projection</div>
                        <div class="metric-value" style="color:var(--green)">+$485</div>
                        <div class="badge badge-green" style="margin-top:4px">↑ On Track</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Net So Far</div>
                        <div class="metric-value">+$1,240</div>
                        <div class="metric-sub">income − spent</div>
                    </div>
                </div>

                <div class="section-hd"><div class="section-title">AI Insight</div><div class="section-link">Dismiss</div></div>
                <div class="insight-card">
                    <div class="insight-icon">🍔</div>
                    <div style="flex:1">
                        <div class="insight-tag">⚠ Spending Alert</div>
                        <div class="insight-text">Eating out up 67% vs last month. 4 orders this week — on pace to exceed budget by $87.</div>
                        <div class="insight-cta" onclick="openInsightBreakdown()" style="cursor:pointer">See breakdown →</div>
                    </div>
                </div>

                <div class="section-hd"><div class="section-title">Upcoming</div><div class="section-link" onclick="openUpcomingAll()" style="cursor:pointer">See all</div></div>
                <div class="list-card">
                    <div class="list-item">
                        <div class="list-icon" style="background:rgba(229,9,20,0.12)">📺</div>
                        <div class="list-info"><div class="list-name">Netflix</div><div class="list-sub">Tomorrow · Auto-debit</div></div>
                        <div class="list-right"><div class="list-amount">$18.99</div><div class="list-urgency" style="color:var(--amber)">Tomorrow</div></div>
                    </div>
                    <div class="list-item">
                        <div class="list-icon" style="background:rgba(78,205,196,0.1)">🏠</div>
                        <div class="list-info"><div class="list-name">Rent — REA Group</div><div class="list-sub">Fri 21 Feb · Auto-debit</div></div>
                        <div class="list-right"><div class="list-amount">$1,000</div><div class="list-urgency" style="color:var(--red)">In 2 days</div></div>
                    </div>
                    <div class="list-item">
                        <div class="list-icon" style="background:rgba(29,185,84,0.1)">🎵</div>
                        <div class="list-info"><div class="list-name">Spotify</div><div class="list-sub">Sun 23 Feb · Auto-debit</div></div>
                        <div class="list-right"><div class="list-amount">$12.99</div><div class="list-urgency" style="color:var(--text2)">In 4 days</div></div>
                    </div>
                </div>
            </div><!-- /tier 1 -->

            <!-- ── Tier 2: Financial Health ── -->
            <div class="tier-panel">
                <div class="tier-heading">Financial Health</div>
                <div class="tier-sub">Budget burn rates &amp; wellness metrics</div>

                <div class="section-hd"><div class="section-title">Budget Burn Rate</div><div class="section-link" onclick="navigateToPlanBudgets()" style="cursor:pointer">Edit budgets</div></div>
                <div class="list-card" style="overflow:visible">
                    <div class="burn-item">
                        <div class="burn-top">
                            <div class="burn-cat">🍔 <span>Eating Out</span></div>
                            <div class="burn-right"><div class="burn-spent" style="color:var(--red)">$487</div><div class="burn-budget">of $400</div></div>
                        </div>
                        <div class="progress-wrap">
                            <div class="progress-track overflow-visible"><div class="progress-fill fill-red" style="width:100%"></div></div>
                            <div class="period-marker" style="left:78%"></div>
                        </div>
                        <div class="burn-bottom"><div class="badge badge-red">Over Budget · $87 over</div><div class="burn-pct">122%</div></div>
                    </div>
                    <div class="burn-item">
                        <div class="burn-top">
                            <div class="burn-cat">🛒 <span>Groceries</span></div>
                            <div class="burn-right"><div class="burn-spent">$210</div><div class="burn-budget">of $280</div></div>
                        </div>
                        <div class="progress-wrap">
                            <div class="progress-track overflow-visible"><div class="progress-fill fill-amber" style="width:75%"></div></div>
                            <div class="period-marker" style="left:78%"></div>
                        </div>
                        <div class="burn-bottom"><div class="badge badge-amber">At Risk · on pace to overspend</div><div class="burn-pct">75%</div></div>
                    </div>
                    <div class="burn-item">
                        <div class="burn-top">
                            <div class="burn-cat">🚗 <span>Transport</span></div>
                            <div class="burn-right"><div class="burn-spent">$54</div><div class="burn-budget">of $150</div></div>
                        </div>
                        <div class="progress-wrap">
                            <div class="progress-track overflow-visible"><div class="progress-fill fill-green" style="width:36%"></div></div>
                            <div class="period-marker" style="left:78%"></div>
                        </div>
                        <div class="burn-bottom"><div class="badge badge-green">On Track</div><div class="burn-pct">36%</div></div>
                    </div>
                    <div class="burn-item">
                        <div class="burn-top">
                            <div class="burn-cat">🎭 <span>Entertainment</span></div>
                            <div class="burn-right"><div class="burn-spent">$92</div><div class="burn-budget">of $100</div></div>
                        </div>
                        <div class="progress-wrap">
                            <div class="progress-track overflow-visible"><div class="progress-fill fill-amber" style="width:92%"></div></div>
                            <div class="period-marker" style="left:78%"></div>
                        </div>
                        <div class="burn-bottom"><div class="badge badge-amber">At Risk · $8 remaining</div><div class="burn-pct">92%</div></div>
                    </div>
                </div>

                <div class="section-hd"><div class="section-title">Subscription Load</div><div class="section-link" onclick="navigateToAcctSubs()" style="cursor:pointer">Manage</div></div>
                <div class="sub-card">
                    <div class="sub-top">
                        <div><div class="sub-head-label">Active Subscriptions</div><div class="sub-count">11 <span>active</span></div></div>
                        <div class="badge badge-amber">+2 vs last year</div>
                    </div>
                    <div class="sub-grid">
                        <div class="sub-metric"><div class="sub-metric-label">Per Month</div><div class="sub-metric-value" style="color:var(--teal)">$287</div></div>
                        <div class="sub-metric"><div class="sub-metric-label">Annualised</div><div class="sub-metric-value" style="color:var(--amber)">$3,444</div></div>
                    </div>
                </div>

                <div class="section-hd"><div class="section-title">Wellness Metrics</div></div>
                <div class="health-pair">
                    <div class="health-card">
                        <div class="health-icon">🛡️</div>
                        <div class="health-label">Safety Net</div>
                        <div class="health-value">2.6</div>
                        <div class="health-unit">months runway</div>
                        <div class="badge badge-amber" style="margin-top:8px">Below 3mo target</div>
                    </div>
                    <div class="health-card">
                        <div class="health-icon">🚀</div>
                        <div class="health-label">Savings Velocity</div>
                        <div class="health-value">18%</div>
                        <div class="health-unit">avg of paycheck</div>
                        <div class="badge badge-green" style="margin-top:8px">↑ Up from 14%</div>
                    </div>
                </div>
            </div><!-- /tier 2 -->

            <!-- ── Tier 3: Trends ── -->
            <div class="tier-panel">
                <div class="tier-heading">Trends &amp; Patterns</div>
                <div class="tier-sub">Builds over time as we learn your finances</div>

                <div class="section-hd"><div class="section-title">Lifestyle Creep</div><div class="section-link">Learn more</div></div>
                <div class="creep-card">
                    <div class="creep-top">
                        <div><div class="creep-building-label">Building Baseline</div><div class="creep-status">2 of 3 months complete</div></div>
                        <div style="font-size:32px">📈</div>
                    </div>
                    <div class="progress-track" style="margin-bottom:10px"><div class="progress-fill fill-brand" style="width:67%"></div></div>
                    <div class="creep-desc">We'll compare your 3-month average against your 12-month average to detect whether your lifestyle is inflating faster than your income. <strong>1 month to go.</strong></div>
                </div>

                <div class="section-hd"><div class="section-title">Spend as % of Income</div><div class="section-link">Feb 2026</div></div>
                <div class="list-card">
                    <div style="padding:12px 16px 8px;border-bottom:1px solid var(--border)">
                        <div style="font-size:12px;font-weight:600;color:var(--text)">Top categories · February 2026</div>
                        <div style="font-size:11px;color:var(--text2);margin-top:2px">Based on $6,400 monthly income</div>
                    </div>
                    <div class="cat-item"><span class="cat-emoji">🏠</span><span class="cat-name">Housing</span><div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:62%"></div></div><div class="cat-avg-line" style="left:62%" title="12mo avg: 31%"></div></div><span class="cat-pct">31%</span></div>
                    <div class="cat-item"><span class="cat-emoji">🛒</span><span class="cat-name">Groceries</span><div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:26%"></div></div><div class="cat-avg-line" style="left:26%" title="12mo avg: 13%"></div></div><span class="cat-pct">13%</span></div>
                    <div class="cat-item"><span class="cat-emoji">🍔</span><span class="cat-name">Eating Out</span><div class="cat-bar"><div class="cat-track"><div class="cat-fill" style="width:20%;background:var(--red)"></div></div><div class="cat-avg-line" style="left:12%" title="12mo avg: 6%"></div></div><span class="cat-pct" style="color:var(--red)">10%</span></div>
                    <div class="cat-item"><span class="cat-emoji">📱</span><span class="cat-name">Subscriptions</span><div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:13%"></div></div><div class="cat-avg-line" style="left:10%" title="12mo avg: 5%"></div></div><span class="cat-pct">6%</span></div>
                    <div class="cat-item"><span class="cat-emoji">🚗</span><span class="cat-name">Transport</span><div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:10%"></div></div><div class="cat-avg-line" style="left:12%" title="12mo avg: 6%"></div></div><span class="cat-pct">5%</span></div>
                </div>

                <div class="section-hd"><div class="section-title">Savings Rate Trend</div><div class="section-link">4 months</div></div>
                <div class="metric-card">
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px">
                        <div>
                            <div class="metric-label">Avg Savings Rate</div>
                            <div class="metric-value">18%</div>
                            <div class="badge badge-green" style="margin-top:4px">↑ +4% vs 3mo ago</div>
                        </div>
                        <div style="text-align:right">
                            <div class="metric-label">3-Month Total</div>
                            <div class="metric-value">$3,840</div>
                            <div class="metric-sub">Goal: $5,000</div>
                        </div>
                    </div>
                    <div class="mini-chart">
                        <div class="mini-bar-wrap"><div class="mini-bar" style="height:22px;background:rgba(124,110,250,0.25)"></div><span class="mini-label">Nov</span></div>
                        <div class="mini-bar-wrap"><div class="mini-bar" style="height:28px;background:rgba(124,110,250,0.4)"></div><span class="mini-label">Dec</span></div>
                        <div class="mini-bar-wrap"><div class="mini-bar" style="height:32px;background:rgba(124,110,250,0.6)"></div><span class="mini-label">Jan</span></div>
                        <div class="mini-bar-wrap"><div class="mini-bar" style="height:40px;background:var(--brand)"></div><span class="mini-label active">Feb</span></div>
                    </div>
                </div>
            </div><!-- /tier 3 -->

        </div><!-- /tier-slider -->
        </div><!-- /screen-content -->
    </div><!-- /screen-home -->


    <!-- ══════════════════════════════════════════════
         SCREEN: PLAN (Goals + Budgets)
    ══════════════════════════════════════════════ -->
    <div class="app-screen" id="screen-plan">

        <div class="screen-header">
            <span class="screen-title">Plan</span>
            <span class="header-action" onclick="openSheet()">+ Add Goal</span>
        </div>

        <div class="subtab-bar">
            <div class="subtab active" id="plan-tab-goals" onclick="switchPlanTab('goals')">Goals</div>
            <div class="subtab" id="plan-tab-budgets" onclick="switchPlanTab('budgets')">Budgets</div>
        </div>

        <div class="tab-scroll">

            <!-- Goals pane -->
            <div class="tab-pane active" id="plan-pane-goals">

                <!-- 30-transaction milestone (default state) -->
                <div id="plan-milestone" class="milestone-card">
                    <div class="milestone-top">
                        <div class="milestone-icon">🤖</div>
                        <div>
                            <div class="ai-tag">Totem AI</div>
                            <div class="milestone-title">Activate AI Goal Suggestions</div>
                        </div>
                    </div>
                    <div class="milestone-bar-track">
                        <div class="milestone-bar-fill" style="width:73%"></div>
                    </div>
                    <div class="milestone-labels">
                        <span class="ms-lbl-left">22 of 30 transactions reviewed</span>
                        <span class="ms-lbl-right">8 more to go</span>
                    </div>
                    <div class="milestone-sub">Review transactions so Totem AI can learn your patterns and suggest personalised goals.</div>
                    <span class="milestone-cta" onclick="navigate('accounts')">Go to Review →</span>
                </div>

                <!-- AI suggestion card (shown when AI active) -->
                <div id="plan-ai-suggestion" class="plan-ai-card">
                    <div class="ai-card-top">
                        <div class="ai-card-icon">✨</div>
                        <div>
                            <div class="ai-tag">Totem AI</div>
                            <div class="ai-card-type">Spending Habit Goal</div>
                        </div>
                    </div>
                    <div class="ai-insight-text">Your Dining Out spend has risen 38% over the last 3 months 📈</div>
                    <div class="ai-preview-text">Based on $620/mo avg → $496/mo target (−20%)<br>Save approx. <strong style="color:var(--teal)">$124/mo</strong> if you hit this goal</div>
                    <div class="ai-actions">
                        <button class="btn-primary">Review Suggestion</button>
                        <button class="btn-ghost">Not Now</button>
                    </div>
                </div>

                <!-- Pending deposit allocation card -->
                <div class="plan-alloc-card" onclick="openGoalAlloc('deposit',300)">
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                        <div class="plan-alloc-icon">💰</div>
                        <div>
                            <div style="font-size:11px;font-weight:700;color:var(--brand);text-transform:uppercase;letter-spacing:0.5px;">New Deposit Detected</div>
                            <div style="font-size:14px;font-weight:700;color:var(--text);">Allocate $300 to a goal</div>
                        </div>
                        <span style="font-size:20px;margin-left:auto;color:var(--brand)">›</span>
                    </div>
                    <div style="font-size:12px;color:var(--text2);line-height:1.5;">You transferred <strong style="color:var(--text)">$300</strong> to ANZ NetSaver on <strong style="color:var(--text)">Thu 19 Feb</strong>. Which goal should this go toward?</div>
                </div>

                <div class="section-hd"><div class="section-title">Active Goals · 3</div></div>

                <!-- Save Up: Japan Trip -->
                <div class="goal-card gc-save" onclick="openGoalDetail('japan')" style="cursor:pointer">
                    <div class="goal-header">
                        <div class="goal-header-left">
                            <div class="goal-icon">🏖️</div>
                            <div><div class="goal-name">Japan Trip</div><div class="goal-type-label">Save Up Goal</div></div>
                        </div>
                        <span class="badge badge-green">On Track</span>
                    </div>
                    <div class="goal-amounts">
                        <div class="goal-amount-main">$2,840 <span class="unit">of $5,000</span></div>
                        <div class="goal-pct-brand">57%</div>
                    </div>
                    <div class="progress-track"><div class="progress-fill fill-brand" style="width:57%"></div></div>
                    <div class="goal-footer">
                        <div><div class="goal-footer-lbl">Projected completion</div><div class="goal-footer-val">August 2025 · 6 months</div></div>
                    </div>
                    <div class="inline-pill">↻ Auto-transfer: $300/mo · next 1 Mar</div>
                </div>

                <!-- Spending Habit: Dining Out -->
                <div class="goal-card gc-spend" onclick="openGoalDetail('dining')" style="cursor:pointer">
                    <div class="goal-header">
                        <div class="goal-header-left">
                            <div class="goal-icon">🍔</div>
                            <div><div class="goal-name">Dining Out</div><div class="goal-type-label">Spending Habit</div></div>
                        </div>
                        <span class="badge badge-amber">At Risk</span>
                    </div>
                    <div class="goal-amounts">
                        <div class="goal-amount-main" style="color:var(--amber)">$341 <span class="unit" style="color:var(--text2)">of $464/mo</span></div>
                        <div class="goal-pct-teal">73%</div>
                    </div>
                    <div class="progress-track overflow-visible" style="position:relative">
                        <div class="period-marker" style="left:68%"></div>
                        <div class="progress-fill fill-amber" style="width:73%"></div>
                    </div>
                    <div class="bar-labels">
                        <span class="bar-lbl">19 Feb · 8 days left</span>
                        <span class="bar-val-red">−$123 over pace</span>
                    </div>
                    <div class="streak-row">
                        <span>🔥</span>
                        <span class="streak-text-amber">3 months in a row</span>
                        <span class="streak-best">Best: 3</span>
                    </div>
                </div>

                <!-- Debt Paydown: ANZ Visa -->
                <div class="goal-card gc-debt" onclick="openGoalDetail('visa')" style="cursor:pointer">
                    <div class="goal-header">
                        <div class="goal-header-left">
                            <div class="goal-icon">💳</div>
                            <div><div class="goal-name">ANZ Visa</div><div class="goal-type-label">Debt Paydown</div></div>
                        </div>
                        <span class="badge badge-green">Ahead</span>
                    </div>
                    <div class="goal-amounts">
                        <div class="goal-amount-main" style="color:var(--green)">$2,150 <span class="unit">paid off</span></div>
                        <div class="goal-pct-green">43%</div>
                    </div>
                    <div class="progress-track"><div class="progress-fill fill-teal" style="width:43%;background:var(--green)"></div></div>
                    <div class="bar-labels">
                        <span class="bar-lbl">$2,850 remaining</span>
                        <span class="bar-val-green">+2 months ahead</span>
                    </div>
                    <div class="goal-footer" style="margin-top:10px">
                        <div><div class="goal-footer-lbl">Projected payoff</div><div class="goal-footer-val">December 2025</div></div>
                    </div>
                    <div class="inline-pill inline-pill-green">💰 Saving ~$380 in interest vs. minimums</div>
                </div>

                <button class="add-btn" onclick="openSheet()"><span>+</span> Add Goal</button>

                <!-- Completed section -->
                <div class="completed-toggle" onclick="toggleCompleted()">
                    <span class="completed-label">Completed</span>
                    <span class="completed-count">2 goals</span>
                    <span class="completed-chevron" id="completed-chevron">▼</span>
                </div>
                <div class="completed-goals" id="completed-goals">
                    <div class="goal-card gc-save gc-completed">
                        <div class="goal-header">
                            <div class="goal-header-left">
                                <div class="goal-icon">🎮</div>
                                <div><div class="goal-name">New PC</div><div class="goal-type-label">Save Up Goal</div></div>
                            </div>
                            <span class="badge badge-green">Completed</span>
                        </div>
                        <div class="progress-track"><div class="progress-fill fill-brand" style="width:100%"></div></div>
                        <div class="goal-footer" style="margin-top:8px">
                            <div class="goal-footer-lbl">Completed 14 Jan 2025 · $2,200 saved</div>
                        </div>
                    </div>
                    <div class="goal-card gc-debt gc-completed">
                        <div class="goal-header">
                            <div class="goal-header-left">
                                <div class="goal-icon">🚗</div>
                                <div><div class="goal-name">Car Loan</div><div class="goal-type-label">Debt Paydown</div></div>
                            </div>
                            <span class="badge badge-green">Completed</span>
                        </div>
                        <div class="progress-track"><div class="progress-fill" style="width:100%;background:var(--green)"></div></div>
                        <div class="goal-footer" style="margin-top:8px">
                            <div class="goal-footer-lbl">Paid off Sep 2024 · $8,400 cleared · saved $1,240 in interest</div>
                        </div>
                    </div>
                </div>

            </div><!-- /goals pane -->

            <!-- Budgets pane -->
            <div class="tab-pane" id="plan-pane-budgets">

                <div class="period-banner">
                    <span class="period-day">Day 19 of February</span>
                    <span class="period-pct">68% of month elapsed</span>
                </div>

                <div class="budget-summary">
                    <div class="bsc"><div class="bsc-label">Total Budgeted</div><div class="bsc-amount">$3,050</div></div>
                    <div class="bsc"><div class="bsc-label">Spent This Month</div><div class="bsc-amount" style="color:var(--amber)">$2,190</div></div>
                </div>

                <div class="section-hd"><div class="section-title">Budgets · 5 active</div></div>

                <div class="budget-list">
                    <div class="budget-row" onclick="openBudgetDetail('groceries')" style="cursor:pointer">
                        <div class="budget-row-top">
                            <div class="budget-cat"><span>🛒</span> Groceries</div>
                            <div class="budget-amounts"><span class="budget-spent">$412</span><span class="budget-limit">/ $600</span></div>
                        </div>
                        <div class="progress-track overflow-visible" style="position:relative"><div class="period-marker" style="left:68%"></div><div class="progress-fill fill-green" style="width:69%"></div></div>
                        <div class="budget-row-bottom"><span class="badge badge-green">On Track</span><span class="budget-pct">69%</span></div>
                    </div>
                    <div class="budget-row" onclick="openBudgetDetail('dining')" style="cursor:pointer">
                        <div class="budget-row-top">
                            <div class="budget-cat"><span>🍔</span> Dining Out <div class="budget-goal-dot" title="Synced with Dining Out goal"></div></div>
                            <div class="budget-amounts"><span class="budget-spent">$341</span><span class="budget-limit">/ $464</span></div>
                        </div>
                        <div class="progress-track overflow-visible" style="position:relative"><div class="period-marker" style="left:68%"></div><div class="progress-fill fill-amber" style="width:73%"></div></div>
                        <div class="budget-row-bottom"><span class="badge badge-amber">At Risk</span><span class="budget-pct">73%</span></div>
                    </div>
                    <div class="budget-row" onclick="openBudgetDetail('entertainment')" style="cursor:pointer">
                        <div class="budget-row-top">
                            <div class="budget-cat"><span>🎬</span> Entertainment</div>
                            <div class="budget-amounts"><span class="budget-spent">$60</span><span class="budget-limit">/ $150</span></div>
                        </div>
                        <div class="progress-track overflow-visible" style="position:relative"><div class="period-marker" style="left:68%"></div><div class="progress-fill fill-green" style="width:40%"></div></div>
                        <div class="budget-row-bottom"><span class="badge badge-green">On Track</span><span class="budget-pct">40%</span></div>
                    </div>
                    <div class="budget-row" onclick="openBudgetDetail('transport')" style="cursor:pointer">
                        <div class="budget-row-top">
                            <div class="budget-cat"><span>🚗</span> Transport</div>
                            <div class="budget-amounts"><span class="budget-spent" style="color:var(--red)">$290</span><span class="budget-limit">/ $250</span></div>
                        </div>
                        <div class="progress-track overflow-visible" style="position:relative"><div class="period-marker" style="left:68%"></div><div class="progress-fill fill-red" style="width:100%"></div></div>
                        <div class="budget-row-bottom"><span class="badge badge-red">Over Budget</span><span class="budget-pct" style="color:var(--red)">116%</span></div>
                    </div>
                    <div class="budget-row" onclick="openBudgetDetail('shopping')" style="cursor:pointer">
                        <div class="budget-row-top">
                            <div class="budget-cat"><span>🛍️</span> Shopping</div>
                            <div class="budget-amounts"><span class="budget-spent">$375</span><span class="budget-limit">/ $500</span></div>
                        </div>
                        <div class="progress-track overflow-visible" style="position:relative"><div class="period-marker" style="left:68%"></div><div class="progress-fill fill-green" style="width:75%"></div></div>
                        <div class="budget-row-bottom"><span class="badge badge-green">On Track</span><span class="budget-pct">75%</span></div>
                    </div>
                </div>

                <div class="inline-pill inline-pill-teal" style="margin-bottom:12px">⟷ Dining Out budget is synced with your Spending Habit goal</div>
                <button class="add-btn" onclick="openAddBudget()">+ Add Budget</button>

            </div><!-- /budgets pane -->

        </div><!-- /tab-scroll -->
    </div><!-- /screen-plan -->


    <!-- ══════════════════════════════════════════════
         SCREEN: CALENDAR
    ══════════════════════════════════════════════ -->
    <div class="app-screen" id="screen-calendar">

        <!-- Header -->
        <div class="screen-header" style="padding-bottom:4px">
            <span class="screen-title">Calendar</span>
            <span class="header-action" id="cal-today-btn" style="display:none" onclick="calJumpToday()">Today</span>
        </div>

        <!-- Month navigation -->
        <div class="cal-month-nav">
            <button class="cal-nav-btn" id="cal-prev-btn" onclick="calChangeMonth(-1)">‹</button>
            <div class="cal-month-title" id="cal-month-title">February 2026</div>
            <button class="cal-nav-btn" id="cal-next-btn" onclick="calChangeMonth(1)" disabled>›</button>
        </div>

        <!-- Summary strip -->
        <div class="cal-summary-strip">
            <div class="cal-sum-cell">
                <div class="cal-sum-label">Spent</div>
                <div class="cal-sum-value" id="cal-sum-spent">$1,157</div>
            </div>
            <div class="cal-sum-cell">
                <div class="cal-sum-label" id="cal-sum-vs-label">vs Last Mo.</div>
                <div class="cal-sum-value" id="cal-sum-vs" style="color:var(--red)">+8%</div>
            </div>
            <div class="cal-sum-cell">
                <div class="cal-sum-label" id="cal-sum-days-label">Days Left</div>
                <div class="cal-sum-value" id="cal-sum-days">9</div>
            </div>
        </div>

        <!-- View toggle: Month | Week | Day -->
        <div class="cal-view-bar">
            <div class="cal-view-seg">
                <button class="cal-view-btn active" id="cal-btn-month" onclick="calSetView('month')">Month</button>
                <button class="cal-view-btn" id="cal-btn-week" onclick="calSetView('week')">Week</button>
                <button class="cal-view-btn" id="cal-btn-day" onclick="calSetView('day')">Day</button>
            </div>
        </div>

        <!-- Weekday headers (hidden in Day view) -->
        <div class="cal-weekdays" id="cal-weekdays">
            <div class="cal-weekday">Sun</div>
            <div class="cal-weekday">Mon</div>
            <div class="cal-weekday">Tue</div>
            <div class="cal-weekday">Wed</div>
            <div class="cal-weekday">Thu</div>
            <div class="cal-weekday">Fri</div>
            <div class="cal-weekday">Sat</div>
        </div>

        <!-- Calendar grid — February 2026
             Feb 1 = Sunday → 4 perfect rows, no leading blanks
        -->
        <div class="cal-grid" id="cal-grid">

            <!-- ── Row 1: Feb 1–7 ── -->
            <div class="cal-day tint-g" id="cal-day-1" onclick="calSelectDay(1)">
                <div class="cal-date-num">1</div>
                <div class="cal-amount">$45</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--green)"></div>
                    <div class="cal-dot" style="background:var(--teal)"></div>
                </div>
            </div>
            <div class="cal-day tint-g" id="cal-day-2" onclick="calSelectDay(2)">
                <div class="cal-date-num">2</div>
                <div class="cal-amount">$28</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day" id="cal-day-3" onclick="calSelectDay(3)">
                <div class="cal-date-num">3</div>
            </div>
            <div class="cal-day tint-a" id="cal-day-4" onclick="calSelectDay(4)">
                <div class="cal-date-num">4</div>
                <div class="cal-amount">$87</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                    <div class="cal-dot" style="background:var(--green)"></div>
                </div>
            </div>
            <div class="cal-day tint-g" id="cal-day-5" onclick="calSelectDay(5)">
                <div class="cal-date-num">5</div>
                <div class="cal-amount">$18</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--teal)"></div>
                </div>
            </div>
            <div class="cal-day tint-a" id="cal-day-6" onclick="calSelectDay(6)">
                <div class="cal-date-num">6</div>
                <div class="cal-amount">$74</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--amber)"></div>
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-r" id="cal-day-7" onclick="calSelectDay(7)">
                <div class="cal-date-num">7</div>
                <div class="cal-amount">$156</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--green)"></div>
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>

            <!-- ── Row 2: Feb 8–14 (Feb 8 = Payday) ── -->
            <div class="cal-day tint-p" id="cal-day-8" onclick="calSelectDay(8)">
                <div class="cal-date-num">8</div>
                <div class="cal-payday-tag">Pay</div>
                <div class="cal-amount income">+$3,166</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--green)"></div>
                </div>
            </div>
            <div class="cal-day tint-g" id="cal-day-9" onclick="calSelectDay(9)">
                <div class="cal-date-num">9</div>
                <div class="cal-amount">$28</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--green)"></div>
                </div>
            </div>
            <div class="cal-day tint-a" id="cal-day-10" onclick="calSelectDay(10)">
                <div class="cal-date-num">10</div>
                <div class="cal-amount">$52</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-g" id="cal-day-11" onclick="calSelectDay(11)">
                <div class="cal-date-num">11</div>
                <div class="cal-amount">$35</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--green)"></div>
                    <div class="cal-dot" style="background:var(--teal)"></div>
                </div>
            </div>
            <div class="cal-day tint-r" id="cal-day-12" onclick="calSelectDay(12)">
                <div class="cal-date-num">12</div>
                <div class="cal-amount">$98</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-a" id="cal-day-13" onclick="calSelectDay(13)">
                <div class="cal-date-num">13</div>
                <div class="cal-amount">$67</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--amber)"></div>
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-r" id="cal-day-14" onclick="calSelectDay(14)">
                <div class="cal-date-num">14</div>
                <div class="cal-amount">$180</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                    <div class="cal-dot" style="background:var(--amber)"></div>
                </div>
            </div>

            <!-- ── Row 3: Feb 15–21 (Feb 20 Netflix, Feb 21 Rent, Feb 19 = TODAY) ── -->
            <div class="cal-day tint-a" id="cal-day-15" onclick="calSelectDay(15)">
                <div class="cal-date-num">15</div>
                <div class="cal-amount">$56</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--green)"></div>
                </div>
            </div>
            <div class="cal-day tint-g" id="cal-day-16" onclick="calSelectDay(16)">
                <div class="cal-date-num">16</div>
                <div class="cal-amount">$12</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-g" id="cal-day-17" onclick="calSelectDay(17)">
                <div class="cal-date-num">17</div>
                <div class="cal-amount">$44</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-r" id="cal-day-18" onclick="calSelectDay(18)">
                <div class="cal-date-num">18</div>
                <div class="cal-amount">$89</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                </div>
            </div>
            <div class="cal-day tint-a is-today" id="cal-day-19" onclick="calSelectDay(19)">
                <div class="cal-date-num">19</div>
                <div class="cal-amount">$54</div>
                <div class="cal-dots">
                    <div class="cal-dot" style="background:var(--red)"></div>
                    <div class="cal-dot" style="background:var(--teal)"></div>
                </div>
            </div>
            <div class="cal-day future" id="cal-day-20" onclick="calSelectDay(20)">
                <div class="cal-date-num">20</div>
                <div class="cal-bill-flag urgent"></div>
            </div>
            <div class="cal-day future" id="cal-day-21" onclick="calSelectDay(21)">
                <div class="cal-date-num">21</div>
                <div class="cal-bill-flag urgent"></div>
            </div>

            <!-- ── Row 4: Feb 22–28 (Feb 22 = Next Payday + Spotify bill) ── -->
            <div class="cal-day tint-p future" id="cal-day-22" onclick="calSelectDay(22)">
                <div class="cal-date-num">22</div>
                <div class="cal-payday-tag">Pay</div>
                <div class="cal-bill-flag"></div>
            </div>
            <div class="cal-day future" id="cal-day-23" onclick="calSelectDay(23)">
                <div class="cal-date-num">23</div>
            </div>
            <div class="cal-day future" id="cal-day-24" onclick="calSelectDay(24)">
                <div class="cal-date-num">24</div>
            </div>
            <div class="cal-day future" id="cal-day-25" onclick="calSelectDay(25)">
                <div class="cal-date-num">25</div>
            </div>
            <div class="cal-day future" id="cal-day-26" onclick="calSelectDay(26)">
                <div class="cal-date-num">26</div>
            </div>
            <div class="cal-day future" id="cal-day-27" onclick="calSelectDay(27)">
                <div class="cal-date-num">27</div>
            </div>
            <div class="cal-day future" id="cal-day-28" onclick="calSelectDay(28)">
                <div class="cal-date-num">28</div>
            </div>

        </div><!-- /cal-grid -->

        <!-- ── Week list: dynamically rendered by renderCalWeek() ── -->
        <div class="cal-week-list" id="cal-week-grid"></div>

        <!-- ── Day view: inline transaction list ── -->
        <div class="cal-day-view" id="cal-day-view">
            <div class="cal-day-content" id="cal-day-content"></div>
        </div><!-- /cal-day-view -->

        <!-- Legend (hidden in Day view) -->
        <div class="cal-legend" id="cal-legend">
            <div class="cal-legend-item">
                <div class="cal-legend-swatch" style="background:rgba(81,207,102,0.25)"></div>
                Under
            </div>
            <div class="cal-legend-item">
                <div class="cal-legend-swatch" style="background:rgba(247,200,75,0.25)"></div>
                On pace
            </div>
            <div class="cal-legend-item">
                <div class="cal-legend-swatch" style="background:rgba(255,107,107,0.25)"></div>
                Over
            </div>
            <div class="cal-legend-item">
                <div class="cal-legend-swatch" style="background:rgba(139,126,255,0.25)"></div>
                Payday
            </div>
        </div>

    </div><!-- /screen-calendar -->

    <!-- ══════════════════════════════════════════════
         SCREEN: ACCOUNTS (placeholder)
    ══════════════════════════════════════════════ -->
    <!-- ══════════════════════════════════════════════
         SCREEN: ACCOUNTS
    ══════════════════════════════════════════════ -->
    <div class="app-screen" id="screen-accounts">

        <div class="screen-header">
            <div class="screen-title">Accounts</div>
            <div class="header-action" id="acct-header-action" onclick="">Sync ↺</div>
        </div>

        <div class="subtab-bar">
            <div class="subtab active" id="acct-tab-accounts" onclick="switchAcctTab('accounts')">Accounts</div>
            <div class="subtab"        id="acct-tab-review"   onclick="switchAcctTab('review')">To Review</div>
            <div class="subtab"        id="acct-tab-rules"    onclick="switchAcctTab('rules')">Rules</div>
            <div class="subtab"        id="acct-tab-subs"     onclick="switchAcctTab('subs')">Subs</div>
        </div>

        <div class="tab-scroll">

            <!-- ─── ACCOUNTS PANE ─── -->
            <div class="tab-pane active" id="acct-pane-accounts">

                <!-- Net position hero card -->
                <div class="acct-net-card">
                    <div class="acct-net-label">Net Position</div>
                    <div class="acct-net-amount">+$13,454</div>
                    <div class="acct-net-grid">
                        <div class="acct-net-cell">
                            <div class="acct-net-cell-label">Assets</div>
                            <div class="acct-net-cell-val">$14,297</div>
                        </div>
                        <div class="acct-net-cell">
                            <div class="acct-net-cell-label">Debt</div>
                            <div class="acct-net-cell-val" style="color:var(--red)">$843</div>
                        </div>
                    </div>
                </div>

                <div class="section-hd">
                    <div class="section-title">Linked Accounts · 3</div>
                </div>

                <div class="list-card">
                    <!-- ANZ Everyday -->
                    <div class="list-item" onclick="openAcctDetail('ANZ Everyday')" style="cursor:pointer">
                        <div class="list-icon" style="background:rgba(0,160,100,0.12);font-size:18px">🏦</div>
                        <div style="flex:1;min-width:0">
                            <div style="display:flex;align-items:center;gap:7px;margin-bottom:2px">
                                <span style="font-size:14px;font-weight:600;color:var(--text)">ANZ Everyday</span>
                                <span class="badge badge-muted">Cheque</span>
                            </div>
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-live-dot"></span>
                                <span style="font-size:11px;color:var(--text3)">Live · synced just now</span>
                            </div>
                        </div>
                        <div style="text-align:right;flex-shrink:0">
                            <div style="font-size:16px;font-weight:700;color:var(--text)">$1,847</div>
                            <div style="font-size:10px;color:var(--text3)">available</div>
                        </div>
                    </div>

                    <!-- ANZ NetSaver -->
                    <div class="list-item" onclick="openAcctDetail('ANZ NetSaver')" style="cursor:pointer">
                        <div class="list-icon" style="background:rgba(0,160,100,0.12);font-size:18px">💰</div>
                        <div style="flex:1;min-width:0">
                            <div style="display:flex;align-items:center;gap:7px;margin-bottom:2px">
                                <span style="font-size:14px;font-weight:600;color:var(--text)">ANZ NetSaver</span>
                                <span class="badge badge-green">Savings</span>
                            </div>
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-live-dot"></span>
                                <span style="font-size:11px;color:var(--text3)">Live · synced 2 min ago</span>
                            </div>
                        </div>
                        <div style="text-align:right;flex-shrink:0">
                            <div style="font-size:16px;font-weight:700;color:var(--green)">$12,450</div>
                            <div style="font-size:10px;color:var(--text3)">3.75% p.a.</div>
                        </div>
                    </div>

                    <!-- ANZ Credit Visa -->
                    <div class="list-item" onclick="openAcctDetail('ANZ Credit Visa')" style="cursor:pointer">
                        <div class="list-icon" style="background:rgba(255,107,107,0.12);font-size:18px">💳</div>
                        <div style="flex:1;min-width:0">
                            <div style="display:flex;align-items:center;gap:7px;margin-bottom:2px">
                                <span style="font-size:14px;font-weight:600;color:var(--text)">ANZ Credit Visa</span>
                                <span class="badge badge-red">Credit</span>
                            </div>
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-live-dot"></span>
                                <span style="font-size:11px;color:var(--text3)">Live · synced 2 min ago</span>
                            </div>
                        </div>
                        <div style="text-align:right;flex-shrink:0">
                            <div style="font-size:16px;font-weight:700;color:var(--red)">−$843</div>
                            <div style="font-size:10px;color:var(--text3)">due Mar 5</div>
                        </div>
                    </div>
                </div>

                <button class="acct-link-btn">+ Link New Account</button>

            </div><!-- /acct-pane-accounts -->

            <!-- ─── TO REVIEW PANE ─── -->
            <div class="tab-pane" id="acct-pane-review">

                <!-- Milestone banner -->
                <div class="acct-milestone-banner">
                    <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:2px">
                        <div class="acct-milestone-title">AI Activation Progress</div>
                        <div style="font-size:13px;font-weight:700;color:var(--brand)" id="acct-milestone-count">24 / 30</div>
                    </div>
                    <div class="acct-milestone-sub" id="acct-milestone-sub">Review 6 more transactions to unlock AI insights &amp; goal suggestions</div>
                    <div class="progress-track" style="margin-top:4px">
                        <div class="progress-fill fill-brand" id="acct-milestone-bar" style="width:80%"></div>
                    </div>
                </div>

                <!-- Review list -->
                <div class="list-card" id="acct-review-list">

                    <!-- Transaction 1 -->
                    <div class="acct-review-item" id="acct-txn-1">
                        <div class="acct-review-inner">
                            <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:16px;flex-shrink:0">⛽</div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:baseline;justify-content:space-between;gap:8px">
                                    <span style="font-size:13px;font-weight:600;color:var(--text)">Shell Coles Express</span>
                                    <span style="font-size:14px;font-weight:700;color:var(--red);flex-shrink:0">−$68.40</span>
                                </div>
                                <div style="font-size:11px;color:var(--text3);margin:2px 0 6px">Feb 19 · Fuel</div>
                                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                                    <span class="acct-ai-pill acct-pill-tap" id="acct-pill-1" onclick="changeCatForTxn('acct-txn-1','Shell Coles Express')">✨ Transport ▾</span>
                                    <span class="acct-conf-high">High confidence</span>
                                </div>
                            </div>
                        </div>
                        <div class="acct-review-actions">
                            <button class="acct-rule-btn" onclick="openRuleSheet('acct-txn-1','Shell Coles Express','Transport')">⚡ Create Rule</button>
                            <button class="acct-approve-btn" onclick="approveTransaction('acct-txn-1')">Approve ✓</button>
                        </div>
                    </div>

                    <!-- Transaction 2 -->
                    <div class="acct-review-item" id="acct-txn-2">
                        <div class="acct-review-inner">
                            <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:16px;flex-shrink:0">🛒</div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:baseline;justify-content:space-between;gap:8px">
                                    <span style="font-size:13px;font-weight:600;color:var(--text)">Woolworths Metro</span>
                                    <span style="font-size:14px;font-weight:700;color:var(--red);flex-shrink:0">−$43.15</span>
                                </div>
                                <div style="font-size:11px;color:var(--text3);margin:2px 0 6px">Feb 18 · Groceries</div>
                                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                                    <span class="acct-ai-pill acct-pill-tap" id="acct-pill-2" onclick="changeCatForTxn('acct-txn-2','Woolworths Metro')">✨ Groceries ▾</span>
                                    <span class="acct-conf-high">High confidence</span>
                                </div>
                            </div>
                        </div>
                        <div class="acct-review-actions">
                            <button class="acct-rule-btn" onclick="openRuleSheet('acct-txn-2','Woolworths Metro','Groceries')">⚡ Create Rule</button>
                            <button class="acct-approve-btn" onclick="approveTransaction('acct-txn-2')">Approve ✓</button>
                        </div>
                    </div>

                    <!-- Transaction 3 -->
                    <div class="acct-review-item" id="acct-txn-3">
                        <div class="acct-review-inner">
                            <div class="list-icon" style="background:rgba(124,110,250,0.12);font-size:16px;flex-shrink:0">🎬</div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:baseline;justify-content:space-between;gap:8px">
                                    <span style="font-size:13px;font-weight:600;color:var(--text)">Event Cinemas</span>
                                    <span style="font-size:14px;font-weight:700;color:var(--red);flex-shrink:0">−$28.50</span>
                                </div>
                                <div style="font-size:11px;color:var(--text3);margin:2px 0 6px">Feb 17 · Entertainment</div>
                                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                                    <span class="acct-ai-pill acct-pill-tap" id="acct-pill-3" onclick="changeCatForTxn('acct-txn-3','Event Cinemas')">✨ Entertainment ▾</span>
                                    <span class="acct-conf-high">High confidence</span>
                                </div>
                            </div>
                        </div>
                        <div class="acct-review-actions">
                            <button class="acct-rule-btn" onclick="openRuleSheet('acct-txn-3','Event Cinemas','Entertainment')">⚡ Create Rule</button>
                            <button class="acct-approve-btn" onclick="approveTransaction('acct-txn-3')">Approve ✓</button>
                        </div>
                    </div>

                    <!-- Transaction 4 -->
                    <div class="acct-review-item" id="acct-txn-4">
                        <div class="acct-review-inner">
                            <div class="list-icon" style="background:rgba(255,107,107,0.12);font-size:16px;flex-shrink:0">🍜</div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:baseline;justify-content:space-between;gap:8px">
                                    <span style="font-size:13px;font-weight:600;color:var(--text)">Grill'd Burgers</span>
                                    <span style="font-size:14px;font-weight:700;color:var(--red);flex-shrink:0">−$22.90</span>
                                </div>
                                <div style="font-size:11px;color:var(--text3);margin:2px 0 6px">Feb 17 · Dining</div>
                                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                                    <span class="acct-ai-pill acct-pill-tap" id="acct-pill-4" onclick="changeCatForTxn('acct-txn-4','Grill\'d Burgers')">✨ Dining Out ▾</span>
                                    <span class="acct-conf-medium">Medium confidence</span>
                                </div>
                            </div>
                        </div>
                        <div class="acct-review-actions">
                            <button class="acct-rule-btn" onclick="openRuleSheet('acct-txn-4','Grill\'d Burgers','Dining Out')">⚡ Create Rule</button>
                            <button class="acct-approve-btn" onclick="approveTransaction('acct-txn-4')">Approve ✓</button>
                        </div>
                    </div>

                    <!-- Transaction 5 -->
                    <div class="acct-review-item" id="acct-txn-5">
                        <div class="acct-review-inner">
                            <div class="list-icon" style="background:rgba(0,180,255,0.12);font-size:16px;flex-shrink:0">🏥</div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:baseline;justify-content:space-between;gap:8px">
                                    <span style="font-size:13px;font-weight:600;color:var(--text)">Priceline Pharmacy</span>
                                    <span style="font-size:14px;font-weight:700;color:var(--red);flex-shrink:0">−$18.75</span>
                                </div>
                                <div style="font-size:11px;color:var(--text3);margin:2px 0 6px">Feb 16 · Health</div>
                                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                                    <span class="acct-ai-pill acct-pill-tap" id="acct-pill-5" onclick="changeCatForTxn('acct-txn-5','Priceline Pharmacy')">✨ Health &amp; Wellness ▾</span>
                                    <span class="acct-conf-medium">Medium confidence</span>
                                </div>
                            </div>
                        </div>
                        <div class="acct-review-actions">
                            <button class="acct-rule-btn" onclick="openRuleSheet('acct-txn-5','Priceline Pharmacy','Health &amp; Wellness')">⚡ Create Rule</button>
                            <button class="acct-approve-btn" onclick="approveTransaction('acct-txn-5')">Approve ✓</button>
                        </div>
                    </div>

                    <!-- Transaction 6 -->
                    <div class="acct-review-item" id="acct-txn-6">
                        <div class="acct-review-inner">
                            <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:16px;flex-shrink:0">☕</div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:baseline;justify-content:space-between;gap:8px">
                                    <span style="font-size:13px;font-weight:600;color:var(--text)">Seven Seeds Coffee</span>
                                    <span style="font-size:14px;font-weight:700;color:var(--red);flex-shrink:0">−$9.50</span>
                                </div>
                                <div style="font-size:11px;color:var(--text3);margin:2px 0 6px">Feb 15 · Coffee</div>
                                <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
                                    <span class="acct-ai-pill acct-pill-tap" id="acct-pill-6" onclick="changeCatForTxn('acct-txn-6','Seven Seeds Coffee')">✨ Coffee &amp; Drinks ▾</span>
                                    <span class="acct-conf-high">High confidence</span>
                                </div>
                            </div>
                        </div>
                        <div class="acct-review-actions">
                            <button class="acct-rule-btn" onclick="openRuleSheet('acct-txn-6','Seven Seeds Coffee','Coffee &amp; Drinks')">⚡ Create Rule</button>
                            <button class="acct-approve-btn" onclick="approveTransaction('acct-txn-6')">Approve ✓</button>
                        </div>
                    </div>

                </div><!-- /acct-review-list -->

                <!-- Empty state (hidden until all reviewed) -->
                <div class="acct-empty-state" id="acct-empty-state">
                    <div class="acct-empty-icon">✅</div>
                    <div class="acct-empty-title">All caught up!</div>
                    <div class="acct-empty-sub">You've reviewed all your transactions.<br>AI insights &amp; goal suggestions are now active.</div>
                </div>

            </div><!-- /acct-pane-review -->

            <!-- ─── RULES PANE ─── -->
            <div class="tab-pane" id="acct-pane-rules">

                <div class="section-hd">
                    <div class="section-title">Auto-categorisation Rules · 8</div>
                </div>

                <div class="list-card">

                    <!-- Rule 1 (user-created) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Woolworths" data-cat="Groceries" data-emoji="🛒">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0">🛒</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Woolworths</span>
                                <span class="badge badge-muted" style="font-size:9px">You</span>
                            </div>
                            <div class="acct-rule-arrow">→ Groceries</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 2 (user-created) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Anytime Fitness" data-cat="Health &amp; Wellness" data-emoji="🏋️">
                        <div class="list-icon" style="background:rgba(0,160,100,0.12);font-size:15px;flex-shrink:0">🏋️</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Anytime Fitness</span>
                                <span class="badge badge-muted" style="font-size:9px">You</span>
                            </div>
                            <div class="acct-rule-arrow">→ Health &amp; Wellness</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 3 (user-created) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Steam" data-cat="Entertainment" data-emoji="🎮">
                        <div class="list-icon" style="background:rgba(124,110,250,0.12);font-size:15px;flex-shrink:0">🎮</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Steam</span>
                                <span class="badge badge-muted" style="font-size:9px">You</span>
                            </div>
                            <div class="acct-rule-arrow">→ Entertainment</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 4 (user-created) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Domino's Pizza" data-cat="Dining Out" data-emoji="🍕">
                        <div class="list-icon" style="background:rgba(255,107,107,0.12);font-size:15px;flex-shrink:0">🍕</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Domino's Pizza</span>
                                <span class="badge badge-muted" style="font-size:9px">You</span>
                            </div>
                            <div class="acct-rule-arrow">→ Dining Out</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 5 (AI-detected) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Shell" data-cat="Transport" data-emoji="⛽">
                        <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:15px;flex-shrink:0">⛽</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Shell</span>
                                <span class="badge badge-brand" style="font-size:9px">✨ AI</span>
                            </div>
                            <div class="acct-rule-arrow">→ Transport</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 6 (AI-detected) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Coles" data-cat="Groceries" data-emoji="🥗">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0">🥗</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Coles</span>
                                <span class="badge badge-brand" style="font-size:9px">✨ AI</span>
                            </div>
                            <div class="acct-rule-arrow">→ Groceries</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 7 (AI-detected) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Myki / Opal" data-cat="Transport" data-emoji="🚌">
                        <div class="list-icon" style="background:rgba(0,180,255,0.12);font-size:15px;flex-shrink:0">🚌</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Myki / Opal</span>
                                <span class="badge badge-brand" style="font-size:9px">✨ AI</span>
                            </div>
                            <div class="acct-rule-arrow">→ Transport</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                    <!-- Rule 8 (AI-detected) -->
                    <div class="acct-rule-row" style="cursor:pointer;" onclick="openRuleEdit(this)" data-merchant="Seven Seeds" data-cat="Coffee &amp; Drinks" data-emoji="☕">
                        <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:15px;flex-shrink:0">☕</div>
                        <div class="acct-rule-info">
                            <div style="display:flex;align-items:center;gap:6px">
                                <span class="acct-rule-merchant">Seven Seeds</span>
                                <span class="badge badge-brand" style="font-size:9px">✨ AI</span>
                            </div>
                            <div class="acct-rule-arrow">→ Coffee &amp; Drinks</div>
                        </div>
                        <div class="acct-toggle" onclick="event.stopPropagation()"><div class="acct-toggle-track"><div class="acct-toggle-thumb"></div></div></div>
                        <button class="acct-delete-btn" onclick="event.stopPropagation()">🗑</button>
                    </div>

                </div><!-- /list-card rules -->

                <div class="acct-info-card">
                    <strong>✨ AI auto-rules</strong> are created when Totem detects 3+ transactions from the same merchant with a consistent category. You can disable or delete any rule — your edits always take priority.
                </div>

            </div><!-- /acct-pane-rules -->

            <!-- ─── SUBSCRIPTIONS PANE ─── -->
            <div class="tab-pane" id="acct-pane-subs">

                <div class="section-hd">
                    <div class="section-title">Subscriptions · 11 active</div>
                    <div class="section-link" style="color:var(--text2);font-weight:600;">$287/mo</div>
                </div>

                <div class="list-card">
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(229,9,20,0.12);font-size:15px;flex-shrink:0;">🎬</div>
                        <div class="sub-row-info"><div class="sub-row-name">Netflix</div><div class="sub-row-meta">Standard · Monthly · 20th</div></div>
                        <span class="sub-row-amt">$18.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-1" onclick="toggleSub('acct-sub-t-1')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(30,215,96,0.12);font-size:15px;flex-shrink:0;">🎵</div>
                        <div class="sub-row-info"><div class="sub-row-name">Spotify</div><div class="sub-row-meta">Individual · Monthly · 22nd</div></div>
                        <span class="sub-row-amt">$12.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-2" onclick="toggleSub('acct-sub-t-2')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(255,153,0,0.12);font-size:15px;flex-shrink:0;">🛍️</div>
                        <div class="sub-row-info"><div class="sub-row-name">Amazon Prime</div><div class="sub-row-meta">Monthly · 14th</div></div>
                        <span class="sub-row-amt">$9.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-3" onclick="toggleSub('acct-sub-t-3')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(17,60,200,0.12);font-size:15px;flex-shrink:0;">🏰</div>
                        <div class="sub-row-info"><div class="sub-row-name">Disney+</div><div class="sub-row-meta">Monthly · 8th</div></div>
                        <span class="sub-row-amt">$13.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-4" onclick="toggleSub('acct-sub-t-4')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(255,70,70,0.12);font-size:15px;flex-shrink:0;">📹</div>
                        <div class="sub-row-info"><div class="sub-row-name">YouTube Premium</div><div class="sub-row-meta">Monthly · 1st</div></div>
                        <span class="sub-row-amt">$16.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-5" onclick="toggleSub('acct-sub-t-5')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(255,72,0,0.12);font-size:15px;flex-shrink:0;">🎨</div>
                        <div class="sub-row-info"><div class="sub-row-name">Adobe Creative Cloud</div><div class="sub-row-meta">Monthly · 5th</div></div>
                        <span class="sub-row-amt">$82.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-6" onclick="toggleSub('acct-sub-t-6')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(0,150,255,0.12);font-size:15px;flex-shrink:0;">☁️</div>
                        <div class="sub-row-info"><div class="sub-row-name">iCloud 200GB</div><div class="sub-row-meta">Monthly · 3rd</div></div>
                        <span class="sub-row-amt">$3.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-7" onclick="toggleSub('acct-sub-t-7')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0;">🏋️</div>
                        <div class="sub-row-info"><div class="sub-row-name">F45 Training</div><div class="sub-row-meta">Monthly · 1st</div></div>
                        <span class="sub-row-amt">$79.00</span>
                        <div class="sub-toggle-track" id="acct-sub-t-8" onclick="toggleSub('acct-sub-t-8')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:15px;flex-shrink:0;">🎧</div>
                        <div class="sub-row-info"><div class="sub-row-name">Audible</div><div class="sub-row-meta">Monthly · 12th</div></div>
                        <span class="sub-row-amt">$16.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-9" onclick="toggleSub('acct-sub-t-9')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row">
                        <div class="list-icon" style="background:rgba(150,150,150,0.12);font-size:15px;flex-shrink:0;">📺</div>
                        <div class="sub-row-info"><div class="sub-row-name">Apple TV+</div><div class="sub-row-meta">Monthly · 3rd</div></div>
                        <span class="sub-row-amt">$12.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-10" onclick="toggleSub('acct-sub-t-10')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                    <div class="sub-row" style="border-bottom:none;">
                        <div class="list-icon" style="background:rgba(0,119,181,0.12);font-size:15px;flex-shrink:0;">💼</div>
                        <div class="sub-row-info"><div class="sub-row-name">LinkedIn Premium</div><div class="sub-row-meta">Monthly · 17th</div></div>
                        <span class="sub-row-amt">$14.99</span>
                        <div class="sub-toggle-track" id="acct-sub-t-11" onclick="toggleSub('acct-sub-t-11')"><div class="sub-toggle-thumb"></div></div>
                    </div>
                </div>

                <div class="acct-info-card" style="background:var(--amber-light);border-color:rgba(247,200,75,0.2);">
                    💡 You have <strong>2 more</strong> subscriptions than this time last year. That's $3,444 annualised — 6.7% of your income going to subscriptions. Toggle off anything you want to cancel.
                </div>

            </div><!-- /acct-pane-subs -->

        </div><!-- /tab-scroll -->

    </div><!-- /screen-accounts -->

    <!-- ══════════════════════════════════════════════
         SCREEN: INSIGHTS (placeholder)
    ══════════════════════════════════════════════ -->
    <!-- ══════════════════════════════════════════════
         SCREEN: INSIGHTS
    ══════════════════════════════════════════════ -->
    <div class="app-screen" id="screen-insights">

        <div class="screen-header">
            <div class="screen-title">Insights</div>
            <div class="header-action" style="color:var(--text2);font-size:12px;font-weight:600">Feb 2026</div>
        </div>

        <div class="subtab-bar">
            <div class="subtab active" id="ins-tab-spend"    onclick="switchInsTab('spend')">Spend</div>
            <div class="subtab"        id="ins-tab-trends"   onclick="switchInsTab('trends')">Trends</div>
            <div class="subtab"        id="ins-tab-income"   onclick="switchInsTab('income')">Income</div>
            <div class="subtab"        id="ins-tab-forecast" onclick="switchInsTab('forecast')">Forecast</div>
        </div>

        <div class="tab-scroll">

            <!-- ─── SPEND PANE ─── -->
            <div class="tab-pane active" id="ins-pane-spend">

                <!-- Period selector -->
                <div class="ins-period-bar" style="margin-top:4px">
                    <div class="ins-period-chip active" onclick="switchInsPeriod('this-month',this)">This Month</div>
                    <div class="ins-period-chip" onclick="switchInsPeriod('3-months',this)">3 Months</div>
                    <div class="ins-period-chip" onclick="switchInsPeriod('12-months',this)">12 Months</div>
                </div>

                <!-- KPI row -->
                <div class="ins-kpi-row">
                    <div class="ins-kpi-card">
                        <div class="ins-kpi-label">Spent</div>
                        <div class="ins-kpi-value">$2,781</div>
                        <div class="ins-kpi-sub">of month so far</div>
                    </div>
                    <div class="ins-kpi-card">
                        <div class="ins-kpi-label">Daily avg</div>
                        <div class="ins-kpi-value">$146</div>
                        <div class="ins-kpi-sub">19 days tracked</div>
                    </div>
                    <div class="ins-kpi-card">
                        <div class="ins-kpi-label">Saved</div>
                        <div class="ins-kpi-value" style="color:var(--green)">18%</div>
                        <div class="ins-kpi-sub">of income rcvd</div>
                    </div>
                </div>

                <!-- Category breakdown -->
                <div class="section-hd">
                    <div class="section-title">By Category · % of income</div>
                    <div class="section-link" id="ins-income-label">$6,400 / mo</div>
                </div>
                <div class="list-card" style="margin-bottom:14px">
                    <div class="cat-item">
                        <span class="cat-emoji">🏠</span>
                        <span class="cat-name">Housing</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:100%"></div></div></div>
                        <span class="cat-pct">25%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$1,600</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">🍜</span>
                        <span class="cat-name">Dining Out</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill" style="width:68%;background:var(--red)"></div></div></div>
                        <span class="cat-pct" style="color:var(--red)">5%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$341</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">🛒</span>
                        <span class="cat-name">Groceries</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:44%"></div></div></div>
                        <span class="cat-pct">3%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$178</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">🚗</span>
                        <span class="cat-name">Transport</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:30%"></div></div></div>
                        <span class="cat-pct">2%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$122</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">🛍️</span>
                        <span class="cat-name">Shopping</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:26%"></div></div></div>
                        <span class="cat-pct">2%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$106</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">🎬</span>
                        <span class="cat-name">Entertainment</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:21%"></div></div></div>
                        <span class="cat-pct">1%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$85</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">☕</span>
                        <span class="cat-name">Coffee</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:16%"></div></div></div>
                        <span class="cat-pct">1%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$64</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">📱</span>
                        <span class="cat-name">Subscriptions</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:15%"></div></div></div>
                        <span class="cat-pct">1%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$60</span>
                    </div>
                    <div class="cat-item">
                        <span class="cat-emoji">🏥</span>
                        <span class="cat-name">Health</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:11%"></div></div></div>
                        <span class="cat-pct">&lt;1%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$45</span>
                    </div>
                    <div class="cat-item" style="border-bottom:none">
                        <span class="cat-emoji">💡</span>
                        <span class="cat-name">Utilities</span>
                        <div class="cat-bar"><div class="cat-track"><div class="cat-fill fill-brand" style="width:19%"></div></div></div>
                        <span class="cat-pct">2%</span>
                        <span style="font-size:11px;color:var(--text2);width:40px;text-align:right">$120</span>
                    </div>
                </div>

                <!-- Top merchants -->
                <div class="section-hd"><div class="section-title">Top Merchants</div></div>
                <div class="list-card">
                    <div class="ins-merchant-row">
                        <div class="list-icon" style="background:rgba(255,107,107,0.12);font-size:14px;flex-shrink:0">🍜</div>
                        <span class="ins-merchant-name">Grill'd</span>
                        <div class="ins-merchant-bar-wrap"><div class="ins-merchant-bar-track"><div class="ins-merchant-bar-fill" style="width:100%;background:var(--red)"></div></div></div>
                        <span class="ins-merchant-amount" style="color:var(--red)">$341</span>
                    </div>
                    <div class="ins-merchant-row">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:14px;flex-shrink:0">🛒</div>
                        <span class="ins-merchant-name">Woolworths</span>
                        <div class="ins-merchant-bar-wrap"><div class="ins-merchant-bar-track"><div class="ins-merchant-bar-fill" style="width:52%"></div></div></div>
                        <span class="ins-merchant-amount">$178</span>
                    </div>
                    <div class="ins-merchant-row">
                        <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:14px;flex-shrink:0">⛽</div>
                        <span class="ins-merchant-name">Shell</span>
                        <div class="ins-merchant-bar-wrap"><div class="ins-merchant-bar-track"><div class="ins-merchant-bar-fill" style="width:36%"></div></div></div>
                        <span class="ins-merchant-amount">$122</span>
                    </div>
                    <div class="ins-merchant-row">
                        <div class="list-icon" style="background:rgba(124,110,250,0.12);font-size:14px;flex-shrink:0">🛍️</div>
                        <span class="ins-merchant-name">Amazon AU</span>
                        <div class="ins-merchant-bar-wrap"><div class="ins-merchant-bar-track"><div class="ins-merchant-bar-fill" style="width:31%"></div></div></div>
                        <span class="ins-merchant-amount">$106</span>
                    </div>
                    <div class="ins-merchant-row">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:14px;flex-shrink:0">🛒</div>
                        <span class="ins-merchant-name">Coles</span>
                        <div class="ins-merchant-bar-wrap"><div class="ins-merchant-bar-track"><div class="ins-merchant-bar-fill" style="width:29%"></div></div></div>
                        <span class="ins-merchant-amount">$98</span>
                    </div>
                </div>

                <!-- AI Spending insight -->
                <div class="insight-card" style="margin-top:12px">
                    <div class="insight-icon">🍜</div>
                    <div>
                        <div class="insight-tag">✨ Totem AI</div>
                        <div class="insight-text">Dining Out is your fastest-growing category — up <strong>+34%</strong> vs your 3-month average. At this rate you'll overshoot your $464 budget by ~$60.</div>
                        <div class="insight-cta">View dining transactions →</div>
                    </div>
                </div>

            </div><!-- /ins-pane-spend -->

            <!-- ─── TRENDS PANE ─── -->
            <div class="tab-pane" id="ins-pane-trends">

                <!-- Lifestyle Creep card — full detail -->
                <div class="section-hd"><div class="section-title">Lifestyle Creep</div><div class="section-link">Learn more</div></div>
                <div class="creep-card" style="margin-bottom:12px">
                    <div class="creep-top">
                        <div>
                            <div class="creep-building-label" style="color:var(--amber)">⚠ Creep Detected</div>
                            <div class="creep-status">+6% above income growth</div>
                        </div>
                        <div style="text-align:right">
                            <div style="font-size:28px;font-weight:800;color:var(--amber);letter-spacing:-1px">+6%</div>
                            <div style="font-size:10px;color:var(--text3)">3mo delta</div>
                        </div>
                    </div>
                    <div class="progress-track" style="margin-bottom:10px">
                        <div class="progress-fill" style="width:60%;background:var(--amber)"></div>
                    </div>
                    <div class="ins-creep-detail">
                        <div class="ins-creep-row">
                            <span class="ins-creep-row-label">Spend growth · 3mo vs 12mo avg</span>
                            <span class="ins-creep-row-val" style="color:var(--red)">+11%</span>
                        </div>
                        <div class="ins-creep-row">
                            <span class="ins-creep-row-label">Income growth · same period</span>
                            <span class="ins-creep-row-val" style="color:var(--green)">+5%</span>
                        </div>
                        <div class="ins-creep-row">
                            <span class="ins-creep-row-label">Lifestyle Creep delta</span>
                            <span class="ins-creep-row-val" style="color:var(--amber)">+6%</span>
                        </div>
                        <div class="ins-creep-row">
                            <span class="ins-creep-row-label">Main driver</span>
                            <span class="ins-creep-row-val">Dining Out 🍜</span>
                        </div>
                    </div>
                    <div class="creep-desc" style="margin-top:12px">Your income grew <strong>+5%</strong> this year but spending grew <strong>+11%</strong> — mostly driven by Dining Out (+34%) and Shopping (+18%). Keeping Dining Out within budget would eliminate creep.</div>
                </div>

                <!-- Safety Net card -->
                <div class="section-hd"><div class="section-title">Safety Net</div></div>
                <div class="health-pair" style="margin-bottom:12px">
                    <div class="health-card">
                        <div class="health-icon">🛡️</div>
                        <div class="health-label">Runway</div>
                        <div class="health-value" style="color:var(--amber)">2.6</div>
                        <div class="health-unit">months</div>
                        <div class="badge badge-amber" style="margin-top:8px">Below 3mo target</div>
                    </div>
                    <div class="health-card">
                        <div class="health-icon">💰</div>
                        <div class="health-label">Liquid savings</div>
                        <div class="health-value">$12,450</div>
                        <div class="health-unit">ANZ NetSaver</div>
                        <div class="badge badge-green" style="margin-top:8px">↑ $500 this month</div>
                    </div>
                </div>

                <!-- Month-over-month spend chart -->
                <div class="section-hd"><div class="section-title">Monthly Spend Trend</div><div class="section-link">Discretionary</div></div>
                <div class="metric-card" style="margin-bottom:12px">
                    <div style="display:flex;justify-content:space-between;align-items:flex-start">
                        <div>
                            <div class="metric-label">5-Month Average</div>
                            <div class="metric-value">$1,106</div>
                        </div>
                        <div style="text-align:right">
                            <div class="metric-label">vs last month</div>
                            <div style="font-size:18px;font-weight:700;color:var(--green)">−$0</div>
                            <div class="metric-sub">flat · on track</div>
                        </div>
                    </div>
                    <div class="mini-chart" style="height:60px">
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:37px;background:rgba(124,110,250,0.25)"></div>
                            <span class="mini-label">Oct</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:43px;background:rgba(124,110,250,0.35)"></div>
                            <span class="mini-label">Nov</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:60px;background:rgba(255,107,107,0.6)"></div>
                            <span class="mini-label" style="color:var(--red)">Dec</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:40px;background:rgba(124,110,250,0.45)"></div>
                            <span class="mini-label">Jan</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:40px;background:var(--brand)"></div>
                            <span class="mini-label active">Feb*</span>
                        </div>
                    </div>
                    <div style="font-size:10px;color:var(--text3);margin-top:6px">* Feb is partial (19/28 days). Dec spike driven by holidays.</div>
                </div>

                <!-- Savings velocity -->
                <div class="section-hd"><div class="section-title">Savings Velocity</div></div>
                <div class="metric-card">
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px">
                        <div>
                            <div class="metric-label">Savings Rate</div>
                            <div class="metric-value">18%</div>
                            <div class="badge badge-amber" style="margin-top:4px">↓ from 27% in Jan</div>
                        </div>
                        <div style="text-align:right">
                            <div class="metric-label">3-Month saved</div>
                            <div class="metric-value">$3,980</div>
                            <div class="metric-sub" style="color:var(--green)">+$980 vs goal</div>
                        </div>
                    </div>
                    <div class="mini-chart">
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:16px;background:rgba(124,110,250,0.3)"></div>
                            <span class="mini-label">Oct</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:20px;background:rgba(124,110,250,0.4)"></div>
                            <span class="mini-label">Nov</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:8px;background:rgba(255,107,107,0.5)"></div>
                            <span class="mini-label" style="color:var(--red)">Dec</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:40px;background:var(--green)"></div>
                            <span class="mini-label">Jan</span>
                        </div>
                        <div class="mini-bar-wrap">
                            <div class="mini-bar" style="height:28px;background:var(--brand)"></div>
                            <span class="mini-label active">Feb</span>
                        </div>
                    </div>
                </div>

            </div><!-- /ins-pane-trends -->

            <!-- ─── INCOME PANE ─── -->
            <div class="tab-pane" id="ins-pane-income">

                <!-- KPI row -->
                <div class="ins-kpi-row" style="margin-top:4px">
                    <div class="ins-kpi-card">
                        <div class="ins-kpi-label">Monthly</div>
                        <div class="ins-kpi-value">$6,400</div>
                        <div class="ins-kpi-sub">net income</div>
                    </div>
                    <div class="ins-kpi-card">
                        <div class="ins-kpi-label">YTD Total</div>
                        <div class="ins-kpi-value">$9,640</div>
                        <div class="ins-kpi-sub">since Jan 1</div>
                    </div>
                    <div class="ins-kpi-card">
                        <div class="ins-kpi-label">Growth</div>
                        <div class="ins-kpi-value" style="color:var(--green)">+5%</div>
                        <div class="ins-kpi-sub">vs last year</div>
                    </div>
                </div>

                <!-- Income vs Spend dual-bar chart -->
                <div class="section-hd"><div class="section-title">Income vs Spend</div><div class="section-link">5 months</div></div>
                <div class="metric-card" style="margin-bottom:14px">
                    <div class="ins-dual-chart">
                        <!-- Oct -->
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:54px"></div>
                            </div>
                            <span class="ins-chart-label">Oct</span>
                        </div>
                        <!-- Nov -->
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:57px"></div>
                            </div>
                            <span class="ins-chart-label">Nov</span>
                        </div>
                        <!-- Dec -->
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:65px;background:var(--amber);opacity:0.85"></div>
                            </div>
                            <span class="ins-chart-label" style="color:var(--amber)">Dec</span>
                        </div>
                        <!-- Jan -->
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:53px"></div>
                            </div>
                            <span class="ins-chart-label">Jan</span>
                        </div>
                        <!-- Feb (partial) -->
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:36px;opacity:0.9;border-style:dashed;border:1.5px dashed rgba(124,110,250,0.5);background:rgba(124,110,250,0.2)"></div>
                                <div class="ins-bar-s" style="height:31px"></div>
                            </div>
                            <span class="ins-chart-label active">Feb*</span>
                        </div>
                    </div>
                    <div class="ins-chart-legend">
                        <div class="ins-legend-item">
                            <div class="ins-legend-dot" style="background:var(--brand);opacity:0.65"></div>
                            Income
                        </div>
                        <div class="ins-legend-item">
                            <div class="ins-legend-dot" style="background:var(--red);opacity:0.75"></div>
                            Spend
                        </div>
                    </div>
                    <div style="font-size:10px;color:var(--text3);margin-top:6px">* Feb income shows one of two pay periods. Dec spend spike = holiday season.</div>
                </div>

                <!-- Pay history -->
                <div class="section-hd"><div class="section-title">Pay History</div><div class="section-link">Acme Corp</div></div>
                <div class="list-card" style="margin-bottom:14px">
                    <div class="ins-pay-row">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0">💰</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Salary — Acme Corp</div>
                            <div style="font-size:11px;color:var(--text3)">Feb 8, 2026 · Fortnightly</div>
                        </div>
                        <div style="font-size:15px;font-weight:700;color:var(--green)">+$3,240</div>
                    </div>
                    <div class="ins-pay-row">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0">💰</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Salary — Acme Corp</div>
                            <div style="font-size:11px;color:var(--text3)">Jan 25, 2026 · Fortnightly</div>
                        </div>
                        <div style="font-size:15px;font-weight:700;color:var(--green)">+$3,240</div>
                    </div>
                    <div class="ins-pay-row">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0">💰</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Salary — Acme Corp</div>
                            <div style="font-size:11px;color:var(--text3)">Jan 11, 2026 · Fortnightly</div>
                        </div>
                        <div style="font-size:15px;font-weight:700;color:var(--green)">+$3,240</div>
                    </div>
                    <div class="ins-pay-row" style="border-bottom:none">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:15px;flex-shrink:0">💰</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Salary — Acme Corp</div>
                            <div style="font-size:11px;color:var(--text3)">Dec 28, 2025 · Fortnightly</div>
                        </div>
                        <div style="font-size:15px;font-weight:700;color:var(--green)">+$3,200</div>
                    </div>
                </div>

                <!-- Savings breakdown -->
                <div class="section-hd"><div class="section-title">Savings Breakdown · Feb</div></div>
                <div class="list-card">
                    <div class="burn-item">
                        <div class="burn-top">
                            <div class="burn-cat">💰 ANZ NetSaver transfer</div>
                            <div class="burn-right">
                                <div class="burn-spent" style="color:var(--green)">$500</div>
                                <div class="burn-budget">of $500 goal</div>
                            </div>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill fill-green" style="width:100%"></div>
                        </div>
                    </div>
                    <div class="burn-item" style="border-bottom:none">
                        <div class="burn-top">
                            <div class="burn-cat">🎯 Japan Trip fund</div>
                            <div class="burn-right">
                                <div class="burn-spent" style="color:var(--brand)">$280</div>
                                <div class="burn-budget">of $300 goal</div>
                            </div>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill fill-brand" style="width:93%"></div>
                        </div>
                    </div>
                </div>

            </div><!-- /ins-pane-income -->

            <!-- ─── FORECAST PANE ─── -->
            <div class="tab-pane" id="ins-pane-forecast">

                <!-- Month-end projection hero -->
                <div class="ins-proj-card" style="margin-top:4px">
                    <div class="ins-proj-label">Feb projected surplus</div>
                    <div class="ins-proj-amount" style="color:var(--green)">+$2,241</div>
                    <div class="ins-proj-grid">
                        <div class="ins-proj-cell">
                            <div class="ins-proj-cell-label">Income</div>
                            <div class="ins-proj-cell-val">$6,480</div>
                        </div>
                        <div class="ins-proj-cell">
                            <div class="ins-proj-cell-label">Proj. spend</div>
                            <div class="ins-proj-cell-val" style="color:var(--red)">$4,239</div>
                        </div>
                        <div class="ins-proj-cell">
                            <div class="ins-proj-cell-label">Days left</div>
                            <div class="ins-proj-cell-val">9</div>
                        </div>
                    </div>
                    <div style="font-size:11px;color:var(--text3);margin-top:10px">Based on $146/day avg · 9 days remaining · upcoming: Rent $1,600 (Feb 21)</div>
                </div>

                <!-- 90-day cash flow projection -->
                <div class="section-hd">
                    <div class="section-title">90-Day Cash Flow</div>
                    <div class="section-link">Mar – May 2026</div>
                </div>
                <div class="metric-card" style="margin-bottom:12px">
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2px">
                        <div>
                            <div class="metric-label">Avg projected surplus</div>
                            <div class="metric-value" style="color:var(--green)">+$2,180</div>
                        </div>
                        <div style="text-align:right">
                            <div class="metric-label">3-month total</div>
                            <div class="metric-value">$6,540</div>
                            <div class="metric-sub">if trend holds</div>
                        </div>
                    </div>
                    <!-- Dual bar chart: income vs projected spend -->
                    <div class="ins-dual-chart" style="margin-top:14px">
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:46px"></div>
                            </div>
                            <span class="ins-chart-label">Mar</span>
                        </div>
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:48px"></div>
                            </div>
                            <span class="ins-chart-label">Apr</span>
                        </div>
                        <div class="ins-month-col">
                            <div class="ins-bar-pair">
                                <div class="ins-bar-i" style="height:72px"></div>
                                <div class="ins-bar-s" style="height:47px"></div>
                            </div>
                            <span class="ins-chart-label">May</span>
                        </div>
                    </div>
                    <div class="ins-chart-legend">
                        <div class="ins-legend-item">
                            <div class="ins-legend-dot" style="background:var(--brand);opacity:0.65"></div>Income
                        </div>
                        <div class="ins-legend-item">
                            <div class="ins-legend-dot" style="background:var(--red);opacity:0.75"></div>Projected spend
                        </div>
                    </div>
                    <div style="font-size:10px;color:var(--text3);margin-top:6px">Projections use 3-month rolling average. Excludes one-off or seasonal spend.</div>
                </div>

                <!-- Goal completion forecasts -->
                <div class="section-hd"><div class="section-title">Goal Completion Forecast</div></div>
                <div class="list-card" style="margin-bottom:12px">

                    <!-- Japan Trip -->
                    <div class="ins-goal-row">
                        <div class="list-icon" style="background:rgba(124,110,250,0.12);font-size:16px;flex-shrink:0">✈️</div>
                        <div class="ins-goal-info">
                            <div class="ins-goal-name">Japan Trip Fund</div>
                            <div class="ins-goal-bar-row">
                                <div style="flex:1">
                                    <div class="progress-track">
                                        <div class="progress-fill fill-brand" style="width:68%"></div>
                                    </div>
                                </div>
                                <span style="font-size:11px;color:var(--text3);flex-shrink:0">$2,840 / $4,200</span>
                            </div>
                        </div>
                        <div class="ins-goal-eta">May<br><span style="font-size:9px;font-weight:500;color:var(--text3)">2026</span></div>
                    </div>

                    <!-- Safety Net -->
                    <div class="ins-goal-row">
                        <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:16px;flex-shrink:0">🛡️</div>
                        <div class="ins-goal-info">
                            <div class="ins-goal-name">Safety Net · 3 months</div>
                            <div class="ins-goal-bar-row">
                                <div style="flex:1">
                                    <div class="progress-track">
                                        <div class="progress-fill" style="width:86%;background:var(--amber)"></div>
                                    </div>
                                </div>
                                <span style="font-size:11px;color:var(--text3);flex-shrink:0">$12,450 / $14,550</span>
                            </div>
                        </div>
                        <div class="ins-goal-eta" style="color:var(--amber)">Apr<br><span style="font-size:9px;font-weight:500;color:var(--text3)">2026</span></div>
                    </div>

                    <!-- Car fund -->
                    <div class="ins-goal-row" style="border-bottom:none">
                        <div class="list-icon" style="background:rgba(0,200,150,0.12);font-size:16px;flex-shrink:0">🚗</div>
                        <div class="ins-goal-info">
                            <div class="ins-goal-name">New Car Deposit</div>
                            <div class="ins-goal-bar-row">
                                <div style="flex:1">
                                    <div class="progress-track">
                                        <div class="progress-fill fill-green" style="width:31%"></div>
                                    </div>
                                </div>
                                <span style="font-size:11px;color:var(--text3);flex-shrink:0">$3,100 / $10,000</span>
                            </div>
                        </div>
                        <div class="ins-goal-eta" style="color:var(--text2)">Dec<br><span style="font-size:9px;font-weight:500;color:var(--text3)">2026</span></div>
                    </div>

                </div>

                <!-- Upcoming large expenses -->
                <div class="section-hd"><div class="section-title">Upcoming Known Expenses</div></div>
                <div class="list-card" style="margin-bottom:12px">
                    <div class="list-item">
                        <div class="list-icon" style="background:rgba(255,107,107,0.12);font-size:15px">🏠</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Rent</div>
                            <div style="font-size:11px;color:var(--text3)">Feb 21 · recurring monthly</div>
                        </div>
                        <div style="font-size:14px;font-weight:700;color:var(--red)">−$1,600</div>
                    </div>
                    <div class="list-item">
                        <div class="list-icon" style="background:rgba(255,160,0,0.12);font-size:15px">🚗</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Car registration</div>
                            <div style="font-size:11px;color:var(--text3)">Mar 15 · annual</div>
                        </div>
                        <div style="font-size:14px;font-weight:700;color:var(--amber)">−$680</div>
                    </div>
                    <div class="list-item" style="border-bottom:none">
                        <div class="list-icon" style="background:rgba(124,110,250,0.12);font-size:15px">✈️</div>
                        <div style="flex:1">
                            <div style="font-size:13px;font-weight:600;color:var(--text)">Japan flights deposit</div>
                            <div style="font-size:11px;color:var(--text3)">Apr 1 · planned</div>
                        </div>
                        <div style="font-size:14px;font-weight:700;color:var(--brand)">−$1,200</div>
                    </div>
                </div>

                <!-- AI risk & opportunity flags -->
                <div class="section-hd"><div class="section-title">✨ AI Flags</div></div>
                <div class="list-card">
                    <div class="ins-risk-item">
                        <div class="ins-risk-dot" style="background:var(--red)"></div>
                        <div class="ins-risk-text"><strong style="color:var(--text)">Dining Out creep</strong> — at current rate you'll overspend your Feb budget by ~$60. Cutting 2 dinners this week keeps you on track.</div>
                    </div>
                    <div class="ins-risk-item">
                        <div class="ins-risk-dot" style="background:var(--amber)"></div>
                        <div class="ins-risk-text"><strong style="color:var(--text)">Car rego in 24 days</strong> — $680 due Mar 15. Your current surplus easily covers it, but worth keeping $700 unallocated this month.</div>
                    </div>
                    <div class="ins-risk-item">
                        <div class="ins-risk-dot" style="background:var(--green)"></div>
                        <div class="ins-risk-text"><strong style="color:var(--text)">Japan Trip on track</strong> — at $280/month you'll hit $4,200 by May. Increasing to $380/month would get you there a month early.</div>
                    </div>
                    <div class="ins-risk-item" style="border-bottom:none">
                        <div class="ins-risk-dot" style="background:var(--brand)"></div>
                        <div class="ins-risk-text"><strong style="color:var(--text)">Safety Net nearly there</strong> — $2,100 to go. Two months of current savings rate puts you at the 3-month target in April.</div>
                    </div>
                </div>

            </div><!-- /ins-pane-forecast -->

        </div><!-- /tab-scroll -->

    </div><!-- /screen-insights -->


    <!-- ════════════ PERSISTENT BOTTOM NAV ════════════ -->
    <!-- ════════════════════════════════════════════════════════
         ONBOARDING OVERLAY  (z-index 35 — covers all app screens + bottom nav)
         Launch via sidebar "Onboarding Flow" button or showOnboarding()
    ════════════════════════════════════════════════════════ -->
    <div class="ob-overlay hidden" id="ob-overlay">

        <!-- ── Screen 1: Welcome ── -->
        <div class="ob-screen active" id="ob-1">
            <div class="ob-body" style="justify-content:space-between;padding-top:28px;">
                <div>
                    <div style="font-size:30px;font-weight:800;letter-spacing:-1.5px;color:var(--text)">Totem<span style="color:var(--brand)">.</span></div>
                    <div style="font-size:12px;color:var(--text2);margin-top:4px">your financial clarity</div>
                </div>
                <div style="text-align:center;padding:0 4px;">
                    <div style="font-size:26px;font-weight:800;letter-spacing:-1px;color:var(--text);line-height:1.25;margin-bottom:12px">See your money<br><span style="color:var(--brand)">clearly</span></div>
                    <div style="font-size:13px;color:var(--text2);line-height:1.65;">No more end-of-month surprises. Live bank feeds, smart categorisation, and proactive nudges — all in one place.</div>
                </div>
                <div style="display:flex;flex-direction:column;gap:10px;">
                    <div class="ob-feature-row">
                        <div class="ob-feature-icon" style="background:var(--brand-light)">💰</div>
                        <div><div class="ob-feature-title">Safe to Spend</div><div class="ob-feature-sub">Always know what you can spend today</div></div>
                    </div>
                    <div class="ob-feature-row">
                        <div class="ob-feature-icon" style="background:var(--teal-light)">🤖</div>
                        <div><div class="ob-feature-title">AI Categorisation</div><div class="ob-feature-sub">Spending organised automatically, every day</div></div>
                    </div>
                    <div class="ob-feature-row">
                        <div class="ob-feature-icon" style="background:var(--amber-light)">🔔</div>
                        <div><div class="ob-feature-title">Proactive Nudges</div><div class="ob-feature-sub">Warned before you overspend, not after</div></div>
                    </div>
                </div>
                <div style="display:flex;flex-direction:column;gap:10px;">
                    <button class="ob-btn ob-btn-primary" onclick="obTo('ob-2')">Get started →</button>
                    <button class="ob-btn ob-btn-secondary" onclick="obExplore()">Explore with sample data</button>
                </div>
            </div>
        </div>

        <!-- ── Screen 2: Sign Up ── -->
        <div class="ob-screen" id="ob-2">
            <div class="ob-header">
                <div class="ob-back" onclick="obTo('ob-1')">‹</div>
                <div class="ob-step-dots">
                    <div class="ob-step-dot active"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                </div>
                <div class="ob-spacer"></div>
            </div>
            <div class="ob-body">
                <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">Create your account</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px">Your data is encrypted and never sold.</div>
                <button class="ob-btn" onclick="obTo('ob-3')" style="background:#fff;color:#000;display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:16px;font-size:14px;border-radius:14px;padding:14px">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#000"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>
                    Continue with Apple
                </button>
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
                    <div style="flex:1;height:1px;background:var(--border)"></div>
                    <span style="font-size:12px;color:var(--text3)">or</span>
                    <div style="flex:1;height:1px;background:var(--border)"></div>
                </div>
                <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px;">
                    <input class="ob-input" type="text" placeholder="First name">
                    <input class="ob-input" type="email" placeholder="Email address">
                    <input class="ob-input" type="password" placeholder="Password (min 8 characters)">
                </div>
                <button class="ob-btn ob-btn-primary" onclick="obTo('ob-3')" style="margin-bottom:14px">Continue →</button>
                <div style="text-align:center;font-size:12px;color:var(--text2)">Already have an account? <span style="color:var(--brand);font-weight:600;cursor:pointer">Sign in</span></div>
                <div style="margin-top:auto;padding-top:20px;text-align:center;font-size:11px;color:var(--text3);line-height:1.6">
                    By continuing you agree to our <span style="color:var(--brand)">Terms of Service</span> and <span style="color:var(--brand)">Privacy Policy</span>
                </div>
            </div>
        </div>

        <!-- ── Screen 3: Connect Bank ── -->
        <div class="ob-screen" id="ob-3">
            <div class="ob-header">
                <div class="ob-back" onclick="obTo('ob-2')">‹</div>
                <div class="ob-step-dots">
                    <div class="ob-step-dot"></div><div class="ob-step-dot active"></div><div class="ob-step-dot"></div>
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                </div>
                <div class="ob-spacer"></div>
            </div>
            <div class="ob-body">
                <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">Connect your bank</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:16px">We pull up to 12 months of history automatically — no CSV exports needed.</div>
                <div class="ob-bank-grid" style="margin-bottom:14px">
                    <div class="ob-bank-card" onclick="obSelectBank(this)"><span class="ob-bank-emoji">🔴</span><div class="ob-bank-name">ANZ</div></div>
                    <div class="ob-bank-card" onclick="obSelectBank(this)"><span class="ob-bank-emoji">🟡</span><div class="ob-bank-name">CommBank</div></div>
                    <div class="ob-bank-card" onclick="obSelectBank(this)"><span class="ob-bank-emoji">🔴</span><div class="ob-bank-name">Westpac</div></div>
                    <div class="ob-bank-card" onclick="obSelectBank(this)"><span class="ob-bank-emoji">🔴</span><div class="ob-bank-name">NAB</div></div>
                    <div class="ob-bank-card" onclick="obSelectBank(this)"><span class="ob-bank-emoji">🟢</span><div class="ob-bank-name">Macquarie</div></div>
                    <div class="ob-bank-card" onclick="obSelectBank(this)"><span class="ob-bank-emoji">🏦</span><div class="ob-bank-name">Other</div></div>
                </div>
                <div class="ob-trust-row" style="margin-bottom:18px">
                    <div class="ob-trust-badge">🔒 Bank-grade encryption</div>
                    <div class="ob-trust-badge">👁 Read-only access</div>
                    <div class="ob-trust-badge">✓ CDR accredited</div>
                </div>
                <button class="ob-btn ob-btn-primary" onclick="obTo('ob-5')" style="margin-bottom:10px">Continue →</button>
                <button class="ob-btn ob-btn-ghost" onclick="obExplore()">I'll connect later</button>
            </div>
        </div>

        <!-- ── Screen 4: Pay Cycle (shown after bank auth, while connecting) ── -->
        <div class="ob-screen" id="ob-4">
            <div class="ob-header">
                <div class="ob-back" onclick="obTo('ob-5')">‹</div>
                <div class="ob-step-dots">
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                    <div class="ob-step-dot active"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                </div>
                <div class="ob-spacer"></div>
            </div>
            <div class="ob-body">
                <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">One quick question 🤙</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px">Your bank is connecting in the background. While that happens — how often are you paid? We won't ask how much.</div>
                <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px">
                    <div class="ob-option-card" onclick="obSelectCycle(this)">
                        <div><div class="ob-option-title">Weekly</div><div class="ob-option-sub">Paid every week</div></div>
                        <div class="ob-option-check"></div>
                    </div>
                    <div class="ob-option-card selected" onclick="obSelectCycle(this)">
                        <div><div class="ob-option-title">Fortnightly</div><div class="ob-option-sub">Every two weeks — most common</div></div>
                        <div class="ob-option-check">✓</div>
                    </div>
                    <div class="ob-option-card" onclick="obSelectCycle(this)">
                        <div><div class="ob-option-title">Monthly</div><div class="ob-option-sub">Once a month</div></div>
                        <div class="ob-option-check"></div>
                    </div>
                    <div class="ob-option-card" onclick="obSelectCycle(this)">
                        <div><div class="ob-option-title">Irregular / Variable</div><div class="ob-option-sub">Freelance, casual, or multiple sources</div></div>
                        <div class="ob-option-check"></div>
                    </div>
                </div>
                <div style="display:flex;gap:8px;align-items:flex-start;padding:12px 14px;background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:20px">
                    <span style="font-size:14px">💡</span>
                    <span style="font-size:12px;color:var(--text2);line-height:1.55">We detect your pay cycle from your bank feed automatically — this is just a starting point.</span>
                </div>
                <button class="ob-btn ob-btn-primary" onclick="obStartConnect()">Connect &amp; continue →</button>
            </div>
        </div>

        <!-- ── Screen 5: Bank Auth (shown directly after bank select) ── -->
        <div class="ob-screen" id="ob-5">
            <div class="ob-header">
                <div class="ob-back" onclick="obTo('ob-3')">‹</div>
                <div class="ob-step-dots">
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot active"></div>
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                </div>
                <div class="ob-spacer"></div>
            </div>
            <div class="ob-body" style="align-items:center;justify-content:center;text-align:center;gap:0">
                <div style="display:flex;align-items:center;gap:16px;margin-bottom:28px">
                    <div style="width:56px;height:56px;border-radius:16px;background:rgba(229,9,20,0.12);display:flex;align-items:center;justify-content:center;font-size:26px">🔴</div>
                    <div class="ob-conn-dots"><span></span><span></span><span></span></div>
                    <div style="width:56px;height:56px;border-radius:16px;background:var(--brand-light);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:800;color:var(--brand)">T</div>
                </div>
                <div style="font-size:20px;font-weight:800;color:var(--text);letter-spacing:-0.5px;margin-bottom:10px">Connect to ANZ</div>
                <div style="font-size:13px;color:var(--text2);line-height:1.65;max-width:280px;margin-bottom:16px">You'll be taken to ANZ to authorise read-only access. Your login credentials never touch Totem's servers.</div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;text-align:left;margin-bottom:24px;max-width:300px">
                    <div style="font-size:11px;color:var(--text2);line-height:1.6">✅ All your ANZ accounts connect at once — Everyday, Savings, and Credit. You only authorise once per bank.</div>
                </div>
                <div class="ob-trust-row" style="margin-bottom:32px">
                    <div class="ob-trust-badge">🔒 256-bit TLS</div>
                    <div class="ob-trust-badge">✓ OAuth 2.0</div>
                </div>
                <button class="ob-btn ob-btn-primary" onclick="obTo('ob-4')" style="width:100%">Open ANZ to authorise →</button>
                <div style="font-size:11px;color:var(--text3);margin-top:12px">Powered by Basiq · CDR accredited data recipient</div>
            </div>
        </div>

        <!-- ── Screen 6: Processing ── -->
        <div class="ob-screen" id="ob-6">
            <div class="ob-body" style="align-items:center;justify-content:center;text-align:center">
                <div class="ob-spinner" style="margin-bottom:28px"></div>
                <div style="font-size:20px;font-weight:800;color:var(--text);letter-spacing:-0.5px;margin-bottom:8px">Analysing your data</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:28px;max-width:280px">Pulling 12 months of history and categorising with AI. This usually takes 10–20 seconds.</div>
                <div style="width:100%;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:6px 16px;text-align:left">
                    <div class="ob-step-row">
                        <div class="ob-step-icon ob-step-done">✓</div>
                        <div><div style="font-size:13px;font-weight:600;color:var(--text)">ANZ connected</div><div style="font-size:11px;color:var(--green)">3 accounts linked</div></div>
                    </div>
                    <div class="ob-step-row" id="ob-proc-2">
                        <div class="ob-step-icon ob-step-active" id="ob-p2-icon">◉</div>
                        <div><div style="font-size:13px;font-weight:600;color:var(--text)">Importing transactions</div><div style="font-size:11px;color:var(--brand)" id="ob-proc-count">0 of ~847 imported</div></div>
                    </div>
                    <div class="ob-step-row" id="ob-proc-3">
                        <div class="ob-step-icon ob-step-pending" id="ob-p3-icon">○</div>
                        <div><div style="font-size:13px;font-weight:600;color:var(--text3)" id="ob-p3-title">Categorising with AI</div><div style="font-size:11px;color:var(--text3)" id="ob-p3-sub">Waiting…</div></div>
                    </div>
                    <div class="ob-step-row" id="ob-proc-4">
                        <div class="ob-step-icon ob-step-pending" id="ob-p4-icon">○</div>
                        <div><div style="font-size:13px;font-weight:600;color:var(--text3)" id="ob-p4-title">Building your insights</div><div style="font-size:11px;color:var(--text3)" id="ob-p4-sub">Waiting…</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ── Screen 7: Data Verification (3 sub-steps) ── -->
        <div class="ob-screen" id="ob-7">
            <div class="ob-header" style="padding-bottom:4px">
                <div class="ob-step-dots" style="justify-content:flex-start;gap:5px">
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                    <div class="ob-step-dot"></div><div class="ob-step-dot active"></div><div class="ob-step-dot"></div>
                </div>
            </div>
            <div class="ob-body">
                <!-- Sub-step progress pips -->
                <div style="display:flex;align-items:center;gap:6px;margin-bottom:18px">
                    <div id="ob-v-pip-1" style="width:24px;height:4px;border-radius:2px;background:var(--brand);transition:all 0.3s"></div>
                    <div id="ob-v-pip-2" style="width:6px;height:4px;border-radius:2px;background:var(--text3);transition:all 0.3s"></div>
                    <div id="ob-v-pip-3" style="width:6px;height:4px;border-radius:2px;background:var(--text3);transition:all 0.3s"></div>
                    <span id="ob-v-label" style="font-size:11px;color:var(--text3);margin-left:4px">Step 1 of 3</span>
                </div>

                <!-- ── Sub-step 1: Recent Transactions ── -->
                <div id="ob-v1">
                    <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">Do these look right? 🧾</div>
                    <div style="font-size:13px;color:var(--text2);margin-bottom:16px">Here are your 5 most recent transactions. Check the merchant names and amounts are what you'd expect.</div>
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:18px">
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">Uber Eats</div><div style="font-size:11px;color:var(--text3)">19 Feb</div></div>
                            <div style="font-size:13px;font-weight:700;color:var(--red)">−$34.50</div>
                        </div>
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">Shell Coles Express</div><div style="font-size:11px;color:var(--text3)">19 Feb</div></div>
                            <div style="font-size:13px;font-weight:700;color:var(--red)">−$68.40</div>
                        </div>
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">Woolworths</div><div style="font-size:11px;color:var(--text3)">18 Feb</div></div>
                            <div style="font-size:13px;font-weight:700;color:var(--red)">−$62.80</div>
                        </div>
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">Netflix</div><div style="font-size:11px;color:var(--text3)">18 Feb</div></div>
                            <div style="font-size:13px;font-weight:700;color:var(--red)">−$22.99</div>
                        </div>
                        <div style="padding:12px 16px;display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">Acme Corp</div><div style="font-size:11px;color:var(--text3)">17 Feb · Paycheck</div></div>
                            <div style="font-size:13px;font-weight:700;color:var(--green)">+$3,240.00</div>
                        </div>
                    </div>
                    <button class="ob-btn ob-btn-primary" onclick="obVerifyStep(2)" style="margin-bottom:10px">Yes, these look correct →</button>
                    <button class="ob-btn ob-btn-ghost" onclick="obVerifyStep(2)">Something looks off — continue anyway</button>
                </div>

                <!-- ── Sub-step 2: Account Balances ── -->
                <div id="ob-v2" style="display:none">
                    <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">Are these your balances? 🏦</div>
                    <div style="font-size:13px;color:var(--text2);margin-bottom:16px">We found 3 accounts connected to your ANZ. Do these balances look right?</div>
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:10px">
                        <div style="padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">ANZ Everyday</div><div style="font-size:11px;color:var(--text3)">Everyday / Transaction</div></div>
                            <div style="font-size:15px;font-weight:700;color:var(--text)">$1,847</div>
                        </div>
                        <div style="padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">ANZ NetSaver</div><div style="font-size:11px;color:var(--text3)">Savings · 3.75% p.a.</div></div>
                            <div style="font-size:15px;font-weight:700;color:var(--text)">$12,450</div>
                        </div>
                        <div style="padding:14px 16px;display:flex;justify-content:space-between;align-items:center">
                            <div><div style="font-size:13px;font-weight:600;color:var(--text)">ANZ Credit Visa</div><div style="font-size:11px;color:var(--text3)">Credit card · $5,000 limit</div></div>
                            <div style="font-size:15px;font-weight:700;color:var(--red)">−$843</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:8px;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:18px">
                        <span>💡</span><span style="font-size:12px;color:var(--text2);line-height:1.55">All accounts at a bank connect at once — no need to authorise each one separately.</span>
                    </div>
                    <button class="ob-btn ob-btn-primary" onclick="obVerifyStep(3)" style="margin-bottom:10px">Yes, balances are correct →</button>
                    <button class="ob-btn ob-btn-ghost" onclick="obVerifyStep(3)">Something looks off — continue anyway</button>
                </div>

                <!-- ── Sub-step 3: Auto-detected Categories ── -->
                <div id="ob-v3" style="display:none">
                    <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">Auto-detected categories 🏷️</div>
                    <div style="font-size:13px;color:var(--text2);margin-bottom:10px">We've automatically sorted your 847 transactions into these categories.</div>
                    <div style="font-size:11px;color:var(--text3);padding:8px 12px;background:var(--card);border:1px solid var(--border);border-radius:10px;margin-bottom:14px">These can be changed at any time from the Accounts screen →</div>
                    <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:18px">
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:10px"><span style="font-size:18px">🏠</span><div style="font-size:13px;font-weight:600;color:var(--text)">Housing</div></div>
                            <div style="font-size:12px;color:var(--text2)">$1,600 · 28 transactions</div>
                        </div>
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:10px"><span style="font-size:18px">🍔</span><div style="font-size:13px;font-weight:600;color:var(--text)">Dining Out</div></div>
                            <div style="font-size:12px;color:var(--text2)">$341 · 18 transactions</div>
                        </div>
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:10px"><span style="font-size:18px">🛒</span><div style="font-size:13px;font-weight:600;color:var(--text)">Groceries</div></div>
                            <div style="font-size:12px;color:var(--text2)">$178 · 7 transactions</div>
                        </div>
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:10px"><span style="font-size:18px">🚗</span><div style="font-size:13px;font-weight:600;color:var(--text)">Transport</div></div>
                            <div style="font-size:12px;color:var(--text2)">$122 · 11 transactions</div>
                        </div>
                        <div style="padding:12px 16px;display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:10px"><span style="font-size:18px">📺</span><div style="font-size:13px;font-weight:600;color:var(--text)">Subscriptions</div></div>
                            <div style="font-size:12px;color:var(--text2)">$45 · 3 transactions</div>
                        </div>
                    </div>
                    <button class="ob-btn ob-btn-primary" onclick="obTo('ob-8')" style="margin-bottom:10px">Looks good, let's go →</button>
                    <button class="ob-btn ob-btn-ghost" onclick="obTo('ob-8')">I'll fix categories later</button>
                </div>
            </div>
        </div>

        <!-- ── Screen 8: First Task ── -->
        <div class="ob-screen" id="ob-8">
            <div class="ob-header" style="padding-bottom:4px">
                <div class="ob-step-dots" style="justify-content:flex-start;gap:5px">
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot"></div>
                    <div class="ob-step-dot"></div><div class="ob-step-dot"></div><div class="ob-step-dot active"></div>
                </div>
            </div>
            <div class="ob-body" style="padding-top:12px">
                <div style="font-size:22px;font-weight:800;letter-spacing:-0.8px;color:var(--text);margin-bottom:4px">One last thing 🎯</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:16px">Review a few transactions to help us learn your spending. This unlocks AI features and goal suggestions.</div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px 16px;margin-bottom:14px">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                        <span style="font-size:13px;font-weight:600;color:var(--text)">0 of 30 reviewed</span>
                        <span style="font-size:13px;font-weight:700;color:var(--brand)">0%</span>
                    </div>
                    <div class="progress-track" style="height:8px;margin-bottom:8px"><div class="progress-fill fill-brand" style="width:0%"></div></div>
                    <div style="font-size:11px;color:var(--text2)">Review 30 transactions to unlock AI insights and goal suggestions</div>
                </div>
                <div id="ob8-review-list" style="background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:14px">
                    <!-- Uber Eats -->
                    <div id="ob8-txn-1">
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border)">
                            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
                                <div><div style="font-size:14px;font-weight:600;color:var(--text)">Uber Eats</div><div style="font-size:11px;color:var(--text2)">18 Feb</div></div>
                                <div style="font-size:15px;font-weight:700;color:var(--text)">$34.50</div>
                            </div>
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <span id="ob8-pill-1" class="acct-ai-pill acct-pill-tap" onclick="ob8ChangeCat(1,'Uber Eats','Dining Out')">🍔 Dining Out ▾</span>
                                <button class="acct-approve-btn" onclick="ob8Approve(1)">Approve ✓</button>
                            </div>
                        </div>
                        <div id="ob8-bulk-1" class="acct-bulk-banner" style="display:none">
                            <span>Apply to all <strong>Uber Eats</strong> transactions? (12 total)</span>
                            <button onclick="ob8Approve(1)">Apply to all</button>
                            <button onclick="ob8Approve(1)">Just this one</button>
                        </div>
                    </div>
                    <!-- Woolworths -->
                    <div id="ob8-txn-2">
                        <div style="padding:12px 16px;border-bottom:1px solid var(--border)">
                            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
                                <div><div style="font-size:14px;font-weight:600;color:var(--text)">Woolworths</div><div style="font-size:11px;color:var(--text2)">17 Feb</div></div>
                                <div style="font-size:15px;font-weight:700;color:var(--text)">$62.80</div>
                            </div>
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <span id="ob8-pill-2" class="acct-ai-pill acct-pill-tap" onclick="ob8ChangeCat(2,'Woolworths','Groceries')">🛒 Groceries ▾</span>
                                <button class="acct-approve-btn" onclick="ob8Approve(2)">Approve ✓</button>
                            </div>
                        </div>
                        <div id="ob8-bulk-2" class="acct-bulk-banner" style="display:none">
                            <span>Apply to all <strong>Woolworths</strong> transactions? (7 total)</span>
                            <button onclick="ob8Approve(2)">Apply to all</button>
                            <button onclick="ob8Approve(2)">Just this one</button>
                        </div>
                    </div>
                    <!-- BP Fuel -->
                    <div id="ob8-txn-3">
                        <div style="padding:12px 16px">
                            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
                                <div><div style="font-size:14px;font-weight:600;color:var(--text)">BP Fuel</div><div style="font-size:11px;color:var(--text2)">15 Feb</div></div>
                                <div style="font-size:15px;font-weight:700;color:var(--text)">$91.40</div>
                            </div>
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <span id="ob8-pill-3" class="acct-ai-pill acct-pill-tap" style="background:var(--amber-light);color:var(--amber)" onclick="ob8ChangeCat(3,'BP Fuel','Transport')">🚗 Transport ▾</span>
                                <button class="acct-approve-btn" onclick="ob8Approve(3)">Approve ✓</button>
                            </div>
                        </div>
                        <div id="ob8-bulk-3" class="acct-bulk-banner" style="display:none">
                            <span>Apply to all <strong>BP Fuel</strong> transactions? (5 total)</span>
                            <button onclick="ob8Approve(3)">Apply to all</button>
                            <button onclick="ob8Approve(3)">Just this one</button>
                        </div>
                    </div>
                </div>
                <button class="ob-btn ob-btn-primary" onclick="obComplete()" style="margin-bottom:10px">Start reviewing →</button>
                <button class="ob-btn ob-btn-ghost" onclick="obComplete()">Skip for now, take me to the app</button>
            </div>
        </div>

    </div><!-- /ob-overlay -->

    <div class="bottom-nav">
        <div class="nav-item active" id="nav-home" onclick="navigate('home')">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
            <span class="nav-label">Home</span>
        </div>
        <div class="nav-item" id="nav-plan" onclick="navigate('plan')">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l7.59-7.59L21 8l-9 9z"/></svg></div>
            <span class="nav-label">Plan</span>
        </div>
        <div class="nav-item" id="nav-calendar" onclick="navigate('calendar')">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg></div>
            <span class="nav-label">Calendar</span>
        </div>
        <div class="nav-item" id="nav-accounts" onclick="navigate('accounts')">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zM11.5 1L2 6v2h19V6l-9.5-5z"/></svg></div>
            <span class="nav-label">Accounts</span>
        </div>
        <div class="nav-item" id="nav-insights" onclick="navigate('insights')">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg></div>
            <span class="nav-label">Insights</span>
        </div>
    </div>

    <!-- Persistent FAB -->
    <button class="fab" onclick="openChat()">
        ✨
        <div class="fab-dot"></div>
    </button>

    <!-- ════════════ BOTTOM SHEET (Add Goal — full multi-step flow) ════════════ -->
    <div class="sheet-backdrop" id="sheet-backdrop" onclick="closeSheet()"></div>
    <div class="bottom-sheet" id="add-goal-sheet" style="max-height:90%;overflow-y:auto;">
        <div class="sheet-handle"></div>

        <!-- Panel 0: Type picker -->
        <div id="ag-pick" style="padding:0 20px 24px;">
            <div class="sheet-title">What type of goal?</div>
            <div class="sheet-sub">Choose the type that fits what you're trying to do.</div>
            <div class="type-option to-save" onclick="agGoStep('save',1)">
                <div class="type-icon">🎯</div>
                <div><div class="type-name">Save Up</div><div class="type-desc">Set a target amount and track your progress toward it</div></div>
                <span class="type-chevron">›</span>
            </div>
            <div class="type-option to-spend" onclick="agGoStep('habit',1)">
                <div class="type-icon">📊</div>
                <div><div class="type-name">Reduce Spending</div><div class="type-desc">Set a monthly limit on a category and build a streak</div></div>
                <span class="type-chevron">›</span>
            </div>
            <div class="type-option to-debt" onclick="agGoStep('debt',1)">
                <div class="type-icon">💳</div>
                <div><div class="type-name">Pay Off Debt</div><div class="type-desc">Track your progress on clearing a credit card or loan</div></div>
                <span class="type-chevron">›</span>
            </div>
        </div>

        <!-- ── SAVE UP: Step 1 — Name & emoji ── -->
        <div id="ag-save-1" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep(null,0)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot active"></div><div class="ag-step-dot"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 1/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Name your goal</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">Pick an emoji and give it a name.</div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:6px;">Choose an emoji</div>
                <div class="ag-emoji-row" id="ag-save-emoji-row">
                    <div class="ag-emoji-btn selected" onclick="agSelectEmoji('save',this,'🏖️')">🏖️</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'✈️')">✈️</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'🏠')">🏠</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'🚗')">🚗</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'💍')">💍</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'🎓')">🎓</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'💻')">💻</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'⛵')">⛵</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'🎮')">🎮</div>
                    <div class="ag-emoji-btn" onclick="agSelectEmoji('save',this,'🌟')">🌟</div>
                </div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:6px;">Goal name</div>
                <input id="ag-save-name" type="text" placeholder="e.g. Japan Trip, House Deposit…" style="width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:12px;padding:12px 14px;font-size:14px;color:var(--text);font-family:inherit;outline:none;" onfocus="this.style.borderColor='var(--brand)'" onblur="this.style.borderColor='var(--border)'" value="Japan Trip">
                <button onclick="agGoStep('save',2)" style="margin-top:20px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Next →</button>
            </div>
        </div>

        <!-- ── SAVE UP: Step 2 — Target & auto-transfer ── -->
        <div id="ag-save-2" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep('save',1)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 2/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Set your target</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">How much do you need, and by when?</div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:6px;">Target amount</div>
                <div style="display:flex;align-items:center;background:var(--card);border:1.5px solid var(--border);border-radius:12px;padding:12px 14px;margin-bottom:16px;" onfocus-within="border-color:var(--brand)">
                    <span style="font-size:18px;font-weight:700;color:var(--text2);margin-right:6px;">$</span>
                    <input type="number" placeholder="5,000" value="5000" style="flex:1;background:transparent;border:none;font-size:18px;font-weight:800;color:var(--text);font-family:inherit;outline:none;">
                </div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px;">Deadline <span style="font-weight:400;color:var(--text3)">(optional)</span></div>
                <div class="ag-option-chips" style="margin-bottom:8px;">
                    <div class="ag-chip" onclick="agChip(this,'save-deadline');agShowDeadline(false)">3 months</div>
                    <div class="ag-chip" onclick="agChip(this,'save-deadline');agShowDeadline(false)">6 months</div>
                    <div class="ag-chip selected" onclick="agChip(this,'save-deadline');agShowDeadline(false)">12 months</div>
                    <div class="ag-chip" onclick="agChip(this,'save-deadline');agShowDeadline(false)">No deadline</div>
                    <div class="ag-chip" onclick="agChip(this,'save-deadline');agShowDeadline(true)">📅 Pick a date</div>
                </div>
                <div id="ag-deadline-picker" style="display:none;margin-bottom:14px;">
                    <input type="date" value="2027-03-15" min="2026-02-21" style="width:100%;background:var(--card);border:1.5px solid var(--brand);border-radius:12px;padding:11px 14px;font-size:14px;font-weight:600;color:var(--text);font-family:inherit;outline:none;color-scheme:dark;">
                </div>
                <div id="ag-deadline-gap" style="margin-bottom:8px;"></div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px;">Where will this money sit?</div>
                <select id="ag-save-account" style="width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:12px;padding:12px 14px;font-size:14px;font-weight:600;color:var(--text);font-family:inherit;outline:none;margin-bottom:10px;-webkit-appearance:none;appearance:none;background-image:url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2212%22 height=%228%22 viewBox=%220 0 12 8%22><path d=%22M1 1l5 5 5-5%22 stroke=%22%238B7EFF%22 stroke-width=%221.5%22 fill=%22none%22 stroke-linecap=%22round%22/></svg>');background-repeat:no-repeat;background-position:right 14px center;padding-right:36px;">
                    <option value="netsaver" selected>ANZ NetSaver · $12,450</option>
                    <option value="everyday">ANZ Everyday · $1,847</option>
                </select>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px;font-size:12px;color:var(--text2);line-height:1.6;margin-bottom:4px;">
                    💡 When money arrives in this account, Totem will prompt you to attribute it to this goal. If it's the only goal linked to this account, deposits will be auto-reconciled — no prompts needed.
                </div>
                <button onclick="agGoStep('save',3)" style="margin-top:18px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Next →</button>
            </div>
        </div>

        <!-- ── SAVE UP: Step 3 — Review & publish ── -->
        <div id="ag-save-3" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep('save',2)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div></div>
                <div class="ag-step-lbl">Step 3/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Looks good!</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">Review your goal before publishing.</div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px;">
                    <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;">
                        <div style="font-size:28px;" id="ag-save-preview-emoji">🏖️</div>
                        <div>
                            <div style="font-size:16px;font-weight:800;color:var(--text);" id="ag-save-preview-name">Japan Trip</div>
                            <div style="font-size:11px;color:var(--text2);">Save Up Goal</div>
                        </div>
                        <span class="badge badge-green" style="margin-left:auto;">On Track</span>
                    </div>
                    <div class="progress-track" style="margin-bottom:10px;"><div class="progress-fill fill-brand" style="width:0%"></div></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--text2);margin-bottom:12px;"><span>$0 saved</span><span>Target: $5,000</span></div>
                    <div style="display:flex;gap:8px;">
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Target</div>
                            <div style="font-size:14px;font-weight:800;color:var(--text);">$5,000</div>
                        </div>
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">ETA</div>
                            <div style="font-size:14px;font-weight:800;color:var(--text);">Feb 2027</div>
                        </div>
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Saved in</div>
                            <div style="font-size:13px;font-weight:800;color:var(--brand);">NetSaver</div>
                        </div>
                    </div>
                </div>
                <div style="background:var(--brand-light);border:1px solid rgba(139,126,255,0.2);border-radius:12px;padding:12px 14px;font-size:12px;color:var(--text2);line-height:1.5;margin-bottom:18px;">
                    💡 Totem will watch ANZ NetSaver for deposits and attribute them to this goal. You transfer the money yourself — Totem just keeps score.
                </div>
                <button onclick="agPublish('save')" style="width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Publish Goal 🎯</button>
            </div>
        </div>

        <!-- ── SPENDING HABIT: Step 1 — Choose category ── -->
        <div id="ag-habit-1" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep(null,0)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot active"></div><div class="ag-step-dot"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 1/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Which category?</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:16px;">We'll use your 3-month average as the baseline.</div>
                <div class="ag-cat-grid" id="ag-habit-cat-grid">
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Dining Out','🍔','$620')"><span class="ag-cat-emoji">🍔</span><span class="ag-cat-name">Dining Out</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Groceries','🛒','$412')"><span class="ag-cat-emoji">🛒</span><span class="ag-cat-name">Groceries</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Entertainment','🎬','$187')"><span class="ag-cat-emoji">🎬</span><span class="ag-cat-name">Entertainment</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Transport','🚗','$224')"><span class="ag-cat-emoji">🚗</span><span class="ag-cat-name">Transport</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Shopping','🛍️','$342')"><span class="ag-cat-emoji">🛍️</span><span class="ag-cat-name">Shopping</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Coffee','☕','$96')"><span class="ag-cat-emoji">☕</span><span class="ag-cat-name">Coffee</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Subscriptions','📱','$287')"><span class="ag-cat-emoji">📱</span><span class="ag-cat-name">Subscriptions</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Personal Care','💇','$78')"><span class="ag-cat-emoji">💇</span><span class="ag-cat-name">Personal Care</span></div>
                    <div class="ag-cat-item" onclick="agSelectHabitCat(this,'Health','🏥','$52')"><span class="ag-cat-emoji">🏥</span><span class="ag-cat-name">Health</span></div>
                </div>
                <div id="ag-habit-avg-banner" style="display:none;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px;margin-top:4px;font-size:13px;color:var(--text2);">
                    Your 3-month average: <strong id="ag-habit-avg-val" style="color:var(--text);">$0</strong>/mo
                </div>
                <button id="ag-habit-next-1" onclick="agGoStep('habit',2)" style="margin-top:16px;width:100%;background:rgba(139,126,255,0.3);color:var(--text3);border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:not-allowed;font-family:inherit;" disabled>Select a category first</button>
            </div>
        </div>

        <!-- ── SPENDING HABIT: Step 2 — Set target ── -->
        <div id="ag-habit-2" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep('habit',1)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 2/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Set your target</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:4px;">3-month baseline: <strong style="color:var(--text);" id="ag-habit-baseline">$620/mo</strong></div>
                <div style="font-size:12px;color:var(--text3);margin-bottom:18px;">This baseline is locked at creation and won't change.</div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px;">Reduce by</div>
                <div class="ag-option-chips" id="ag-habit-target-chips">
                    <div class="ag-chip" onclick="agChip(this,'habit-target')">−10% <span style="font-size:11px;opacity:0.7">($558/mo)</span></div>
                    <div class="ag-chip selected" onclick="agChip(this,'habit-target')">−20% <span style="font-size:11px;opacity:0.7">($496/mo)</span></div>
                    <div class="ag-chip" onclick="agChip(this,'habit-target')">−30% <span style="font-size:11px;opacity:0.7">($434/mo)</span></div>
                    <div class="ag-chip" onclick="agChip(this,'habit-target')">Custom</div>
                </div>
                <div style="background:var(--teal-light);border:1px solid rgba(78,205,196,0.2);border-radius:12px;padding:12px 14px;margin-top:12px;font-size:13px;color:var(--text2);line-height:1.55;">
                    🎯 At −20%, you'd save <strong style="color:var(--teal)">$124/mo</strong> — that's <strong style="color:var(--teal)">$1,488/year</strong>
                </div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px;margin-top:12px;font-size:12px;color:var(--text2);line-height:1.5;">
                    🔥 Streak tracking starts immediately · Renews monthly · Missing by &lt;5% still counts as a win
                </div>
                <button onclick="agGoStep('habit',3)" style="margin-top:18px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Next →</button>
            </div>
        </div>

        <!-- ── SPENDING HABIT: Step 3 — Review ── -->
        <div id="ag-habit-3" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep('habit',2)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div></div>
                <div class="ag-step-lbl">Step 3/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Looks good!</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">Your Spending Habit goal is ready.</div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px;">
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
                        <div style="font-size:28px;">🍔</div>
                        <div><div style="font-size:16px;font-weight:800;color:var(--text);">Dining Out</div><div style="font-size:11px;color:var(--text2);">Spending Habit</div></div>
                        <span class="badge badge-teal" style="margin-left:auto;">Month 1</span>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Baseline</div>
                            <div style="font-size:14px;font-weight:800;color:var(--text);">$620/mo</div>
                        </div>
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Target</div>
                            <div style="font-size:14px;font-weight:800;color:var(--teal);">$496/mo</div>
                        </div>
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Monthly save</div>
                            <div style="font-size:14px;font-weight:800;color:var(--green);">$124</div>
                        </div>
                    </div>
                </div>
                <button onclick="agPublish('habit')" style="width:100%;background:var(--teal);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Publish Goal 📊</button>
            </div>
        </div>

        <!-- ── DEBT PAYDOWN: Step 1 — Choose debt ── -->
        <div id="ag-debt-1" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep(null,0)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot active"></div><div class="ag-step-dot"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 1/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Which debt?</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:16px;">We found these from your connected accounts.</div>
                <div style="background:var(--card);border-radius:14px;overflow:hidden;margin-bottom:12px;">
                    <div onclick="agSelectDebt(this,'ANZ Credit Visa','843')" style="display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;border:2px solid var(--brand);border-radius:14px;background:var(--brand-light);">
                        <div style="font-size:22px;">💳</div>
                        <div style="flex:1;">
                            <div style="font-size:14px;font-weight:700;color:var(--text);">ANZ Credit Visa</div>
                            <div style="font-size:11px;color:var(--text2);">Current balance · Auto-detected</div>
                        </div>
                        <div style="font-size:15px;font-weight:800;color:var(--red);">−$843</div>
                        <div style="font-size:16px;color:var(--brand);">✓</div>
                    </div>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:14px 0;"><div style="flex:1;height:1px;background:var(--border);"></div><span style="font-size:12px;color:var(--text3);">or</span><div style="flex:1;height:1px;background:var(--border);"></div></div>
                <div onclick="agSelectDebt(this,'Personal Loan','12000')" style="display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border:1.5px solid var(--border);border-radius:12px;cursor:pointer;">
                    <div style="font-size:22px;">🏦</div>
                    <div style="flex:1;">
                        <div style="font-size:14px;font-weight:700;color:var(--text);">Enter manually</div>
                        <div style="font-size:11px;color:var(--text2);">For loans not in your connected accounts</div>
                    </div>
                    <span style="font-size:18px;color:var(--text3);">›</span>
                </div>
                <button onclick="agGoStep('debt',2)" style="margin-top:20px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Next →</button>
            </div>
        </div>

        <!-- ── DEBT PAYDOWN: Step 2 — Monthly payment ── -->
        <div id="ag-debt-2" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep('debt',1)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 2/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Set your repayments</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">How much do you want to pay off each month?</div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px;margin-bottom:14px;">
                    <div style="font-size:11px;color:var(--text2);margin-bottom:3px;">Current balance</div>
                    <div style="font-size:22px;font-weight:800;color:var(--red);">−$843</div>
                    <div style="font-size:11px;color:var(--text3);margin-top:2px;">From ANZ Credit Visa · updated 19 Feb</div>
                </div>
                <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:8px;">Monthly payment target</div>
                <div class="ag-option-chips" style="margin-bottom:12px;">
                    <div class="ag-chip" onclick="agChip(this,'debt-payment')">Min (~$25)</div>
                    <div class="ag-chip selected" onclick="agChip(this,'debt-payment')">$150/mo</div>
                    <div class="ag-chip" onclick="agChip(this,'debt-payment')">$300/mo</div>
                    <div class="ag-chip" onclick="agChip(this,'debt-payment')">Custom</div>
                </div>
                <div style="background:var(--green-light);border:1px solid rgba(81,207,102,0.2);border-radius:12px;padding:12px 14px;font-size:13px;color:var(--text2);line-height:1.55;">
                    💸 At $150/mo, you'll be <strong style="color:var(--green)">debt-free in 6 months</strong> — saving ~$48 in interest vs. minimums
                </div>
                <button onclick="agGoStep('debt',3)" style="margin-top:18px;width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Next →</button>
            </div>
        </div>

        <!-- ── DEBT PAYDOWN: Step 3 — Review ── -->
        <div id="ag-debt-3" style="display:none;">
            <div class="ag-step-hd">
                <div class="ag-step-back" onclick="agGoStep('debt',2)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div></div>
                <div class="ag-step-lbl">Step 3/3</div>
            </div>
            <div style="padding:0 20px 24px;">
                <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Looks good!</div>
                <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">Your Debt Paydown goal is ready.</div>
                <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px;">
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
                        <div style="font-size:28px;">💳</div>
                        <div><div style="font-size:16px;font-weight:800;color:var(--text);">ANZ Credit Visa</div><div style="font-size:11px;color:var(--text2);">Debt Paydown</div></div>
                        <span class="badge badge-green" style="margin-left:auto;">On Track</span>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Balance</div>
                            <div style="font-size:14px;font-weight:800;color:var(--red);">$843</div>
                        </div>
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Monthly</div>
                            <div style="font-size:14px;font-weight:800;color:var(--green);">$150</div>
                        </div>
                        <div style="flex:1;background:var(--bg);border-radius:10px;padding:10px;text-align:center;">
                            <div style="font-size:11px;color:var(--text2);margin-bottom:2px;">Debt-free</div>
                            <div style="font-size:14px;font-weight:800;color:var(--text);">Aug 2026</div>
                        </div>
                    </div>
                </div>
                <button onclick="agPublish('debt')" style="width:100%;background:var(--green);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Publish Goal 💳</button>
            </div>
        </div>
    </div>

    <!-- ════════════ GOAL DETAIL SHEET ════════════ -->
    <div class="sheet-backdrop" id="goal-detail-backdrop" onclick="closeGoalDetail()"></div>
    <div class="bottom-sheet" id="goal-detail-sheet" style="max-height:86%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div id="goal-detail-content" style="padding:0 20px 28px;"></div>
    </div>

    <!-- ════════════ GOAL ALLOCATION SHEET ════════════ -->
    <div class="sheet-backdrop" id="goal-alloc-backdrop" onclick="closeGoalAlloc()"></div>
    <div class="bottom-sheet" id="goal-alloc-sheet" style="max-height:82%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 28px;">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
                <div id="goal-alloc-icon" style="width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;background:var(--green-light);">💰</div>
                <div>
                    <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;" id="goal-alloc-type-label">New Deposit Detected</div>
                    <div style="font-size:17px;font-weight:800;color:var(--text);" id="goal-alloc-title">Allocate $300</div>
                </div>
            </div>
            <div style="font-size:13px;color:var(--text2);margin-bottom:20px;" id="goal-alloc-sub">You transferred $300 to ANZ NetSaver on Thu 19 Feb. Which goal should this go toward? You can split it across goals.</div>
            <div style="background:var(--card);border-radius:14px;padding:6px 16px;margin-bottom:16px;">
                <div class="goal-alloc-split">
                    <span style="font-size:18px;">🏖️</span>
                    <span style="flex:1;font-size:13px;font-weight:600;color:var(--text);">Japan Trip</span>
                    <button onclick="goalAllocAll(this)" style="font-size:11px;font-weight:700;color:var(--brand);background:var(--brand-light);border:1px solid rgba(139,126,255,0.3);border-radius:8px;padding:4px 9px;cursor:pointer;font-family:inherit;white-space:nowrap;flex-shrink:0;">All</button>
                    <div style="display:flex;align-items:center;gap:4px;"><span style="font-size:14px;color:var(--text2);">$</span><input type="number" class="goal-alloc-input" value="300" placeholder="0"></div>
                </div>
                <div class="goal-alloc-split">
                    <span style="font-size:18px;">🛡️</span>
                    <span style="flex:1;font-size:13px;font-weight:600;color:var(--text);">Safety Net</span>
                    <button onclick="goalAllocAll(this)" style="font-size:11px;font-weight:700;color:var(--brand);background:var(--brand-light);border:1px solid rgba(139,126,255,0.3);border-radius:8px;padding:4px 9px;cursor:pointer;font-family:inherit;white-space:nowrap;flex-shrink:0;">All</button>
                    <div style="display:flex;align-items:center;gap:4px;"><span style="font-size:14px;color:var(--text2);">$</span><input type="number" class="goal-alloc-input" value="0" placeholder="0"></div>
                </div>
                <div class="goal-alloc-split" style="border-bottom:none;">
                    <span style="font-size:18px;">💳</span>
                    <span style="flex:1;font-size:13px;font-weight:600;color:var(--text);">ANZ Visa</span>
                    <button onclick="goalAllocAll(this)" style="font-size:11px;font-weight:700;color:var(--brand);background:var(--brand-light);border:1px solid rgba(139,126,255,0.3);border-radius:8px;padding:4px 9px;cursor:pointer;font-family:inherit;white-space:nowrap;flex-shrink:0;">All</button>
                    <div style="display:flex;align-items:center;gap:4px;"><span style="font-size:14px;color:var(--text2);">$</span><input type="number" class="goal-alloc-input" value="0" placeholder="0"></div>
                </div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:16px;">
                <span style="color:var(--text2);">Total to allocate: <strong style="color:var(--text);">$300</strong></span>
                <span id="goal-alloc-remaining" style="color:var(--green);font-weight:700;">$0 unallocated</span>
            </div>
            <button onclick="confirmGoalAlloc()" style="width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Allocate to Goals ✓</button>
            <button onclick="closeGoalAlloc()" style="width:100%;background:transparent;border:none;color:var(--text2);font-size:13px;padding:12px;cursor:pointer;font-family:inherit;">Skip for now</button>
        </div>
    </div>

    <!-- ════════════ BUDGET DETAIL SHEET ════════════ -->
    <div class="sheet-backdrop" id="budget-detail-backdrop" onclick="closeBudgetDetail()"></div>
    <div class="bottom-sheet" id="budget-detail-sheet" style="max-height:86%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div id="budget-detail-content" style="padding:0 20px 28px;"></div>
    </div>

    <!-- ════════════ ADD BUDGET SHEET ════════════ -->
    <div class="sheet-backdrop" id="add-budget-backdrop" onclick="closeAddBudget()"></div>
    <div class="bottom-sheet" id="add-budget-sheet" style="max-height:90%;overflow-y:auto;">
        <div class="sheet-handle"></div>

        <!-- Step 1: Category -->
        <div id="ab-step-1" style="padding:0 20px 24px;">
            <div class="ag-step-hd" style="padding:0 0 18px;">
                <div class="ag-step-back" onclick="closeAddBudget()">✕</div>
                <div class="ag-step-dots"><div class="ag-step-dot active"></div><div class="ag-step-dot"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 1/3</div>
            </div>
            <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Choose a category</div>
            <div style="font-size:13px;color:var(--text2);margin-bottom:16px;">We'll show your current monthly average.</div>
            <div class="ag-cat-grid">
                <div class="ag-cat-item" onclick="abSelectCat(this,'Groceries','🛒','$412')"><span class="ag-cat-emoji">🛒</span><span class="ag-cat-name">Groceries</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Dining Out','🍔','$341')"><span class="ag-cat-emoji">🍔</span><span class="ag-cat-name">Dining Out</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Entertainment','🎬','$60')"><span class="ag-cat-emoji">🎬</span><span class="ag-cat-name">Entertainment</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Transport','🚗','$290')"><span class="ag-cat-emoji">🚗</span><span class="ag-cat-name">Transport</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Shopping','🛍️','$375')"><span class="ag-cat-emoji">🛍️</span><span class="ag-cat-name">Shopping</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Coffee','☕','$142')"><span class="ag-cat-emoji">☕</span><span class="ag-cat-name">Coffee</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Health','🏥','$88')"><span class="ag-cat-emoji">🏥</span><span class="ag-cat-name">Health</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Subscriptions','📱','$287')"><span class="ag-cat-emoji">📱</span><span class="ag-cat-name">Subscriptions</span></div>
                <div class="ag-cat-item" onclick="abSelectCat(this,'Personal Care','💇','$78')"><span class="ag-cat-emoji">💇</span><span class="ag-cat-name">Personal Care</span></div>
            </div>
            <div id="ab-avg-banner" style="display:none;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px;margin-top:4px;font-size:13px;color:var(--text2);">
                Your current monthly spend: <strong id="ab-avg-val" style="color:var(--text);">$0</strong>
            </div>
            <button id="ab-next-1" onclick="abGoStep(2)" style="margin-top:16px;width:100%;background:rgba(139,126,255,0.3);color:var(--text3);border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:not-allowed;font-family:inherit;" disabled>Select a category first</button>
        </div>

        <!-- Step 2: Set limit -->
        <div id="ab-step-2" style="display:none;padding:0 20px 24px;">
            <div class="ag-step-hd" style="padding:0 0 18px;">
                <div class="ag-step-back" onclick="abGoStep(1)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div><div class="ag-step-dot"></div></div>
                <div class="ag-step-lbl">Step 2/3</div>
            </div>
            <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Set your monthly limit</div>
            <div style="font-size:13px;color:var(--text2);margin-bottom:16px;">Based on your recent spending — pick a preset or enter your own.</div>
            <div class="ag-option-chips" id="ab-preset-chips">
                <div class="ag-chip" onclick="abSetPreset(this,'same')">Same as avg</div>
                <div class="ag-chip selected" onclick="abSetPreset(this,'10less')">10% less</div>
                <div class="ag-chip" onclick="abSetPreset(this,'20less')">20% less</div>
                <div class="ag-chip" onclick="abSetPreset(this,'custom')">Custom</div>
            </div>
            <div style="display:flex;align-items:center;background:var(--card);border:1.5px solid var(--brand);border-radius:12px;padding:12px 14px;margin:14px 0;">
                <span style="font-size:18px;font-weight:700;color:var(--text2);margin-right:6px;">$</span>
                <input type="number" id="ab-limit-input" value="540" style="flex:1;background:transparent;border:none;font-size:20px;font-weight:800;color:var(--text);font-family:inherit;outline:none;">
                <span style="font-size:12px;color:var(--text2);">/month</span>
            </div>
            <div id="ab-limit-info" style="font-size:12px;color:var(--text2);margin-bottom:18px;padding:10px 14px;background:var(--card);border-radius:10px;">
                10% below your $600 average · Equivalent to <strong style="color:var(--text);">$135/week</strong>
            </div>
            <button onclick="abGoStep(3)" style="width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Next →</button>
        </div>

        <!-- Step 3: Review & publish -->
        <div id="ab-step-3" style="display:none;padding:0 20px 24px;">
            <div class="ag-step-hd" style="padding:0 0 18px;">
                <div class="ag-step-back" onclick="abGoStep(2)">‹</div>
                <div class="ag-step-dots"><div class="ag-step-dot done"></div><div class="ag-step-dot done"></div><div class="ag-step-dot active"></div></div>
                <div class="ag-step-lbl">Step 3/3</div>
            </div>
            <div style="font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px;">Review your budget</div>
            <div style="font-size:13px;color:var(--text2);margin-bottom:20px;">This will appear in your Budget Burn Rate from today.</div>
            <div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px;">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
                    <div style="display:flex;align-items:center;gap:10px;"><span style="font-size:22px;" id="ab-preview-emoji">🛒</span><span style="font-size:16px;font-weight:800;color:var(--text);" id="ab-preview-name">Groceries</span></div>
                    <span class="badge badge-green">On Track</span>
                </div>
                <div class="progress-track" style="margin-bottom:8px;position:relative;">
                    <div class="period-marker" style="left:68%"></div>
                    <div class="progress-fill fill-green" style="width:0%"></div>
                </div>
                <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--text2);">
                    <span>$0 spent</span><span id="ab-preview-limit">Limit: $540/mo</span>
                </div>
            </div>
            <div style="background:var(--brand-light);border:1px solid rgba(139,126,255,0.2);border-radius:12px;padding:12px 14px;font-size:12px;color:var(--text2);line-height:1.5;margin-bottom:18px;">
                💡 Want to link this budget to a Spending Habit goal? You can do that from the budget detail after publishing.
            </div>
            <button onclick="abPublish()" style="width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Publish Budget</button>
        </div>
    </div>

    <!-- ════════════ CALENDAR DAY DETAIL SHEET ════════════ -->
    <div class="sheet-backdrop" id="cal-backdrop" onclick="closeCalSheet()"></div>
    <div class="bottom-sheet" id="cal-day-sheet" style="max-height:72%;">
        <div class="sheet-handle"></div>
        <div id="cal-sheet-content" style="overflow-y:auto;max-height:calc(72vh - 60px);scrollbar-width:none;padding-bottom:4px"></div>
    </div>

    <!-- ════════════ ACCOUNTS: ACCOUNT DETAIL SHEET ════════════ -->
    <div class="sheet-backdrop" id="acct-acct-backdrop" onclick="closeAcctSheet()"></div>
    <div class="bottom-sheet" id="acct-acct-sheet" style="max-height:75%;">
        <div class="sheet-handle"></div>
        <div id="acct-acct-content" style="overflow-y:auto;max-height:calc(75vh - 60px);scrollbar-width:none;padding:0 20px 20px"></div>
    </div>

    <!-- ════════════ ACCOUNTS: CATEGORY PICKER SHEET ════════════ -->
    <div class="sheet-backdrop" id="acct-cat-backdrop" onclick="closeCatSheet()"></div>
    <div class="bottom-sheet" id="acct-cat-sheet" style="max-height:65%;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 20px">
            <div style="font-size:17px;font-weight:800;color:var(--text);margin-bottom:4px">Correct Category</div>
            <div style="font-size:12px;color:var(--text2);margin-bottom:16px">Categorising: <strong id="acct-cat-merchant" style="color:var(--text)"></strong></div>
            <div class="acct-cat-grid">
                <div class="acct-cat-option" onclick="pickCategory('Groceries','🛒')">
                    <span class="acct-cat-icon">🛒</span><span class="acct-cat-name">Groceries</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Dining Out','🍜')">
                    <span class="acct-cat-icon">🍜</span><span class="acct-cat-name">Dining Out</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Coffee & Drinks','☕')">
                    <span class="acct-cat-icon">☕</span><span class="acct-cat-name">Coffee &amp; Drinks</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Transport','🚌')">
                    <span class="acct-cat-icon">🚌</span><span class="acct-cat-name">Transport</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Entertainment','🎬')">
                    <span class="acct-cat-icon">🎬</span><span class="acct-cat-name">Entertainment</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Health & Wellness','🏥')">
                    <span class="acct-cat-icon">🏥</span><span class="acct-cat-name">Health &amp; Wellness</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Shopping','🛍️')">
                    <span class="acct-cat-icon">🛍️</span><span class="acct-cat-name">Shopping</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Utilities','💡')">
                    <span class="acct-cat-icon">💡</span><span class="acct-cat-name">Utilities</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Subscriptions','📱')">
                    <span class="acct-cat-icon">📱</span><span class="acct-cat-name">Subscriptions</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Personal Care','💇')">
                    <span class="acct-cat-icon">💇</span><span class="acct-cat-name">Personal Care</span>
                </div>
                <div class="acct-cat-option" onclick="pickCategory('Other','📦')">
                    <span class="acct-cat-icon">📦</span><span class="acct-cat-name">Other</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ════════════ OB8 CATEGORY PICKER ════════════ -->
    <div class="sheet-backdrop" id="ob8-cat-backdrop" onclick="ob8CloseCat()"></div>
    <div class="bottom-sheet" id="ob8-cat-sheet" style="max-height:65%;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 20px">
            <div style="font-size:17px;font-weight:800;color:var(--text);margin-bottom:4px">Change Category</div>
            <div style="font-size:12px;color:var(--text2);margin-bottom:16px">Changing: <strong id="ob8-cat-merchant" style="color:var(--text)"></strong></div>
            <div class="acct-cat-grid">
                <div class="acct-cat-option" onclick="ob8PickCat('Groceries','🛒')"><span class="acct-cat-icon">🛒</span><span class="acct-cat-name">Groceries</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Dining Out','🍔')"><span class="acct-cat-icon">🍔</span><span class="acct-cat-name">Dining Out</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Coffee &amp; Drinks','☕')"><span class="acct-cat-icon">☕</span><span class="acct-cat-name">Coffee &amp; Drinks</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Transport','🚗')"><span class="acct-cat-icon">🚗</span><span class="acct-cat-name">Transport</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Fuel','⛽')"><span class="acct-cat-icon">⛽</span><span class="acct-cat-name">Fuel</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Entertainment','🎬')"><span class="acct-cat-icon">🎬</span><span class="acct-cat-name">Entertainment</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Health &amp; Wellness','🏥')"><span class="acct-cat-icon">🏥</span><span class="acct-cat-name">Health &amp; Wellness</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Shopping','🛍️')"><span class="acct-cat-icon">🛍️</span><span class="acct-cat-name">Shopping</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Subscriptions','📱')"><span class="acct-cat-icon">📱</span><span class="acct-cat-name">Subscriptions</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Utilities','💡')"><span class="acct-cat-icon">💡</span><span class="acct-cat-name">Utilities</span></div>
                <div class="acct-cat-option" onclick="ob8PickCat('Other','📦')"><span class="acct-cat-icon">📦</span><span class="acct-cat-name">Other</span></div>
            </div>
        </div>
    </div>

    <!-- ════════════ CREATE RULE SHEET ════════════ -->
    <div class="sheet-backdrop" id="acct-rule-backdrop" onclick="closeRuleSheet()"></div>
    <div class="bottom-sheet" id="acct-rule-sheet" style="max-height:88%;overflow-y:auto">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 28px">
            <div style="font-size:17px;font-weight:800;color:var(--text);margin-bottom:4px">Create Auto-categorisation Rule</div>
            <div style="font-size:12px;color:var(--text2);margin-bottom:20px">Totem will apply this rule automatically to matching transactions — past and future.</div>

            <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px">Condition</div>
            <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:16px">
                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
                    <span style="font-size:12px;color:var(--text2)">Where merchant name</span>
                    <select class="acct-rule-select" id="rule-cond-type">
                        <option>includes</option>
                        <option>is exactly</option>
                        <option>starts with</option>
                        <option>does not contain</option>
                    </select>
                </div>
                <input class="acct-rule-input" id="rule-merchant-val" style="width:100%;box-sizing:border-box" value="Shell Coles Express">
            </div>

            <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px">Amount Filter <span style="font-weight:400;text-transform:none">(optional)</span></div>
            <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:16px">
                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                    <select class="acct-rule-select" id="rule-amt-type" onchange="toggleAmtInput(this)">
                        <option value="">No amount filter</option>
                        <option>is under</option>
                        <option>is over</option>
                        <option>is between</option>
                    </select>
                    <input class="acct-rule-input" id="rule-amt-val1" placeholder="$0" style="width:70px;display:none">
                    <span id="rule-amt-and" style="font-size:12px;color:var(--text2);display:none">and</span>
                    <input class="acct-rule-input" id="rule-amt-val2" placeholder="$0" style="width:70px;display:none">
                </div>
                <div style="font-size:11px;color:var(--text3);margin-top:8px">Example: Shell &lt; $25 → Food; Shell &gt; $40 → Fuel</div>
            </div>

            <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px">Then Set Category To</div>
            <div class="acct-cat-grid" style="margin-bottom:16px" id="add-rule-cat-grid">
                <div class="acct-cat-option" onclick="pickAddRuleCat('Groceries','🛒',this)"><span class="acct-cat-icon">🛒</span><span class="acct-cat-name">Groceries</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Dining Out','🍜',this)"><span class="acct-cat-icon">🍜</span><span class="acct-cat-name">Dining Out</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Coffee &amp; Drinks','☕',this)"><span class="acct-cat-icon">☕</span><span class="acct-cat-name">Coffee &amp; Drinks</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Transport','🚌',this)"><span class="acct-cat-icon">🚌</span><span class="acct-cat-name">Transport</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Fuel','⛽',this)"><span class="acct-cat-icon">⛽</span><span class="acct-cat-name">Fuel</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Entertainment','🎬',this)"><span class="acct-cat-icon">🎬</span><span class="acct-cat-name">Entertainment</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Health &amp; Wellness','🏥',this)"><span class="acct-cat-icon">🏥</span><span class="acct-cat-name">Health &amp; Wellness</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Shopping','🛍️',this)"><span class="acct-cat-icon">🛍️</span><span class="acct-cat-name">Shopping</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Subscriptions','📱',this)"><span class="acct-cat-icon">📱</span><span class="acct-cat-name">Subscriptions</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Utilities','💡',this)"><span class="acct-cat-icon">💡</span><span class="acct-cat-name">Utilities</span></div>
                <div class="acct-cat-option" onclick="pickAddRuleCat('Other','📦',this)"><span class="acct-cat-icon">📦</span><span class="acct-cat-name">Other</span></div>
            </div>

            <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px">Affected Transactions</div>
            <div id="rule-affected" style="background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:20px">
                <div style="padding:10px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                    <span style="font-size:12px;font-weight:600;color:var(--text)" id="rule-aff-name-1">Shell Coles Express</span>
                    <span style="font-size:12px;color:var(--red)">−$68.40 · Feb 19</span>
                </div>
                <div style="padding:10px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                    <span style="font-size:12px;font-weight:600;color:var(--text)" id="rule-aff-name-2">Shell Coles Express</span>
                    <span style="font-size:12px;color:var(--red)">−$71.20 · Feb 4</span>
                </div>
                <div style="padding:10px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                    <span style="font-size:12px;font-weight:600;color:var(--text)" id="rule-aff-name-3">Shell Coles Express</span>
                    <span style="font-size:12px;color:var(--red)">−$55.90 · Jan 21</span>
                </div>
                <div style="padding:10px 14px;display:flex;justify-content:space-between;align-items:center">
                    <span style="font-size:12px;font-weight:600;color:var(--text)" id="rule-aff-name-4">Shell Coles Express</span>
                    <span style="font-size:12px;color:var(--red)">−$82.10 · Jan 7</span>
                </div>
            </div>

            <button class="btn-primary" id="rule-apply-btn" onclick="applyRule()" style="width:100%;padding:14px;border-radius:14px;border:none;background:rgba(139,126,255,0.3);color:var(--text3);font-size:14px;font-weight:700;cursor:not-allowed;font-family:inherit">Select a category first</button>
        </div>
    </div>

    <!-- ════════════ DASHBOARD: PROFILE SHEET ════════════ -->
    <div class="sheet-backdrop" id="dash-profile-backdrop" onclick="closeProfileSheet()"></div>
    <div class="bottom-sheet" id="dash-profile-sheet" style="max-height:82%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 28px;">
            <div style="text-align:center;padding-bottom:18px;border-bottom:1px solid var(--border);margin-bottom:16px;">
                <div class="profile-avatar">AL</div>
                <div class="profile-name">Alex Johnson</div>
                <div class="profile-email">alex@gmail.com</div>
                <div style="margin-top:10px;display:inline-flex;align-items:center;gap:6px;background:var(--card);border:1px solid var(--border);border-radius:20px;padding:5px 14px;">
                    <div style="width:7px;height:7px;border-radius:50%;background:var(--green);flex-shrink:0;"></div>
                    <span style="font-size:11px;color:var(--text2);">ANZ connected via Basiq</span>
                </div>
            </div>

            <!-- Money Personality section -->
            <div class="section-hd" style="margin-bottom:10px"><div class="section-title">Money Personality</div></div>
            <!-- Pre-quiz empty state -->
            <div id="profile-arch-empty" style="background:var(--card);border:1.5px dashed var(--border);border-radius:14px;padding:16px;text-align:center;margin-bottom:16px">
                <div style="font-size:22px;margin-bottom:6px">✨</div>
                <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:4px">Not yet personalised</div>
                <div style="font-size:12px;color:var(--text2);line-height:1.55">Open the AI chat and have a short conversation — the AI will ask you 6 quick questions to unlock your money personality.</div>
            </div>
            <!-- Post-quiz archetype banner -->
            <div class="profile-arch-banner" id="profile-arch-banner" style="display:none;margin-bottom:16px">
                <div class="profile-arch-banner-top">
                    <div class="profile-arch-big-icon" id="profile-arch-icon">🛡️</div>
                    <div>
                        <div class="profile-arch-name" id="profile-arch-name">The Guardian</div>
                        <div class="profile-arch-label" id="profile-arch-label">Money Vigilance</div>
                    </div>
                </div>
                <div class="profile-arch-desc" id="profile-arch-desc"></div>
                <div class="profile-arch-note" id="profile-arch-note"></div>
                <button onclick="retakeQuiz()" style="margin-top:12px;width:100%;background:transparent;border:1.5px solid var(--border);border-radius:10px;padding:9px;font-size:12px;font-weight:600;color:var(--text2);font-family:inherit;cursor:pointer">↩ Retake personality quiz</button>
            </div>

            <div style="padding:4px 0;">
                <div class="profile-row">
                    <span class="profile-row-icon">💳</span>
                    <span class="profile-row-label">Pay Cycle</span>
                    <span class="profile-row-val">Fortnightly · Thursdays</span>
                    <span class="profile-row-arrow">›</span>
                </div>
                <div class="profile-row">
                    <span class="profile-row-icon">🏦</span>
                    <span class="profile-row-label">Connected Accounts</span>
                    <span class="profile-row-val">ANZ · 3 accounts</span>
                    <span class="profile-row-arrow">›</span>
                </div>
                <div class="profile-row">
                    <span class="profile-row-icon">🔔</span>
                    <span class="profile-row-label">Notifications</span>
                    <span class="profile-row-val">On</span>
                    <span class="profile-row-arrow">›</span>
                </div>
                <div class="profile-row">
                    <span class="profile-row-icon">🌙</span>
                    <span class="profile-row-label">Appearance</span>
                    <span class="profile-row-val">Midnight Blue</span>
                    <span class="profile-row-arrow">›</span>
                </div>
                <div class="profile-row">
                    <span class="profile-row-icon">🔒</span>
                    <span class="profile-row-label">Privacy &amp; Security</span>
                    <span class="profile-row-val"></span>
                    <span class="profile-row-arrow">›</span>
                </div>
                <div class="profile-row" onclick="closeProfileSheet()">
                    <span class="profile-row-icon">🚪</span>
                    <span class="profile-row-label" style="color:var(--red)">Sign Out</span>
                    <span class="profile-row-val"></span>
                </div>
            </div>
            <div style="font-size:11px;color:var(--text3);text-align:center;margin-top:16px;">Member since January 2026 · Totem v2.1.0</div>
        </div>
    </div>

    <!-- ════════════ DASHBOARD: AI INSIGHT BREAKDOWN ════════════ -->
    <div class="sheet-backdrop" id="dash-insight-backdrop" onclick="closeInsightSheet()"></div>
    <div class="bottom-sheet" id="dash-insight-sheet" style="max-height:84%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 28px;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:18px;">
                <div style="width:44px;height:44px;background:rgba(255,82,82,0.12);border-radius:13px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;">🍔</div>
                <div>
                    <div style="font-size:11px;font-weight:700;color:var(--amber);text-transform:uppercase;letter-spacing:0.5px;">⚠ Spending Alert</div>
                    <div style="font-size:17px;font-weight:800;color:var(--text);">Dining Out — February</div>
                </div>
            </div>
            <div style="display:flex;gap:8px;margin-bottom:16px;">
                <div class="ins-break-stat">
                    <div class="ins-break-stat-label">This month</div>
                    <div class="ins-break-stat-val" style="color:var(--red);">$341</div>
                    <div style="font-size:11px;color:var(--text2);margin-top:2px;">of $400 budget</div>
                </div>
                <div class="ins-break-stat">
                    <div class="ins-break-stat-label">Last month</div>
                    <div class="ins-break-stat-val">$204</div>
                    <div style="font-size:11px;color:var(--text2);margin-top:2px;">67% ↑ increase</div>
                </div>
                <div class="ins-break-stat">
                    <div class="ins-break-stat-label">3mo avg</div>
                    <div class="ins-break-stat-val">$187</div>
                </div>
            </div>
            <div style="background:var(--card);border-radius:12px;padding:12px 14px;margin-bottom:16px;">
                <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--text2);margin-bottom:8px;">
                    <span>Budget used (19 of 28 days)</span>
                    <span style="color:var(--red);font-weight:700;">85%</span>
                </div>
                <div class="progress-track" style="margin-bottom:6px;">
                    <div class="progress-fill fill-red" style="width:85%"></div>
                </div>
                <div style="font-size:11px;color:var(--red);margin-top:6px;">On pace to reach $464 by month end — $64 over budget</div>
            </div>
            <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:8px;">4 orders this month</div>
            <div style="background:var(--card);border-radius:14px;overflow:hidden;margin-bottom:14px;">
                <div class="ins-txn-row">
                    <div style="flex:1;"><div style="font-size:13px;font-weight:600;color:var(--text);">Uber Eats</div><div style="font-size:11px;color:var(--text2);">Wed 19 Feb</div></div>
                    <div style="font-size:13px;font-weight:700;color:var(--red);">−$48.20</div>
                </div>
                <div class="ins-txn-row">
                    <div style="flex:1;"><div style="font-size:13px;font-weight:600;color:var(--text);">Nobu Melbourne</div><div style="font-size:11px;color:var(--text2);">Sat 15 Feb</div></div>
                    <div style="font-size:13px;font-weight:700;color:var(--red);">−$124.00</div>
                </div>
                <div class="ins-txn-row">
                    <div style="flex:1;"><div style="font-size:13px;font-weight:600;color:var(--text);">Uber Eats</div><div style="font-size:11px;color:var(--text2);">Thu 13 Feb</div></div>
                    <div style="font-size:13px;font-weight:700;color:var(--red);">−$36.90</div>
                </div>
                <div class="ins-txn-row" style="border-bottom:none;">
                    <div style="flex:1;"><div style="font-size:13px;font-weight:600;color:var(--text);">Taco Bell</div><div style="font-size:11px;color:var(--text2);">Mon 10 Feb</div></div>
                    <div style="font-size:13px;font-weight:700;color:var(--red);">−$22.70</div>
                </div>
            </div>
            <div style="background:var(--amber-light);border:1px solid rgba(247,200,75,0.2);border-radius:12px;padding:12px 14px;display:flex;gap:10px;align-items:flex-start;margin-bottom:14px;">
                <span style="font-size:16px;">💡</span>
                <div style="font-size:12px;color:var(--text2);line-height:1.6;">Keep dining out under <strong style="color:var(--text);">$59</strong> for the rest of February to stay on budget — roughly one dinner out or two takeaway orders.</div>
            </div>
            <button onclick="closeInsightSheet()" style="width:100%;background:var(--brand);color:#fff;border:none;border-radius:14px;padding:14px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit;">Got it</button>
        </div>
    </div>

    <!-- ════════════ DASHBOARD: UPCOMING ALL SHEET ════════════ -->
    <div class="sheet-backdrop" id="dash-upcoming-backdrop" onclick="closeUpcomingSheet()"></div>
    <div class="bottom-sheet" id="dash-upcoming-sheet" style="max-height:84%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 28px;">
            <div style="font-size:17px;font-weight:800;color:var(--text);margin-bottom:3px;">Upcoming Bills</div>
            <div style="font-size:13px;color:var(--text2);margin-bottom:18px;">Next 30 days · <strong style="color:var(--text);">$1,977</strong> total</div>

            <div style="font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px;">This pay period — due before Feb 22</div>
            <div class="list-card" style="margin-bottom:16px;">
                <div class="list-item">
                    <div class="list-icon" style="background:rgba(229,9,20,0.12)">📺</div>
                    <div class="list-info"><div class="list-name">Netflix</div><div class="list-sub">Tomorrow · Auto-debit</div></div>
                    <div class="list-right"><div class="list-amount">$18.99</div><div class="list-urgency" style="color:var(--amber)">Tomorrow</div></div>
                </div>
                <div class="list-item">
                    <div class="list-icon" style="background:rgba(78,205,196,0.1)">🏠</div>
                    <div class="list-info"><div class="list-name">Rent — REA Group</div><div class="list-sub">Fri 21 Feb · Auto-debit</div></div>
                    <div class="list-right"><div class="list-amount">$1,000</div><div class="list-urgency" style="color:var(--red)">In 2 days</div></div>
                </div>
                <div class="list-item" style="border-bottom:none">
                    <div class="list-icon" style="background:rgba(29,185,84,0.1)">🎵</div>
                    <div class="list-info"><div class="list-name">Spotify</div><div class="list-sub">Sun 22 Feb · Auto-debit</div></div>
                    <div class="list-right"><div class="list-amount">$12.99</div><div class="list-urgency" style="color:var(--text2)">In 2 days</div></div>
                </div>
            </div>

            <div style="font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px;">Next pay period — Feb 22 to Mar 7</div>
            <div class="list-card" style="margin-bottom:16px;">
                <div class="list-item">
                    <div class="list-icon" style="background:rgba(139,126,255,0.12)">💪</div>
                    <div class="list-info"><div class="list-name">F45 Training</div><div class="list-sub">Sat 1 Mar · Auto-debit</div></div>
                    <div class="list-right"><div class="list-amount">$79.00</div><div class="list-urgency" style="color:var(--text2)">Mar 1</div></div>
                </div>
                <div class="list-item">
                    <div class="list-icon" style="background:rgba(78,205,196,0.1)">📱</div>
                    <div class="list-info"><div class="list-name">Telstra · Phone Plan</div><div class="list-sub">Mon 3 Mar · Auto-debit</div></div>
                    <div class="list-right"><div class="list-amount">$55.00</div><div class="list-urgency" style="color:var(--text2)">Mar 3</div></div>
                </div>
                <div class="list-item" style="border-bottom:none">
                    <div class="list-icon" style="background:rgba(229,9,20,0.08)">🎨</div>
                    <div class="list-info"><div class="list-name">Adobe Creative Cloud</div><div class="list-sub">Wed 5 Mar · Auto-debit</div></div>
                    <div class="list-right"><div class="list-amount">$82.99</div><div class="list-urgency" style="color:var(--text2)">Mar 5</div></div>
                </div>
            </div>

            <div style="font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px;">Later in March</div>
            <div class="list-card">
                <div class="list-item">
                    <div class="list-icon" style="background:rgba(247,200,75,0.15)">🚗</div>
                    <div class="list-info"><div class="list-name">Car Registration</div><div class="list-sub">Sat 15 Mar · VicRoads · One-off</div></div>
                    <div class="list-right"><div class="list-amount" style="color:var(--amber)">$680.00</div><div class="list-urgency" style="color:var(--amber)">Large · Mar 15</div></div>
                </div>
                <div class="list-item" style="border-bottom:none">
                    <div class="list-icon" style="background:rgba(139,126,255,0.12)">📦</div>
                    <div class="list-info"><div class="list-name">Afterpay</div><div class="list-sub">Tue 18 Mar · Instalment 2 of 4</div></div>
                    <div class="list-right"><div class="list-amount">$45.00</div><div class="list-urgency" style="color:var(--text2)">Mar 18</div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ════════════ DASHBOARD: SUBSCRIPTION MANAGE ════════════ -->
    <div class="sheet-backdrop" id="dash-sub-backdrop" onclick="closeSubSheet()"></div>
    <div class="bottom-sheet" id="dash-sub-sheet" style="max-height:86%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 28px;">
            <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px;">
                <div style="font-size:17px;font-weight:800;color:var(--text);">Subscriptions</div>
                <div style="font-size:13px;color:var(--text2);">11 active · $287/mo</div>
            </div>
            <div style="font-size:12px;color:var(--text2);margin-bottom:16px;">Toggle off anything you want to cancel</div>
            <div style="background:var(--card);border-radius:16px;padding:6px 16px;margin-bottom:16px;">
                <div class="sub-row">
                    <span class="sub-row-icon">📺</span>
                    <div class="sub-row-info"><div class="sub-row-name">Netflix</div><div class="sub-row-meta">Standard · Monthly · 20th</div></div>
                    <span class="sub-row-amt">$18.99</span>
                    <div class="sub-toggle-track" id="sub-t-1" onclick="toggleSub('sub-t-1')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">🎵</span>
                    <div class="sub-row-info"><div class="sub-row-name">Spotify</div><div class="sub-row-meta">Individual · Monthly · 22nd</div></div>
                    <span class="sub-row-amt">$12.99</span>
                    <div class="sub-toggle-track" id="sub-t-2" onclick="toggleSub('sub-t-2')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">📦</span>
                    <div class="sub-row-info"><div class="sub-row-name">Amazon Prime</div><div class="sub-row-meta">Monthly · 14th</div></div>
                    <span class="sub-row-amt">$9.99</span>
                    <div class="sub-toggle-track" id="sub-t-3" onclick="toggleSub('sub-t-3')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">🎬</span>
                    <div class="sub-row-info"><div class="sub-row-name">Disney+</div><div class="sub-row-meta">Monthly · 8th</div></div>
                    <span class="sub-row-amt">$13.99</span>
                    <div class="sub-toggle-track" id="sub-t-4" onclick="toggleSub('sub-t-4')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">▶️</span>
                    <div class="sub-row-info"><div class="sub-row-name">YouTube Premium</div><div class="sub-row-meta">Monthly · 1st</div></div>
                    <span class="sub-row-amt">$16.99</span>
                    <div class="sub-toggle-track" id="sub-t-5" onclick="toggleSub('sub-t-5')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">🎨</span>
                    <div class="sub-row-info"><div class="sub-row-name">Adobe Creative Cloud</div><div class="sub-row-meta">Monthly · 5th</div></div>
                    <span class="sub-row-amt">$82.99</span>
                    <div class="sub-toggle-track" id="sub-t-6" onclick="toggleSub('sub-t-6')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">☁️</span>
                    <div class="sub-row-info"><div class="sub-row-name">iCloud 200GB</div><div class="sub-row-meta">Monthly · 3rd</div></div>
                    <span class="sub-row-amt">$3.99</span>
                    <div class="sub-toggle-track" id="sub-t-7" onclick="toggleSub('sub-t-7')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">💪</span>
                    <div class="sub-row-info"><div class="sub-row-name">F45 Training</div><div class="sub-row-meta">Monthly · 1st</div></div>
                    <span class="sub-row-amt">$79.00</span>
                    <div class="sub-toggle-track" id="sub-t-8" onclick="toggleSub('sub-t-8')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">🎧</span>
                    <div class="sub-row-info"><div class="sub-row-name">Audible</div><div class="sub-row-meta">Monthly · 12th</div></div>
                    <span class="sub-row-amt">$16.99</span>
                    <div class="sub-toggle-track" id="sub-t-9" onclick="toggleSub('sub-t-9')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row">
                    <span class="sub-row-icon">🍎</span>
                    <div class="sub-row-info"><div class="sub-row-name">Apple TV+</div><div class="sub-row-meta">Monthly · 3rd</div></div>
                    <span class="sub-row-amt">$12.99</span>
                    <div class="sub-toggle-track" id="sub-t-10" onclick="toggleSub('sub-t-10')"><div class="sub-toggle-thumb"></div></div>
                </div>
                <div class="sub-row" style="border-bottom:none">
                    <span class="sub-row-icon">💼</span>
                    <div class="sub-row-info"><div class="sub-row-name">LinkedIn Premium</div><div class="sub-row-meta">Monthly · 17th</div></div>
                    <span class="sub-row-amt">$14.99</span>
                    <div class="sub-toggle-track" id="sub-t-11" onclick="toggleSub('sub-t-11')"><div class="sub-toggle-thumb"></div></div>
                </div>
            </div>
            <div style="background:var(--amber-light);border:1px solid rgba(247,200,75,0.2);border-radius:12px;padding:12px 14px;display:flex;gap:10px;align-items:flex-start;">
                <span style="font-size:16px;">💡</span>
                <div style="font-size:12px;color:var(--text2);line-height:1.6;">You have <strong style="color:var(--text);">2 more</strong> subscriptions than this time last year. That's $3,444 annualised — 6.7% of your income going to subscriptions.</div>
            </div>
        </div>
    </div>

    <!-- ════════════ ACCOUNTS: RULE EDIT SHEET ════════════ -->
    <div class="sheet-backdrop" id="acct-rule-edit-backdrop" onclick="closeRuleEdit()"></div>
    <div class="bottom-sheet" id="acct-rule-edit-sheet" style="max-height:74%;overflow-y:auto;">
        <div class="sheet-handle"></div>
        <div style="padding:0 20px 24px;">
            <div style="font-size:17px;font-weight:800;color:var(--text);margin-bottom:4px;">Edit Rule</div>
            <div id="rule-edit-header" style="font-size:12px;color:var(--text2);margin-bottom:16px;padding:10px 12px;background:var(--card);border-radius:10px;">
                Woolworths → <strong style="color:var(--text);">Groceries</strong>
            </div>
            <div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:10px;">Change category to:</div>
            <div class="acct-cat-grid" id="rule-cat-grid">
                <div class="acct-cat-option" data-cat="Groceries" data-emoji="🛒" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">🛒</span><span class="acct-cat-name">Groceries</span>
                </div>
                <div class="acct-cat-option" data-cat="Dining Out" data-emoji="🍜" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">🍜</span><span class="acct-cat-name">Dining Out</span>
                </div>
                <div class="acct-cat-option" data-cat="Coffee &amp; Drinks" data-emoji="☕" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">☕</span><span class="acct-cat-name">Coffee &amp; Drinks</span>
                </div>
                <div class="acct-cat-option" data-cat="Transport" data-emoji="🚌" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">🚌</span><span class="acct-cat-name">Transport</span>
                </div>
                <div class="acct-cat-option" data-cat="Entertainment" data-emoji="🎬" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">🎬</span><span class="acct-cat-name">Entertainment</span>
                </div>
                <div class="acct-cat-option" data-cat="Health &amp; Wellness" data-emoji="🏥" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">🏥</span><span class="acct-cat-name">Health &amp; Wellness</span>
                </div>
                <div class="acct-cat-option" data-cat="Shopping" data-emoji="🛍️" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">🛍️</span><span class="acct-cat-name">Shopping</span>
                </div>
                <div class="acct-cat-option" data-cat="Utilities" data-emoji="💡" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">💡</span><span class="acct-cat-name">Utilities</span>
                </div>
                <div class="acct-cat-option" data-cat="Subscriptions" data-emoji="📱" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">📱</span><span class="acct-cat-name">Subscriptions</span>
                </div>
                <div class="acct-cat-option" data-cat="Personal Care" data-emoji="💇" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">💇</span><span class="acct-cat-name">Personal Care</span>
                </div>
                <div class="acct-cat-option" data-cat="Other" data-emoji="📦" onclick="pickRuleCat(this)">
                    <span class="acct-cat-icon">📦</span><span class="acct-cat-name">Other</span>
                </div>
            </div>
            <div style="display:flex;gap:10px;margin-top:16px;">
                <button onclick="closeRuleEdit()" style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;font-family:inherit;">Cancel</button>
                <button onclick="saveRuleEdit()" style="flex:1;background:var(--brand);border:none;border-radius:12px;padding:12px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:inherit;">Save Rule</button>
            </div>
        </div>
    </div>

    <!-- ════════════ AI CHAT OVERLAY ════════════ -->
    <div class="chat-overlay" id="chat-overlay">
        <div class="chat-header">
            <div style="flex:1;min-width:0">
                <div class="chat-ai-label">✨ Totem AI</div>
                <div class="chat-title">Ask me anything</div>
                <div class="chat-archetype-chip" id="chat-archetype-chip" onclick="openProfileSheet()">🛡️ Guardian</div>
            </div>
            <button class="chat-close" onclick="closeChat()">✕</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-msg ai">
                <div class="msg-ai-tag">✨ Totem AI</div>
                <div class="msg-bubble">Hey Alex! 👋 I've been looking at your spending this week. Your Dining Out is running a bit hot — $341 of $464 with 8 days left. Want me to help you finish the month on track?</div>
            </div>
            <div class="chat-msg user">
                <div class="msg-bubble">Yes please, what should I do?</div>
            </div>
            <div class="chat-msg ai">
                <div class="msg-ai-tag">✨ Totem AI</div>
                <div class="msg-bubble">You need to keep Dining Out under <strong>$123</strong> for the next 8 days — about $15/day. Cook at home 5 days this week, budget $30–40 for one dinner out. You'll finish around $450, just under your $464 target. 🎯</div>
            </div>
        </div>
        <div class="chat-suggestions">
            <div class="chat-sugg-label">Suggested questions</div>
            <div class="chat-chips">
                <button class="chat-chip" onclick="fillChat(this)">How's my Japan Trip goal?</button>
                <button class="chat-chip" onclick="fillChat(this)">Show my spending trends</button>
                <button class="chat-chip" onclick="fillChat(this)">Set a new budget</button>
            </div>
        </div>
        <div class="chat-input-row">
            <input class="chat-input" id="chat-input" type="text" placeholder="Ask about your money…">
            <button class="chat-send" onclick="sendChat()">↑</button>
        </div>
    </div>

</div><!-- /phone-screen -->
</div><!-- /phone-outer -->

<!-- Arrow controls (only visible on Home screen) -->
<div id="arrow-row" class="arrow-row">
    <div class="arrow-btn" onclick="prev()">←</div>
    <span class="arrow-label" id="arrowLabel">Overview · 1 of 3</span>
    <div class="arrow-btn" onclick="next()">→</div>
</div>

<!-- Plan AI state toggle (only visible on Plan screen) -->
<div id="plan-controls" style="display:none; gap:10px;">
    <button id="plan-btn-milestone" onclick="setPlanState('milestone')" style="background:var(--card);border:1px solid var(--brand);border-radius:20px;padding:7px 16px;font-size:12px;font-weight:600;color:var(--brand);cursor:pointer;font-family:inherit;">🔒 AI Locked (22/30)</button>
    <button id="plan-btn-ai" onclick="setPlanState('ai')" style="background:var(--card);border:1px solid var(--border);border-radius:20px;padding:7px 16px;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;font-family:inherit;">✨ AI Active</button>
</div>

</div><!-- /phone-col -->
</div><!-- /page-wrapper -->

<script>
/* ════════════════════════════════════════════════
   SCREEN NAVIGATION
════════════════════════════════════════════════ */
const screens = ['home', 'plan', 'calendar', 'accounts', 'insights'];
let currentScreen = 'home';

function navigate(id) {
    if (id === currentScreen) return;

    // Exit current
    const old = document.getElementById('screen-' + currentScreen);
    old.classList.remove('active');
    old.classList.add('exit-left');
    setTimeout(() => old.classList.remove('exit-left'), 300);

    // Enter new
    currentScreen = id;
    const nw = document.getElementById('screen-' + id);
    nw.classList.add('active');

    // Update bottom nav
    screens.forEach(s => {
        document.getElementById('nav-' + s).classList.toggle('active', s === id);
        const sb = document.getElementById('sb-' + s);
        if (sb) sb.classList.toggle('active', s === id);
    });

    // Show/hide screen-specific controls
    document.getElementById('arrow-row').style.display     = (id === 'home')  ? 'flex' : 'none';
    document.getElementById('plan-controls').style.display = (id === 'plan')  ? 'flex' : 'none';

    // Close any open calendar sheet when navigating away
    if (id !== 'calendar') closeCalSheet();

    // Close Plan sheets when navigating away
    if (id !== 'plan') {
        closeGoalDetail && closeGoalDetail();
        closeGoalAlloc && closeGoalAlloc();
        closeBudgetDetail && closeBudgetDetail();
        closeAddBudget && closeAddBudget();
        closeSheet && closeSheet();
    }

    // Close accounts sheets when navigating away; reset header when entering
    if (id !== 'accounts') { closeAcctSheet(); closeCatSheet(); }
    if (id === 'accounts') {
        const activeAcctTab = document.querySelector('#screen-accounts .subtab.active');
        const tabName = activeAcctTab ? activeAcctTab.id.replace('acct-tab-', '') : 'accounts';
        updateAcctHeader(tabName);
    }

    // Update sidebar notes
    document.querySelectorAll('.note-set').forEach(n => n.classList.remove('active'));
    const noteEl = document.getElementById('notes-' + id);
    if (noteEl) noteEl.classList.add('active');

    // Update header action (Plan screen toggles based on active tab)
    if (id === 'plan') {
        const activeTab = document.querySelector('#screen-plan .subtab.active');
        updatePlanHeader(activeTab ? activeTab.id : 'plan-tab-goals');
    }
}

/* ════════════════════════════════════════════════
   DASHBOARD TIER SYSTEM
════════════════════════════════════════════════ */
let cur = 0;
const tLabels = ['Overview · 1 of 3', 'Financial Health · 2 of 3', 'Trends & Patterns · 3 of 3'];
const tBadges = ['Tier 1 · Overview', 'Tier 2 · Financial Health', 'Tier 3 · Trends'];

function goTo(i) {
    cur = i;
    document.getElementById('slider').style.transform = `translateX(-${cur * 33.333}%)`;
    [0,1,2].forEach(n => {
        document.getElementById('d'+n).classList.toggle('active', n === cur);
    });
    document.getElementById('arrowLabel').textContent = tLabels[cur];
    document.getElementById('tierBadge').textContent  = tBadges[cur];
}
function next() { if (cur < 2) goTo(cur + 1); }
function prev() { if (cur > 0) goTo(cur - 1); }

// Swipe on phone for Dashboard tiers
let tx = 0;
document.querySelector('.phone-screen').addEventListener('touchstart', e => { tx = e.touches[0].clientX; });
document.querySelector('.phone-screen').addEventListener('touchend', e => {
    if (currentScreen !== 'home') return;
    const d = tx - e.changedTouches[0].clientX;
    if (Math.abs(d) > 40) { d > 0 ? next() : prev(); }
});
document.addEventListener('keydown', e => {
    if (currentScreen !== 'home') return;
    if (e.key === 'ArrowRight') next();
    if (e.key === 'ArrowLeft')  prev();
});

/* ════════════════════════════════════════════════
   PLAN SCREEN — TABS
════════════════════════════════════════════════ */
function switchPlanTab(tab) {
    document.querySelectorAll('#screen-plan .subtab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('#screen-plan .tab-pane').forEach(p => p.classList.remove('active'));
    document.getElementById('plan-tab-' + tab).classList.add('active');
    document.getElementById('plan-pane-' + tab).classList.add('active');
    updatePlanHeader('plan-tab-' + tab);
}
function updatePlanHeader(tabId) {
    const action = document.querySelector('#screen-plan .header-action');
    if (tabId === 'plan-tab-goals')   { action.textContent = '+ Add Goal';   action.onclick = openSheet; }
    if (tabId === 'plan-tab-budgets') { action.textContent = '+ Add Budget'; action.onclick = openAddBudget; }
}

/* ════════════════════════════════════════════════
   PLAN SCREEN — AI STATE TOGGLE
════════════════════════════════════════════════ */
function setPlanState(state) {
    const ms  = document.getElementById('plan-milestone');
    const ai  = document.getElementById('plan-ai-suggestion');
    const bms = document.getElementById('plan-btn-milestone');
    const bai = document.getElementById('plan-btn-ai');

    if (state === 'milestone') {
        ms.style.display  = 'block';
        ai.classList.remove('visible');
        bms.style.borderColor = 'var(--brand)';     bms.style.color = 'var(--brand)';
        bai.style.borderColor = 'var(--border)';    bai.style.color = 'var(--text2)';
    } else {
        ms.style.display  = 'none';
        ai.classList.add('visible');
        bms.style.borderColor = 'var(--border)';    bms.style.color = 'var(--text2)';
        bai.style.borderColor = 'var(--brand)';     bai.style.color = 'var(--brand)';
    }
    // Switch to Goals tab
    switchPlanTab('goals');
}

/* ════════════════════════════════════════════════
   COMPLETED SECTION TOGGLE
════════════════════════════════════════════════ */
function toggleCompleted() {
    const goals   = document.getElementById('completed-goals');
    const chevron = document.getElementById('completed-chevron');
    const open = goals.classList.toggle('visible');
    chevron.classList.toggle('open', open);
}

/* ════════════════════════════════════════════════
   BOTTOM SHEET (Add Goal)
════════════════════════════════════════════════ */
function openSheet() {
    document.getElementById('sheet-backdrop').classList.add('visible');
    document.getElementById('add-goal-sheet').classList.add('open');
}
function closeSheet() {
    document.getElementById('sheet-backdrop').classList.remove('visible');
    document.getElementById('add-goal-sheet').classList.remove('open');
}

/* ════════════════════════════════════════════════
   AI CHAT OVERLAY
════════════════════════════════════════════════ */
function openChat() {
    document.getElementById('chat-overlay').classList.add('open');
}
function closeChat() {
    document.getElementById('chat-overlay').classList.remove('open');
}
function fillChat(el) {
    document.getElementById('chat-input').value = el.textContent;
    document.getElementById('chat-input').focus();
}

/* ── Archetype system state ── */
let chatFirstMsg  = true;   // flips false after user's first message
let quizState     = 'idle'; // idle | offered | running | done | skipped
let quizScores    = { avoidance: 0, worship: 0, status: 0, vigilance: 0 };
let userArchetype = null;

const archetypes = {
    avoidance: {
        name: 'The Detacher', label: 'Money Avoidance', icon: '🌊', color: 'var(--amber)',
        desc: "You tend to see money as stressful or emotionally complicated — sometimes avoiding financial decisions altogether. That's more common than you think, and I'll keep things calm, judgment-free, and focused on small wins.",
        aiNote: "I'll frame your finances as self-care, not pressure. No scary numbers without context."
    },
    worship: {
        name: 'The Chaser', label: 'Money Worship', icon: '🚀', color: 'var(--brand)',
        desc: "You tend to believe more money equals more happiness — which drives real ambition but can make 'enough' feel elusive. I'll help you build toward the life you actually want, not just a bigger number.",
        aiNote: "I'll celebrate your milestones and help you define what 'enough' looks like for you specifically."
    },
    status: {
        name: 'The Achiever', label: 'Money Status', icon: '🏆', color: 'var(--teal)',
        desc: "You're motivated by financial achievement and aware of where you stand relative to your goals. I'll keep your benchmarks personal and focus on real progress — not comparisons that don't serve you.",
        aiNote: "I'll track your personal milestones and keep the focus firmly on your own trajectory."
    },
    vigilance: {
        name: 'The Guardian', label: 'Money Vigilance', icon: '🛡️', color: 'var(--green)',
        desc: "You're cautious, savings-focused, and take money seriously — which is genuinely a strength. I'll give you data-rich insights and help you spend confidently on what actually matters to you.",
        aiNote: "I'll always show the numbers behind my recommendations. No vague advice."
    }
};

const quizQs = [
    {
        q: "Question 1 of 6 — When you check your bank balance, you usually feel…",
        opts: [
            { t: "🙈  Anxious — I avoid looking if I can",            a: 'avoidance' },
            { t: "📈  Motivated — I want to grow it",                 a: 'worship'   },
            { t: "🎯  Focused — tracking it against my goals",        a: 'status'    },
            { t: "🔍  Watchful — I check often but still worry",      a: 'vigilance' }
        ]
    },
    {
        q: "Question 2 of 6 — When you spend on something just for yourself, you feel…",
        opts: [
            { t: "😔  Guilty — like I shouldn't have",                a: 'avoidance' },
            { t: "🎉  Good — I work hard, I deserve it",              a: 'worship'   },
            { t: "👀  Conscious — does this fit the image I want?",   a: 'status'    },
            { t: "🤔  Cautious — I need to justify it to myself first", a: 'vigilance' }
        ]
    },
    {
        q: "Question 3 of 6 — If your income doubled tomorrow, you'd…",
        opts: [
            { t: "😅  Feel overwhelmed by managing more money",       a: 'avoidance' },
            { t: "😊  Finally feel the security I've been chasing",   a: 'worship'   },
            { t: "🚀  Upgrade your lifestyle to match",               a: 'status'    },
            { t: "🔒  Save most of it quietly and tell few people",   a: 'vigilance' }
        ]
    },
    {
        q: "Question 4 of 6 — When friends talk about salaries or money…",
        opts: [
            { t: "😶  I change the subject — money talk makes me uneasy", a: 'avoidance' },
            { t: "💡  I get curious about what's possible",               a: 'worship'   },
            { t: "👀  I pay close attention to where I stand",            a: 'status'    },
            { t: "🤐  I go quiet — my finances feel private",             a: 'vigilance' }
        ]
    },
    {
        q: "Question 5 of 6 — Your biggest financial fear is…",
        opts: [
            { t: "🌀  Becoming consumed by or obsessed with money",       a: 'avoidance' },
            { t: "😟  Never feeling like I have enough, no matter what",  a: 'worship'   },
            { t: "😰  Visibly falling behind others financially",          a: 'status'    },
            { t: "😱  A surprise expense wiping out my savings",           a: 'vigilance' }
        ]
    },
    {
        q: "Last one — Question 6 of 6. Your ideal financial outcome is…",
        opts: [
            { t: "😌  Not having to think or stress about money anymore",  a: 'avoidance' },
            { t: "🌟  Building the lifestyle and experiences I really want", a: 'worship'  },
            { t: "🏆  Being genuinely ahead of where I expected to be",    a: 'status'    },
            { t: "☁️  A solid safety net so I'm always protected",         a: 'vigilance' }
        ]
    }
];

function _addAiMsg(html, delay) {
    setTimeout(() => {
        const msgs = document.getElementById('chat-messages');
        const am = document.createElement('div');
        am.className = 'chat-msg ai';
        am.innerHTML = `<div class="msg-ai-tag">✨ Totem AI</div><div class="msg-bubble">${html}</div>`;
        msgs.appendChild(am);
        msgs.scrollTop = msgs.scrollHeight;
    }, delay || 0);
}

function _addUserMsg(text) {
    const msgs = document.getElementById('chat-messages');
    const um = document.createElement('div');
    um.className = 'chat-msg user';
    um.innerHTML = `<div class="msg-bubble">${text}</div>`;
    msgs.appendChild(um);
    msgs.scrollTop = msgs.scrollHeight;
}

function sendChat() {
    const input = document.getElementById('chat-input');
    const val = input.value.trim();
    if (!val) return;
    if (quizState === 'running') return; // lock input during quiz
    _addUserMsg(val);
    input.value = '';

    if (chatFirstMsg && quizState === 'idle') {
        chatFirstMsg = false;
        _addAiMsg('Let me check that for you… 🔍', 600);
        setTimeout(() => {
            quizState = 'offered';
            _offerQuiz();
        }, 1900);
    } else {
        _addAiMsg('Let me check that for you… 🔍', 700);
    }
}

function _offerQuiz() {
    const msgs = document.getElementById('chat-messages');
    const am = document.createElement('div');
    am.className = 'chat-msg ai';
    am.innerHTML = `
        <div class="msg-ai-tag">✨ Totem AI</div>
        <div class="msg-bubble">Before I go deeper — I'd love to understand how you think about money. It shapes everything I tell you, and it only takes about 60 seconds. Up for it?</div>
        <div class="quiz-chips" id="quiz-offer-chips">
            <button class="quiz-chip" style="font-weight:700" onclick="beginQuiz()">✨ &nbsp;Sure, let's do it</button>
            <button class="quiz-chip" onclick="skipQuiz()">Maybe later</button>
        </div>`;
    msgs.appendChild(am);
    msgs.scrollTop = msgs.scrollHeight;
}

function beginQuiz() {
    document.getElementById('quiz-offer-chips').querySelectorAll('.quiz-chip').forEach(c => { c.disabled = true; c.style.opacity = '0.45'; });
    _addUserMsg('✨  Sure, let\'s do it');
    quizState = 'running';
    quizScores = { avoidance: 0, worship: 0, status: 0, vigilance: 0 };
    document.querySelector('.chat-suggestions').style.display = 'none';
    setTimeout(() => _showQuizQ(0), 700);
}

function skipQuiz() {
    document.getElementById('quiz-offer-chips').querySelectorAll('.quiz-chip').forEach(c => { c.disabled = true; c.style.opacity = '0.45'; });
    _addUserMsg('Maybe later');
    quizState = 'skipped';
    _addAiMsg('No problem — I\'ll ask another time. What else can I help with? 😊', 500);
}

function _showQuizQ(idx) {
    const q = quizQs[idx];
    const msgs = document.getElementById('chat-messages');
    const am = document.createElement('div');
    am.className = 'chat-msg ai';
    const chipsHtml = q.opts.map(o =>
        `<button class="quiz-chip" onclick="answerQ(this,'${o.a}',${idx})">${o.t}</button>`
    ).join('');
    am.innerHTML = `<div class="msg-ai-tag">✨ Totem AI</div><div class="msg-bubble">${q.q}</div><div class="quiz-chips">${chipsHtml}</div>`;
    msgs.appendChild(am);
    msgs.scrollTop = msgs.scrollHeight;
}

function answerQ(btn, arch, idx) {
    // Lock all chips in this question block
    btn.closest('.quiz-chips').querySelectorAll('.quiz-chip').forEach(c => {
        c.disabled = true; c.style.opacity = '0.4';
    });
    // Highlight the chosen answer
    btn.style.opacity = '1';
    btn.style.borderColor = archetypes[arch].color;
    btn.style.color = archetypes[arch].color;
    // Record score
    quizScores[arch]++;
    _addUserMsg(btn.textContent.trim());

    const acks = ['Got it. 👍', 'Makes sense.', 'Interesting — noted. 📝', 'Good to know.', 'Almost there —'];
    if (idx < quizQs.length - 1) {
        _addAiMsg(acks[idx], 450);
        setTimeout(() => _showQuizQ(idx + 1), 1100);
    } else {
        setTimeout(() => _showResult(), 750);
    }
}

function _calcArchetype() {
    // Tiebreak priority: vigilance > status > worship > avoidance (most → least common)
    const priority = ['vigilance', 'status', 'worship', 'avoidance'];
    return priority.reduce((best, a) => quizScores[a] > quizScores[best] ? a : best, priority[0]);
}

function _showResult() {
    userArchetype = _calcArchetype();
    const a = archetypes[userArchetype];
    const msgs = document.getElementById('chat-messages');
    const am = document.createElement('div');
    am.className = 'chat-msg ai';
    am.innerHTML = `
        <div class="msg-ai-tag">✨ Totem AI</div>
        <div class="msg-bubble">Based on your answers, here's your money personality:</div>
        <div class="archetype-card" style="border-left-color:${a.color}">
            <div class="archetype-card-top">
                <div class="archetype-card-icon">${a.icon}</div>
                <div>
                    <div class="archetype-card-name" style="color:${a.color}">${a.name}</div>
                    <div class="archetype-card-type" style="color:${a.color}">${a.label}</div>
                </div>
            </div>
            <div class="archetype-card-desc">${a.desc}</div>
            <div class="archetype-card-note">💬 ${a.aiNote}</div>
        </div>`;
    msgs.appendChild(am);
    msgs.scrollTop = msgs.scrollHeight;

    // Update header chip
    const chip = document.getElementById('chat-archetype-chip');
    chip.textContent = a.icon + ' ' + a.name;
    chip.classList.add('visible');
    // Pre-populate profile sheet so it's ready
    _populateArchetypeProfile();

    // Follow-up + restore suggestions
    setTimeout(() => {
        _addAiMsg("Now I know how to talk to you about money. What would you like to explore? 👇", 0);
        document.querySelector('.chat-suggestions').style.display = '';
        quizState = 'done';
        msgs.scrollTop = msgs.scrollHeight;
    }, 800);
}

function retakeQuiz() {
    closeProfileSheet();
    userArchetype = null; chatFirstMsg = true; quizState = 'idle';
    quizScores = { avoidance: 0, worship: 0, status: 0, vigilance: 0 };
    document.getElementById('chat-archetype-chip').classList.remove('visible');
    document.getElementById('profile-arch-banner').style.display = 'none';
    document.getElementById('profile-arch-empty').style.display  = '';
    setTimeout(() => {
        openChat();
        _addAiMsg("Let's go again — fresh start. 🔄", 500);
        setTimeout(() => { quizState = 'running'; _showQuizQ(0); }, 1400);
    }, 300);
}

function _populateArchetypeProfile() {
    if (!userArchetype) return;
    const a = archetypes[userArchetype];
    document.getElementById('profile-arch-empty').style.display  = 'none';
    document.getElementById('profile-arch-banner').style.display = '';
    document.getElementById('profile-arch-banner').style.borderLeftColor = a.color;
    document.getElementById('profile-arch-icon').textContent  = a.icon;
    document.getElementById('profile-arch-name').textContent  = a.name;
    document.getElementById('profile-arch-name').style.color  = a.color;
    document.getElementById('profile-arch-label').textContent = a.label;
    document.getElementById('profile-arch-label').style.color = a.color;
    document.getElementById('profile-arch-desc').textContent  = a.desc;
    document.getElementById('profile-arch-note').textContent  = '💬 ' + a.aiNote;
}

document.getElementById('chat-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') sendChat();
});

/* ════════════════════════════════════════════════
   THEME SWITCHER
════════════════════════════════════════════════ */
function setTheme(theme) {
    const html = document.documentElement;
    html.className = theme === 'midnight' ? '' : 't-' + theme;
    document.body.style.background = 'var(--body-bg)';
    ['midnight','oled','light'].forEach(t => {
        document.getElementById('t-' + t).classList.toggle('active', t === theme);
    });
}

/* ════════════════════════════════════════════════
   CALENDAR — DAY DATA
════════════════════════════════════════════════ */
const calFebData = {
    1:  { txns: [{icon:'🛒',name:'Coles',cat:'Groceries',time:'10:22 AM',amt:'$32.00'},{icon:'🚌',name:'Opal Card',cat:'Transport',time:'8:05 AM',amt:'$13.00'}], total:'$45' },
    2:  { txns: [{icon:'🍔',name:'Mad Mex',cat:'Eating Out',time:'1:02 PM',amt:'$28.00'}], total:'$28' },
    3:  { txns: [], total: null, empty: true },
    4:  { txns: [{icon:'🍔',name:"Nando's",cat:'Eating Out',time:'7:30 PM',amt:'$64.00'},{icon:'🛒',name:'Woolworths',cat:'Groceries',time:'5:15 PM',amt:'$23.00'}], total:'$87' },
    5:  { txns: [{icon:'🚌',name:'Opal Card',cat:'Transport',time:'8:12 AM',amt:'$18.00'}], total:'$18' },
    6:  { txns: [{icon:'🎭',name:'Hoyts Cinema',cat:'Entertainment',time:'7:00 PM',amt:'$56.00'},{icon:'🍔',name:'Guzman y Gomez',cat:'Eating Out',time:'6:30 PM',amt:'$18.00'}], total:'$74' },
    7:  { txns: [{icon:'🛒',name:'Aldi',cat:'Groceries',time:'10:45 AM',amt:'$78.00'},{icon:'🍔',name:'Fratelli Fresh',cat:'Eating Out',time:'1:30 PM',amt:'$78.00'}], total:'$156' },
    8:  { txns: [{icon:'💰',name:'ANZ Payroll',cat:'Income',time:'12:00 AM',amt:'$3,200.00',income:true},{icon:'🛒',name:'Coles',cat:'Groceries',time:'4:30 PM',amt:'$34.00'}], payday:true, total:null },
    9:  { txns: [{icon:'🛒',name:'Harris Farm Markets',cat:'Groceries',time:'6:00 PM',amt:'$28.00'}], total:'$28' },
    10: { txns: [{icon:'🍔',name:'Uber Eats',cat:'Eating Out',time:'12:45 PM',amt:'$52.00'}], total:'$52' },
    11: { txns: [{icon:'🛒',name:'Woolworths',cat:'Groceries',time:'5:30 PM',amt:'$23.00'},{icon:'🚌',name:'Opal Card',cat:'Transport',time:'8:00 AM',amt:'$12.00'}], total:'$35' },
    12: { txns: [{icon:'🍔',name:'The Grounds of Alexandria',cat:'Eating Out',time:'12:00 PM',amt:'$98.00'}], total:'$98' },
    13: { txns: [{icon:'🍔',name:'Bar Luca',cat:'Eating Out',time:'7:00 PM',amt:'$54.00'},{icon:'📱',name:'Spotify',cat:'Subscriptions',time:'9:00 AM',amt:'$12.99'}], total:'$67' },
    14: { txns: [{icon:'🍔',name:'Nour Restaurant',cat:'Eating Out',time:'7:30 PM',amt:'$120.00'},{icon:'🎭',name:'Event Cinemas',cat:'Entertainment',time:'6:00 PM',amt:'$60.00'}], total:'$180', note:'💌 Valentine\'s Day' },
    15: { txns: [{icon:'🛒',name:'Coles',cat:'Groceries',time:'11:00 AM',amt:'$56.00'}], total:'$56' },
    16: { txns: [{icon:'☕',name:"Pablo & Rusty's",cat:'Eating Out',time:'8:30 AM',amt:'$12.00'}], total:'$12' },
    17: { txns: [{icon:'🍔',name:"Grill'd Burgers",cat:'Eating Out',time:'12:30 PM',amt:'$44.00'}], total:'$44' },
    18: { txns: [{icon:'🍔',name:'Rockpool Bar & Grill',cat:'Eating Out',time:'7:00 PM',amt:'$89.00'}], total:'$89' },
    19: { txns: [{icon:'🍔',name:'Uber Eats',cat:'Eating Out',time:'12:30 PM',amt:'$37.00'},{icon:'🚌',name:'Opal Card',cat:'Transport',time:'8:00 AM',amt:'$17.00'}], total:'$54', today:true },
    20: { bills:[{icon:'📺',name:'Netflix',amt:'$18.99'}], future:true },
    21: { bills:[{icon:'🏠',name:'Rent — REA Group',amt:'$1,000.00'}], future:true },
    22: { bills:[{icon:'🎵',name:'Spotify',amt:'$12.99'}], future:true, payday:true },
    23: { future:true }, 24: { future:true }, 25: { future:true },
    26: { future:true }, 27: { future:true }, 28: { future:true },
};

const _febDayOfWeek = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

/* ════════════════════════════════════════════════
   CALENDAR — DAY SELECTION
════════════════════════════════════════════════ */
function calSelectDay(day, month) {
    month = month || (currentCalMonth === 'jan' ? 'jan' : 'feb');
    document.querySelectorAll('.cal-day').forEach(d => d.classList.remove('selected'));
    const cell = document.getElementById('cal-day-' + day);
    if (cell) cell.classList.add('selected');

    // January cells — simplified message
    if (month === 'jan') {
        const dow = _febDayOfWeek[new Date(2026, 0, day).getDay()];
        document.getElementById('cal-sheet-content').innerHTML =
            `<div class="cal-sheet-date-hd">${dow}, ${day} January 2026</div>
             <div style="text-align:center;padding:28px 0;color:var(--text2);font-size:13px;line-height:1.7">
                 Full transaction history for January<br>is available in the production app.
             </div>
             <div style="text-align:center">
                 <span style="font-size:12px;font-weight:600;color:var(--brand);cursor:pointer" onclick="closeCalSheet();calJumpToday()">Back to February →</span>
             </div>`;
        document.getElementById('cal-backdrop').classList.add('visible');
        document.getElementById('cal-day-sheet').classList.add('open');
        return;
    }

    const data = calFebData[day];
    if (!data) return;
    const dow = _febDayOfWeek[new Date(2026, 1, day).getDay()];
    const todayLabel = data.today ? ' · Today' : '';
    let html = `<div class="cal-sheet-date-hd">${dow}, ${day} February 2026${todayLabel}</div>`;

    // Total / summary row
    if (data.payday && !data.future) {
        html += `<div class="cal-sheet-total-row">
            <span class="cal-sheet-total-lbl">Net (income day)</span>
            <span class="cal-sheet-total-amt income">+$3,166</span>
        </div>`;
    } else if (data.future && data.payday) {
        html += `<div class="cal-sheet-total-row">
            <span class="cal-sheet-total-lbl">Payday · Expected</span>
            <span class="cal-sheet-total-amt income">~+$3,200</span>
        </div>`;
    } else if (data.total) {
        html += `<div class="cal-sheet-total-row">
            <span class="cal-sheet-total-lbl">${data.today ? 'Spent so far today' : 'Total spent'}</span>
            <span class="cal-sheet-total-amt">−${data.total}</span>
        </div>`;
    }

    // Special day note
    if (data.note) {
        html += `<div style="font-size:12px;color:var(--text2);margin-bottom:10px;padding:7px 10px;background:rgba(255,107,107,0.08);border-radius:8px">${data.note}</div>`;
    }

    // Transactions
    if (data.txns && data.txns.length > 0) {
        html += `<div>`;
        for (const t of data.txns) {
            const amtStyle = t.income ? 'color:var(--brand)' : 'color:var(--text)';
            const prefix   = t.income ? '+' : '−';
            const iconBg   = t.income ? 'var(--brand-light)' : 'rgba(255,255,255,0.06)';
            html += `<div class="list-item" style="padding:10px 0">
                <div class="list-icon" style="background:${iconBg}">${t.icon}</div>
                <div class="list-info">
                    <div class="list-name">${t.name}</div>
                    <div class="list-sub">${t.cat} · ${t.time}</div>
                </div>
                <div class="list-right">
                    <div class="list-amount" style="${amtStyle}">${prefix}${t.amt}</div>
                </div>
            </div>`;
        }
        html += `</div>`;
    }

    // Upcoming bills (future days)
    if (data.bills && data.bills.length > 0) {
        html += `<div class="cal-upcoming-hd">Upcoming Bills</div>`;
        for (const b of data.bills) {
            html += `<div class="list-item" style="padding:10px 0">
                <div class="list-icon" style="background:var(--amber-light)">${b.icon}</div>
                <div class="list-info">
                    <div class="list-name">${b.name}</div>
                    <div class="list-sub">Auto-debit · Upcoming</div>
                </div>
                <div class="list-right">
                    <div class="list-amount" style="color:var(--amber)">−${b.amt}</div>
                </div>
            </div>`;
        }
    }

    // Empty state
    if (data.empty || ((!data.txns || data.txns.length === 0) && (!data.bills || data.bills.length === 0) && !data.payday)) {
        html += `<div style="text-align:center;padding:24px 0;color:var(--text2);font-size:13px">No transactions on this day.</div>`;
    }

    // Footer
    html += `<div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border);text-align:center">
        <span style="font-size:12px;font-weight:600;color:var(--brand);cursor:pointer" onclick="navigate('accounts')">View all in Accounts →</span>
    </div>`;

    document.getElementById('cal-sheet-content').innerHTML = html;
    document.getElementById('cal-backdrop').classList.add('visible');
    document.getElementById('cal-day-sheet').classList.add('open');
}

function closeCalSheet() {
    document.getElementById('cal-backdrop').classList.remove('visible');
    document.getElementById('cal-day-sheet').classList.remove('open');
    document.querySelectorAll('.cal-day').forEach(d => d.classList.remove('selected'));
}

/* ════════════════════════════════════════════════
   CALENDAR — VIEW SWITCHER (Month / Week / Day)
════════════════════════════════════════════════ */
let currentCalView = 'month';
let calWeekIndex   = 3;    // current week (Feb 15–21)
let calDayViewDay  = 19;   // default = today

function calSetView(view) {
    const prevView    = currentCalView;
    currentCalView    = view;
    const isMonth = view === 'month';
    const isWeek  = view === 'week';
    const isDay   = view === 'day';

    // Buttons
    ['month','week','day'].forEach(v =>
        document.getElementById('cal-btn-' + v).classList.toggle('active', v === view)
    );

    // Sections visibility
    const wd  = document.getElementById('cal-weekdays');
    const leg = document.getElementById('cal-legend');
    wd.style.display  = (isDay || isWeek) ? 'none' : '';
    leg.style.display = isDay ? 'none'  : '';

    document.getElementById('cal-grid').style.display      = isMonth ? '' : 'none';
    document.getElementById('cal-week-grid').classList.toggle('vis', isWeek);
    document.getElementById('cal-day-view').classList.toggle('vis', isDay);

    // Each view drives the shared top nav bar
    // Week and Day views only have February data — reset month to avoid Jan placeholder
    if (isMonth) restoreMonthNav();
    if (isWeek)  { currentCalMonth = 'feb'; renderCalWeek(calWeekIndex); }
    if (isDay)   { currentCalMonth = 'feb'; renderCalDayView(calDayViewDay); }

    closeCalSheet();
}

function renderCalDayView(day) {
    calDayViewDay = Math.max(1, Math.min(28, day));
    const data = calFebData[calDayViewDay] || {};
    const dow  = _febDayOfWeek[new Date(2026, 1, calDayViewDay).getDay()];
    const isToday  = calDayViewDay === 19;
    const isFuture = !!data.future;
    const txns  = data.txns  || [];
    const bills = data.bills || [];

    document.getElementById('cal-month-title').textContent    = `${dow}, ${calDayViewDay} Feb`;
    document.getElementById('cal-prev-btn').disabled          = calDayViewDay <= 1;
    document.getElementById('cal-next-btn').disabled          = calDayViewDay >= 28;
    document.getElementById('cal-today-btn').style.display    = isToday ? 'none' : 'inline';

    // Stat card
    let statLeft, statLeftVal, statRight, statRightVal, statRightColor = 'var(--text)';
    if (data.payday && !isFuture) {
        statLeft = 'Net Day'; statLeftVal = '+$3,166'; statRight = 'Transactions'; statRightVal = txns.length;
    } else if (isFuture && data.payday) {
        statLeft = 'Payday'; statLeftVal = '~$3,200'; statLeftVal = '~$3,200'; statRight = 'Bills Due'; statRightVal = bills.length; statRightColor = 'var(--amber)';
    } else if (isFuture) {
        statLeft = 'Bills Due'; statLeftVal = bills.length || '—'; statRight = 'Transactions'; statRightVal = '—'; statRightColor = bills.length ? 'var(--amber)' : 'var(--text3)';
    } else {
        statLeft = 'Spent'; statLeftVal = data.total ? '−' + data.total : '$0'; statRight = 'Transactions'; statRightVal = txns.length;
    }

    let html = `<div class="cal-day-stat-card">
        <div class="cal-day-stat"><div class="cal-day-stat-lbl">${statLeft}</div><div class="cal-day-stat-val" style="color:${data.payday && !isFuture ? 'var(--brand)' : 'var(--text)'}">${statLeftVal}</div></div>
        <div style="width:1px;background:var(--border)"></div>
        <div class="cal-day-stat"><div class="cal-day-stat-lbl">${statRight}</div><div class="cal-day-stat-val" style="color:${statRightColor}">${statRightVal}</div></div>
    </div>`;

    // Transactions
    if (txns.length > 0) {
        html += `<div class="section-hd"><div class="section-title">Transactions</div></div><div class="list-card">`;
        for (const t of txns) {
            const color  = t.income ? 'color:var(--brand)' : 'color:var(--text)';
            const prefix = t.income ? '+' : '−';
            const iconBg = t.income ? 'var(--brand-light)' : 'rgba(255,255,255,0.06)';
            html += `<div class="list-item">
                <div class="list-icon" style="background:${iconBg}">${t.icon}</div>
                <div class="list-info"><div class="list-name">${t.name}</div><div class="list-sub">${t.cat} · ${t.time}</div></div>
                <div class="list-right"><div class="list-amount" style="${color}">${prefix}${t.amt}</div></div>
            </div>`;
        }
        html += `</div>`;
    }

    // Bills
    if (bills.length > 0) {
        html += `<div class="section-hd"><div class="section-title">Upcoming Bills</div></div><div class="list-card">`;
        for (const b of bills) {
            html += `<div class="list-item">
                <div class="list-icon" style="background:var(--amber-light)">${b.icon}</div>
                <div class="list-info"><div class="list-name">${b.name}</div><div class="list-sub">Auto-debit · Upcoming</div></div>
                <div class="list-right"><div class="list-amount" style="color:var(--amber)">−${b.amt}</div></div>
            </div>`;
        }
        html += `</div>`;
    }

    // Empty state
    if (!txns.length && !bills.length && !data.payday) {
        html += `<div style="text-align:center;padding:40px 0;color:var(--text2);font-size:13px;line-height:1.7">No transactions on this day.</div>`;
    }

    // Valentine's note
    if (data.note) {
        html = html.replace('</div><div class="list-card">', `</div><div style="font-size:12px;color:var(--text2);margin-bottom:8px;padding:7px 10px;background:rgba(255,107,107,0.08);border-radius:8px">${data.note}</div><div class="list-card">`);
    }

    document.getElementById('cal-day-content').innerHTML = html;
}

function calDayNav(dir) {
    renderCalDayView(calDayViewDay + dir);
}

/* ════════════════════════════════════════════════
   CALENDAR — MONTH / WEEK NAVIGATION
════════════════════════════════════════════════ */
let currentCalMonth = 'feb';

function calChangeMonth(dir) {
    // Delegate to the active view's navigation
    if (currentCalView === 'week') { calNavWeek(dir); return; }
    if (currentCalView === 'day')  { renderCalDayView(calDayViewDay + dir); return; }

    if (dir === -1 && currentCalMonth === 'feb') {
        currentCalMonth = 'jan';
        document.getElementById('cal-month-title').textContent = 'January 2026';
        document.getElementById('cal-sum-spent').textContent   = '$1,073';
        document.getElementById('cal-sum-vs').textContent      = '+3%';
        document.getElementById('cal-sum-vs').style.color      = 'var(--red)';
        document.getElementById('cal-sum-vs-label').textContent = 'vs Last Mo.';
        document.getElementById('cal-sum-days').textContent    = '31 days';
        document.getElementById('cal-sum-days-label').textContent = 'Total';
        document.getElementById('cal-today-btn').style.display  = 'inline';
        document.getElementById('cal-prev-btn').disabled        = true;
        document.getElementById('cal-next-btn').disabled        = false;
        renderJanGrid();
    } else if (dir === 1 && currentCalMonth === 'jan') {
        currentCalMonth = 'feb';
        document.getElementById('cal-month-title').textContent = 'February 2026';
        document.getElementById('cal-sum-spent').textContent   = '$1,157';
        document.getElementById('cal-sum-vs').textContent      = '+8%';
        document.getElementById('cal-sum-vs').style.color      = 'var(--red)';
        document.getElementById('cal-sum-vs-label').textContent = 'vs Last Mo.';
        document.getElementById('cal-sum-days').textContent    = '9';
        document.getElementById('cal-sum-days-label').textContent = 'Days Left';
        document.getElementById('cal-today-btn').style.display  = 'none';
        document.getElementById('cal-prev-btn').disabled        = false;
        document.getElementById('cal-next-btn').disabled        = true;
        restoreFebGrid();
    }
}

function calJumpToday() {
    if (currentCalView === 'week') { renderCalWeek(3); return; }
    if (currentCalView === 'day')  { renderCalDayView(19); return; }
    calChangeMonth(1);
}

function restoreMonthNav() {
    const isFeb = currentCalMonth === 'feb';
    document.getElementById('cal-month-title').textContent    = isFeb ? 'February 2026' : 'January 2026';
    document.getElementById('cal-sum-spent').textContent      = isFeb ? '$1,157' : '$1,073';
    document.getElementById('cal-sum-vs').textContent         = isFeb ? '+8%' : '+3%';
    document.getElementById('cal-sum-vs').style.color         = 'var(--red)';
    document.getElementById('cal-sum-vs-label').textContent   = 'vs Last Mo.';
    document.getElementById('cal-sum-days').textContent       = isFeb ? '9' : '31 days';
    document.getElementById('cal-sum-days-label').textContent = isFeb ? 'Days Left' : 'Total';
    document.getElementById('cal-prev-btn').disabled          = !isFeb;
    document.getElementById('cal-next-btn').disabled          = isFeb;
}

/* ════════════════════════════════════════════════
   CALENDAR — WEEK VIEW DATA + RENDERING
════════════════════════════════════════════════ */
const calWeekData = {
    1: {
        range: 'Feb 1 – 7', spent: '$382', vsLast: '+8%', vsColor: 'var(--red)',
        daysLabel: 'Total Days', daysVal: '7',
        days: [
            { dow:'Sun', date:1,  tint:'tint-g', amount:'$45',  barPct:68,  dots:['var(--green)','var(--teal)'] },
            { dow:'Mon', date:2,  tint:'tint-a', amount:'$62',  barPct:93,  dots:['var(--red)','var(--amber)'] },
            { dow:'Tue', date:3,  tint:'',       amount:null,   barPct:0,   dots:[] },
            { dow:'Wed', date:4,  tint:'tint-r', amount:'$95',  barPct:143, dots:['var(--red)','var(--amber)'] },
            { dow:'Thu', date:5,  tint:'tint-g', amount:'$38',  barPct:57,  dots:['var(--green)'] },
            { dow:'Fri', date:6,  tint:'tint-g', amount:'$27',  barPct:40,  dots:['var(--red)'] },
            { dow:'Sat', date:7,  tint:'tint-r', amount:'$72',  barPct:109, dots:['var(--red)'] },
        ]
    },
    2: {
        range: 'Feb 8 – 14', spent: '$458', vsLast: '+20%', vsColor: 'var(--red)',
        daysLabel: 'Total Days', daysVal: '7',
        days: [
            { dow:'Sun', date:8,  tint:'tint-p', amount:'+$3,166', barPct:0,   dots:['var(--brand)'], income:true, payday:true },
            { dow:'Mon', date:9,  tint:'tint-g', amount:'$18',     barPct:27,  dots:['var(--teal)'] },
            { dow:'Tue', date:10, tint:'tint-g', amount:'$52',     barPct:78,  dots:['var(--green)'] },
            { dow:'Wed', date:11, tint:'tint-a', amount:'$61',     barPct:92,  dots:['var(--red)','var(--green)'] },
            { dow:'Thu', date:12, tint:'tint-g', amount:'$29',     barPct:43,  dots:['var(--teal)'] },
            { dow:'Fri', date:13, tint:'tint-r', amount:'$84',     barPct:126, dots:['var(--red)','var(--amber)'] },
            { dow:'Sat', date:14, tint:'tint-r', amount:'$180',    barPct:271, dots:['var(--red)','var(--amber)','var(--brand)'] },
        ]
    },
    3: {
        range: 'Feb 15 – 21', spent: '$255', vsLast: '−18%', vsColor: 'var(--green)',
        daysLabel: 'Days Left', daysVal: '2',
        days: [
            { dow:'Sun', date:15, tint:'tint-a', amount:'$56',  barPct:85,  dots:['var(--green)'] },
            { dow:'Mon', date:16, tint:'tint-g', amount:'$12',  barPct:18,  dots:['var(--red)'] },
            { dow:'Tue', date:17, tint:'tint-g', amount:'$44',  barPct:65,  dots:['var(--red)'] },
            { dow:'Wed', date:18, tint:'tint-r', amount:'$89',  barPct:134, dots:['var(--red)'] },
            { dow:'Thu', date:19, tint:'tint-a', amount:'$54',  barPct:80,  dots:['var(--red)','var(--teal)'], today:true },
            { dow:'Fri', date:20, tint:'',       amount:null,   barPct:0,   dots:[], future:true, bill:'📺 Netflix', billAmt:'−$18.99' },
            { dow:'Sat', date:21, tint:'',       amount:null,   barPct:0,   dots:[], future:true, bill:'🏠 Rent',    billAmt:'−$1,000' },
        ]
    },
    4: {
        range: 'Feb 22 – 28', spent: '—', vsLast: '—', vsColor: 'var(--text3)',
        daysLabel: 'Days Left', daysVal: '7',
        days: [
            { dow:'Sun', date:22, tint:'tint-p', amount:null, barPct:0, dots:[], future:true, payday:true, bill:'🎵 Spotify', billAmt:'−$12.99' },
            { dow:'Mon', date:23, tint:'', amount:null, barPct:0, dots:[], future:true },
            { dow:'Tue', date:24, tint:'', amount:null, barPct:0, dots:[], future:true },
            { dow:'Wed', date:25, tint:'', amount:null, barPct:0, dots:[], future:true },
            { dow:'Thu', date:26, tint:'', amount:null, barPct:0, dots:[], future:true },
            { dow:'Fri', date:27, tint:'', amount:null, barPct:0, dots:[], future:true },
            { dow:'Sat', date:28, tint:'', amount:null, barPct:0, dots:[], future:true },
        ]
    }
};

function renderCalWeek(idx) {
    calWeekIndex = Math.max(1, Math.min(4, idx));
    const wk = calWeekData[calWeekIndex];

    // Update nav
    document.getElementById('cal-month-title').textContent = wk.range;
    document.getElementById('cal-prev-btn').disabled       = calWeekIndex <= 1;
    document.getElementById('cal-next-btn').disabled       = calWeekIndex >= 4;
    document.getElementById('cal-today-btn').style.display = calWeekIndex !== 3 ? 'inline' : 'none';

    // Update summary strip
    document.getElementById('cal-sum-spent').textContent       = wk.spent;
    document.getElementById('cal-sum-vs').textContent          = wk.vsLast;
    document.getElementById('cal-sum-vs').style.color          = wk.vsColor;
    document.getElementById('cal-sum-vs-label').textContent    = 'vs Last Wk.';
    document.getElementById('cal-sum-days').textContent        = wk.daysVal;
    document.getElementById('cal-sum-days-label').textContent  = wk.daysLabel;

    // Build tile HTML
    let html = '';
    for (const d of wk.days) {
        const todayClass  = d.today  ? ' is-today'  : '';
        const futureClass = d.future ? ' future'    : '';
        const tintClass   = d.tint   ? ' ' + d.tint : '';
        const dateStyle   = d.future ? ' style="color:var(--text3)"' : '';

        let centerHtml, amtHtml;

        if (d.future) {
            const hasPayday = d.payday;
            const hasBill   = !!d.bill;
            if (hasPayday && hasBill) {
                centerHtml = `<div class="cal-week-future-lbl">Payday + bill due</div>
                              <div class="cal-week-bill-name">${d.bill}</div>`;
                amtHtml    = `<div class="cal-week-amount future-amt">${d.billAmt}</div>`;
            } else if (hasBill) {
                centerHtml = `<div class="cal-week-future-lbl">Bill due</div>
                              <div class="cal-week-bill-name">${d.bill}</div>`;
                amtHtml    = `<div class="cal-week-amount future-amt">${d.billAmt}</div>`;
            } else if (hasPayday) {
                centerHtml = `<div class="cal-week-future-lbl">Payday</div>
                              <div class="cal-week-bill-name" style="color:var(--brand)">~$3,200</div>`;
                amtHtml    = `<div class="cal-week-amount" style="color:var(--brand)">~$3,200</div>`;
            } else {
                centerHtml = `<div class="cal-week-future-lbl">No bills</div>`;
                amtHtml    = `<div class="cal-week-amount zero-amt">—</div>`;
            }
        } else if (!d.amount) {
            centerHtml = `<div class="cal-week-dots"></div>
                          <div class="cal-week-bar-row">
                              <div class="cal-week-bar-track"><div class="cal-week-bar-fill" style="width:0%"></div></div>
                              <span class="cal-week-bar-pct">$0</span>
                          </div>`;
            amtHtml    = `<div class="cal-week-amount zero-amt">$0</div>`;
        } else {
            const dotHtml  = d.dots.map(c => `<div class="cal-week-dot" style="background:${c}"></div>`).join('');
            const barWidth = Math.min(d.barPct, 100);
            centerHtml = `<div class="cal-week-dots">${dotHtml}</div>
                          <div class="cal-week-bar-row">
                              <div class="cal-week-bar-track"><div class="cal-week-bar-fill" style="width:${barWidth}%"></div></div>
                              <span class="cal-week-bar-pct">${d.barPct}%</span>
                          </div>`;
            amtHtml    = d.income
                ? `<div class="cal-week-amount" style="color:var(--brand)">${d.amount}</div>`
                : `<div class="cal-week-amount">${d.amount}</div>`;
        }

        html += `<div class="cal-week-row${tintClass}${todayClass}${futureClass}" onclick="calSelectDay(${d.date}, 'feb')">
            <div class="cal-week-day-label">
                <div class="cal-week-dow">${d.dow}</div>
                <div class="cal-week-date"${dateStyle}>${d.date}</div>
            </div>
            <div class="cal-week-center">${centerHtml}</div>
            ${amtHtml}
        </div>`;
    }

    const container = document.getElementById('cal-week-grid');
    container.style.opacity = '0';
    setTimeout(() => { container.innerHTML = html; container.style.opacity = '1'; }, 80);
}

function calNavWeek(dir) {
    renderCalWeek(calWeekIndex + dir);
}

// January 2026: starts Thursday (offset=4), 31 days, all past, no interaction detail
const janGrid = [
    ['','',''],['a','🔴🟡','$67'],['r','🟢🔴','$145'],['','',''],
    ['g','🟢','$24'],['g','🔴','$38'],['','',''],['a','🔴','$72'],
    ['a','🟡🔴','$55'],['r','🟢🔴','$120'],['','',''],['g','🟢','$30'],
    ['g','🔴','$45'],['','',''],['r','🔴','$82'],['g','🟡','$35'],
    ['r','🟢🔴','$98'],['p','',''],['g','🟢','$28'],['','',''],
    ['a','🔴','$55'],['g','🟢','$34'],['r','🔴🟡','$89'],['','',''],
    ['','',''],['a','🔴','$48'],['','',''],['','',''],
    ['a','🔴🟢','$64'],['g','🔴','$44'],['','',''],
];
const janDotColors = {'🔴':'var(--red)','🟢':'var(--green)','🟡':'var(--amber)','🔵':'var(--teal)'};

function renderJanGrid() {
    const grid = document.getElementById('cal-grid');
    grid.style.opacity = '0';
    let html = '';
    // 4 leading blanks (Jan 1 = Thursday → Sun/Mon/Tue/Wed blank)
    for (let b = 0; b < 4; b++) html += `<div class="cal-day blank"></div>`;
    for (let i = 0; i < 31; i++) {
        const d = i + 1;
        const [tint, dots, amt] = janGrid[i] || ['','',''];
        const tintClass  = tint ? 'tint-' + tint : '';
        const isPayday   = tint === 'p';
        let dotHtml = '';
        if (dots) [...dots].filter(c => janDotColors[c]).forEach(c => {
            dotHtml += `<div class="cal-dot" style="background:${janDotColors[c]}"></div>`;
        });
        html += `<div class="cal-day ${tintClass}" onclick="calSelectDay(${d})">
            <div class="cal-date-num">${d}</div>
            ${isPayday ? '<div class="cal-payday-tag">Pay</div>' : ''}
            ${amt || isPayday ? `<div class="cal-amount${isPayday?' income':''}">${isPayday?'+$3,166':amt}</div>` : ''}
            ${dotHtml ? `<div class="cal-dots">${dotHtml}</div>` : ''}
        </div>`;
    }
    setTimeout(() => {
        grid.innerHTML = html;
        grid.style.opacity = '1';
    }, 180);
}

function restoreFebGrid() {
    const grid = document.getElementById('cal-grid');
    grid.style.opacity = '0';
    setTimeout(() => {
        grid.innerHTML = window._febGridHTML;
        grid.style.opacity = '1';
    }, 180);
}

/* ════════════════════════════════════════════════
   INSIGHTS SCREEN — TABS
════════════════════════════════════════════════ */
function switchInsTab(tab) {
    document.querySelectorAll('#screen-insights .subtab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('#screen-insights .tab-pane').forEach(p => p.classList.remove('active'));
    document.getElementById('ins-tab-' + tab).classList.add('active');
    document.getElementById('ins-pane-' + tab).classList.add('active');
}

const insSpendData = {
    'this-month': {
        kpi: [
            { val: '$2,781', sub: 'of month so far' },
            { val: '$146',   sub: '19 days tracked' },
            { val: '18%',    sub: 'of income rcvd', color: 'var(--green)' }
        ],
        incomeLabel: '$6,400 / mo',
        cats: [
            { emoji:'🏠', name:'Housing',       pct:'25%',  amt:'$1,600', bar:'100%', red:false },
            { emoji:'🍜', name:'Dining Out',    pct:'5%',   amt:'$341',   bar:'68%',  red:true  },
            { emoji:'🛒', name:'Groceries',     pct:'3%',   amt:'$178',   bar:'44%',  red:false },
            { emoji:'🚗', name:'Transport',     pct:'2%',   amt:'$122',   bar:'30%',  red:false },
            { emoji:'🛍️', name:'Shopping',      pct:'2%',   amt:'$106',   bar:'26%',  red:false },
            { emoji:'🎬', name:'Entertainment', pct:'1%',   amt:'$85',    bar:'21%',  red:false },
            { emoji:'☕', name:'Coffee',        pct:'1%',   amt:'$64',    bar:'16%',  red:false },
            { emoji:'📱', name:'Subscriptions', pct:'1%',   amt:'$60',    bar:'15%',  red:false },
            { emoji:'🏥', name:'Health',        pct:'<1%',  amt:'$45',    bar:'11%',  red:false },
            { emoji:'💡', name:'Utilities',     pct:'2%',   amt:'$120',   bar:'19%',  red:false }
        ]
    },
    '3-months': {
        kpi: [
            { val: '$3,720', sub: 'avg per month' },
            { val: '$124',   sub: '3-month avg' },
            { val: '22%',    sub: 'avg savings rate', color: 'var(--green)' }
        ],
        incomeLabel: '$6,400 / mo',
        cats: [
            { emoji:'🏠', name:'Housing',       pct:'25%', amt:'$1,600', bar:'100%', red:false },
            { emoji:'🍜', name:'Dining Out',    pct:'6%',  amt:'$384',   bar:'96%',  red:true  },
            { emoji:'🛍️', name:'Shopping',      pct:'4%',  amt:'$256',   bar:'64%',  red:false },
            { emoji:'🛒', name:'Groceries',     pct:'3%',  amt:'$192',   bar:'48%',  red:false },
            { emoji:'💡', name:'Utilities',     pct:'2%',  amt:'$130',   bar:'33%',  red:false },
            { emoji:'🚗', name:'Transport',     pct:'2%',  amt:'$128',   bar:'32%',  red:false },
            { emoji:'🎬', name:'Entertainment', pct:'2%',  amt:'$115',   bar:'29%',  red:false },
            { emoji:'☕', name:'Coffee',        pct:'1%',  amt:'$68',    bar:'17%',  red:false },
            { emoji:'📱', name:'Subscriptions', pct:'1%',  amt:'$65',    bar:'16%',  red:false },
            { emoji:'🏥', name:'Health',        pct:'<1%', amt:'$48',    bar:'12%',  red:false }
        ]
    },
    '12-months': {
        kpi: [
            { val: '$3,190', sub: 'avg per month' },
            { val: '$106',   sub: '12-month avg' },
            { val: '25%',    sub: 'avg savings rate', color: 'var(--green)' }
        ],
        incomeLabel: '$6,100 / mo',
        cats: [
            { emoji:'🏠', name:'Housing',       pct:'26%', amt:'$1,580', bar:'100%', red:false },
            { emoji:'🛒', name:'Groceries',     pct:'4%',  amt:'$244',   bar:'61%',  red:false },
            { emoji:'🍜', name:'Dining Out',    pct:'5%',  amt:'$305',   bar:'76%',  red:true  },
            { emoji:'🚗', name:'Transport',     pct:'3%',  amt:'$183',   bar:'46%',  red:false },
            { emoji:'🛍️', name:'Shopping',      pct:'3%',  amt:'$183',   bar:'46%',  red:false },
            { emoji:'🎬', name:'Entertainment', pct:'2%',  amt:'$122',   bar:'31%',  red:false },
            { emoji:'💡', name:'Utilities',     pct:'2%',  amt:'$122',   bar:'31%',  red:false },
            { emoji:'📱', name:'Subscriptions', pct:'1%',  amt:'$61',    bar:'15%',  red:false },
            { emoji:'☕', name:'Coffee',        pct:'1%',  amt:'$61',    bar:'15%',  red:false },
            { emoji:'🏥', name:'Health',        pct:'1%',  amt:'$61',    bar:'15%',  red:false }
        ]
    }
};

function switchInsPeriod(period, chipEl) {
    document.querySelectorAll('.ins-period-chip').forEach(c => c.classList.remove('active'));
    chipEl.classList.add('active');
    const d = insSpendData[period];

    // KPI row
    const kpiCards = document.querySelectorAll('#ins-pane-spend .ins-kpi-card');
    kpiCards.forEach((card, i) => {
        const kpi = d.kpi[i];
        const valEl = card.querySelector('.ins-kpi-value');
        valEl.textContent = kpi.val;
        valEl.style.color = kpi.color || '';
        card.querySelector('.ins-kpi-sub').textContent = kpi.sub;
    });

    // Income label
    document.getElementById('ins-income-label').textContent = d.incomeLabel;

    // Category rows
    const catItems = document.querySelectorAll('#ins-pane-spend .cat-item');
    catItems.forEach((item, i) => {
        const cat = d.cats[i];
        item.querySelector('.cat-emoji').textContent = cat.emoji;
        item.querySelector('.cat-name').textContent = cat.name;
        const fill = item.querySelector('.cat-fill');
        fill.style.width = cat.bar;
        fill.style.background = cat.red ? 'var(--red)' : '';
        fill.className = cat.red ? 'cat-fill' : 'cat-fill fill-brand';
        const pctEl = item.querySelector('.cat-pct');
        pctEl.textContent = cat.pct;
        pctEl.style.color = cat.red ? 'var(--red)' : '';
        const spans = item.querySelectorAll('span');
        spans[spans.length - 1].textContent = cat.amt;
    });
}

/* ════════════════════════════════════════════════
   ACCOUNTS SCREEN
════════════════════════════════════════════════ */
let acctReviewCount = 24;
const acctTotalGoal = 30;
let acctPendingTxn  = null;

function switchAcctTab(tab) {
    document.querySelectorAll('#screen-accounts .subtab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('#screen-accounts .tab-pane').forEach(p => p.classList.remove('active'));
    document.getElementById('acct-tab-' + tab).classList.add('active');
    document.getElementById('acct-pane-' + tab).classList.add('active');
    updateAcctHeader(tab);
}

function updateAcctHeader(tab) {
    const action = document.getElementById('acct-header-action');
    if (tab === 'accounts') { action.textContent = 'Sync ↺'; action.onclick = null; }
    if (tab === 'review')   { action.textContent = acctReviewCount + '/' + acctTotalGoal; action.onclick = null; }
    if (tab === 'rules')    { action.textContent = '+ Add Rule'; action.onclick = null; }
    if (tab === 'subs')     { action.textContent = '11 active'; action.onclick = null; }
}

function navigateToAcctSubs() {
    navigate('accounts');
    setTimeout(() => switchAcctTab('subs'), 300);
}

let currentRuleEl = null;

function openRuleEdit(rowEl) {
    currentRuleEl = rowEl;
    const merchant = rowEl.dataset.merchant;
    const cat = rowEl.dataset.cat;
    const header = document.getElementById('rule-edit-header');
    if (header) header.innerHTML = `<strong style="color:var(--text);">${merchant}</strong> <span style="color:var(--text2);">is currently categorised as</span> <strong style="color:var(--text);">${cat}</strong>`;
    // Pre-select current category in grid
    document.querySelectorAll('#rule-cat-grid .acct-cat-option').forEach(opt => {
        opt.classList.toggle('selected', opt.dataset.cat === cat || opt.dataset.cat === cat.replace('&amp;','&'));
    });
    document.getElementById('acct-rule-edit-backdrop').classList.add('open');
    document.getElementById('acct-rule-edit-sheet').classList.add('open');
}

function pickRuleCat(el) {
    document.querySelectorAll('#rule-cat-grid .acct-cat-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
}

function saveRuleEdit() {
    const selected = document.querySelector('#rule-cat-grid .acct-cat-option.selected');
    if (!selected || !currentRuleEl) { closeRuleEdit(); return; }
    const newCat = selected.dataset.cat;
    const newEmoji = selected.dataset.emoji;
    // Update the rule row in the DOM
    const arrow = currentRuleEl.querySelector('.acct-rule-arrow');
    if (arrow) arrow.textContent = '→ ' + newCat.replace('&amp;','&');
    const icon = currentRuleEl.querySelector('.list-icon');
    if (icon) icon.textContent = newEmoji;
    currentRuleEl.dataset.cat = newCat;
    // Upgrade badge to "You" if AI rule was corrected
    const badge = currentRuleEl.querySelector('.badge-brand');
    if (badge) { badge.textContent = 'You'; badge.className = 'badge badge-muted'; badge.style.fontSize = '9px'; }
    closeRuleEdit();
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(139,126,255,0.4);color:#fff;padding:10px 20px;border-radius:30px;font-size:12px;font-weight:600;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    toast.textContent = '✓ Rule updated — future transactions recategorised';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2800);
}

function closeRuleEdit() {
    document.getElementById('acct-rule-edit-backdrop').classList.remove('open');
    document.getElementById('acct-rule-edit-sheet').classList.remove('open');
}

function approveTransaction(txnId) {
    const el = document.getElementById(txnId);
    if (!el) return;
    el.classList.add('removing');
    setTimeout(() => {
        el.remove();
        acctReviewCount++;
        // Update progress bar and count
        const pct = Math.round((acctReviewCount / acctTotalGoal) * 100);
        const bar = document.getElementById('acct-milestone-bar');
        const cnt = document.getElementById('acct-milestone-count');
        const sub = document.getElementById('acct-milestone-sub');
        if (bar) bar.style.width = Math.min(pct, 100) + '%';
        if (cnt) cnt.textContent = acctReviewCount + ' / ' + acctTotalGoal;
        if (sub) {
            const remaining = acctTotalGoal - acctReviewCount;
            if (remaining <= 0) {
                cnt.style.color = 'var(--green)';
                sub.textContent = '🎉 AI is now active! Insights and goal suggestions unlocked.';
                if (bar) { bar.style.background = 'var(--green)'; }
            } else {
                sub.textContent = 'Review ' + remaining + ' more transaction' + (remaining !== 1 ? 's' : '') + ' to unlock AI insights & goal suggestions';
            }
        }
        // Update header counter
        const headerAction = document.getElementById('acct-header-action');
        if (headerAction && headerAction.textContent.includes('/')) {
            headerAction.textContent = acctReviewCount + '/' + acctTotalGoal;
        }
        // Show empty state if list is empty
        const list = document.getElementById('acct-review-list');
        const emptyState = document.getElementById('acct-empty-state');
        if (list && list.children.length === 0) {
            list.style.display = 'none';
            if (emptyState) emptyState.classList.add('visible');
        }
    }, 320);
}

function openCatSheet(txnId, merchantName) {
    acctPendingTxn = txnId;
    const label = document.getElementById('acct-cat-merchant');
    if (label) label.textContent = merchantName;
    document.getElementById('acct-cat-backdrop').classList.add('open');
    document.getElementById('acct-cat-sheet').classList.add('open');
}

function closeCatSheet() {
    acctPendingTxn = null;
    const bd = document.getElementById('acct-cat-backdrop');
    const sh = document.getElementById('acct-cat-sheet');
    if (bd) bd.classList.remove('open');
    if (sh) sh.classList.remove('open');
}

function pickCategory(catName, icon) {
    const pending = acctPendingTxn;
    const changeMode = acctChangeCatMode;
    acctChangeCatMode = false;
    closeCatSheet();
    if (!pending) return;
    if (changeMode) {
        // Update the tappable pill text without approving
        const item = document.getElementById(pending);
        if (item) {
            const pill = item.querySelector('.acct-pill-tap');
            if (pill) pill.textContent = '✨ ' + catName + ' ▾';
            // Show bulk apply banner
            let banner = item.querySelector('.acct-bulk-banner');
            if (!banner) {
                banner = document.createElement('div');
                banner.className = 'acct-bulk-banner';
                const merchant = pill ? pill.dataset.merchant : catName;
                banner.innerHTML = '<span>Apply <strong>' + catName + '</strong> to all matching transactions?</span><button onclick="approveTransaction(\'' + pending + '\')">Apply to all</button><button onclick="approveTransaction(\'' + pending + '\')">Just this one</button>';
                item.appendChild(banner);
            }
            banner.style.display = 'flex';
        }
    } else {
        approveTransaction(pending);
    }
}

const acctDetailData = {
    'ANZ Everyday': {
        balance: '$1,847', balanceColor: 'var(--text)',
        sub: 'Cheque account · BSB 012-345 · Acc 987654',
        transactions: [
            { icon: '⛽', name: 'Shell Coles Express',  date: 'Feb 19', amount: '−$68.40', color: 'var(--red)'  },
            { icon: '☕', name: 'Seven Seeds Coffee',    date: 'Feb 18', amount: '−$9.50',  color: 'var(--red)'  },
            { icon: '🍜', name: 'Grill\'d Burgers',     date: 'Feb 17', amount: '−$22.90', color: 'var(--red)'  },
            { icon: '💰', name: 'Salary — Acme Corp',   date: 'Feb 8',  amount: '+$3,240', color: 'var(--green)' },
            { icon: '🛒', name: 'Woolworths Metro',      date: 'Feb 7',  amount: '−$43.15', color: 'var(--red)'  },
        ]
    },
    'ANZ NetSaver': {
        balance: '$12,450', balanceColor: 'var(--green)',
        sub: 'Savings account · 3.75% p.a. variable',
        transactions: [
            { icon: '💸', name: 'Transfer from Everyday', date: 'Feb 8',  amount: '+$500',   color: 'var(--green)' },
            { icon: '💸', name: 'Transfer from Everyday', date: 'Jan 8',  amount: '+$500',   color: 'var(--green)' },
            { icon: '💸', name: 'Transfer from Everyday', date: 'Dec 8',  amount: '+$500',   color: 'var(--green)' },
            { icon: '🏦', name: 'Interest earned',        date: 'Feb 1',  amount: '+$39.20', color: 'var(--green)' },
            { icon: '🏦', name: 'Interest earned',        date: 'Jan 1',  amount: '+$38.90', color: 'var(--green)' },
        ]
    },
    'ANZ Credit Visa': {
        balance: '−$843', balanceColor: 'var(--red)',
        sub: 'Credit card · $5,000 limit · Due Mar 5',
        transactions: [
            { icon: '🎬', name: 'Event Cinemas',          date: 'Feb 17', amount: '−$28.50', color: 'var(--red)' },
            { icon: '🏥', name: 'Priceline Pharmacy',     date: 'Feb 16', amount: '−$18.75', color: 'var(--red)' },
            { icon: '📺', name: 'Netflix',                 date: 'Feb 14', amount: '−$17.99', color: 'var(--red)' },
            { icon: '🎵', name: 'Spotify',                 date: 'Feb 13', amount: '−$11.99', color: 'var(--red)' },
            { icon: '🛒', name: 'Amazon AU',               date: 'Feb 12', amount: '−$54.90', color: 'var(--red)' },
        ]
    }
};

function openAcctDetail(acctName) {
    const data = acctDetailData[acctName];
    if (!data) return;
    let html = `
        <div style="padding-top:4px;margin-bottom:16px">
            <div style="font-size:22px;font-weight:800;letter-spacing:-0.5px;color:var(--text);margin-bottom:2px">${acctName}</div>
            <div style="font-size:32px;font-weight:800;color:${data.balanceColor};letter-spacing:-1.5px;margin-bottom:4px">${data.balance}</div>
            <div style="font-size:12px;color:var(--text2)">${data.sub}</div>
        </div>
        <div class="section-hd"><div class="section-title">Recent Transactions</div></div>
        <div class="list-card">`;
    data.transactions.forEach(tx => {
        html += `
            <div class="list-item">
                <div class="list-icon" style="background:rgba(255,255,255,0.06);font-size:15px">${tx.icon}</div>
                <div style="flex:1;min-width:0">
                    <div style="font-size:13px;font-weight:600;color:var(--text)">${tx.name}</div>
                    <div style="font-size:11px;color:var(--text3)">${tx.date}</div>
                </div>
                <div style="font-size:14px;font-weight:700;color:${tx.color};flex-shrink:0">${tx.amount}</div>
            </div>`;
    });
    html += `</div>`;
    document.getElementById('acct-acct-content').innerHTML = html;
    document.getElementById('acct-acct-backdrop').classList.add('open');
    document.getElementById('acct-acct-sheet').classList.add('open');
}

function closeAcctSheet() {
    const bd = document.getElementById('acct-acct-backdrop');
    const sh = document.getElementById('acct-acct-sheet');
    if (bd) bd.classList.remove('open');
    if (sh) sh.classList.remove('open');
}

/* ════════════════════════════════════════════════
   ONBOARDING
════════════════════════════════════════════════ */
let obCurrent = 'ob-1';

function showOnboarding() {
    // Reset to screen 1
    document.querySelectorAll('.ob-screen').forEach(s => s.classList.remove('active', 'exit-left'));
    document.getElementById('ob-1').classList.add('active');
    obCurrent = 'ob-1';
    document.getElementById('ob-overlay').classList.remove('hidden');
    // Update sidebar highlight
    document.querySelectorAll('.sb-nav-item').forEach(i => i.classList.remove('active'));
    const sb = document.getElementById('sb-onboarding');
    if (sb) sb.classList.add('active');
    document.querySelectorAll('.note-set').forEach(n => n.classList.remove('active'));
    const notes = document.getElementById('notes-onboarding');
    if (notes) notes.classList.add('active');
}

function obTo(id) {
    const old = document.getElementById(obCurrent);
    old.classList.remove('active');
    old.classList.add('exit-left');
    setTimeout(() => old.classList.remove('exit-left'), 300);
    obCurrent = id;
    document.getElementById(id).classList.add('active');
}

function obExplore() {
    document.getElementById('ob-overlay').classList.add('hidden');
    // Reset sidebar to home
    document.querySelectorAll('.sb-nav-item').forEach(i => i.classList.remove('active'));
    document.getElementById('sb-home').classList.add('active');
    document.querySelectorAll('.note-set').forEach(n => n.classList.remove('active'));
    document.getElementById('notes-home').classList.add('active');
    currentScreen = 'home';
    document.querySelectorAll('.app-screen').forEach(s => s.classList.remove('active'));
    document.getElementById('screen-home').classList.add('active');
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    document.getElementById('nav-home').classList.add('active');
    document.getElementById('arrow-row').style.display = 'flex';
    document.getElementById('plan-controls').style.display = 'none';
}

function obComplete() {
    document.getElementById('ob-overlay').classList.add('hidden');
    navigate('accounts');
    setTimeout(() => { if (typeof switchAcctTab === 'function') switchAcctTab('review'); }, 350);
    document.querySelectorAll('.sb-nav-item').forEach(i => i.classList.remove('active'));
    document.getElementById('sb-accounts').classList.add('active');
}

function obSelectBank(el) {
    document.querySelectorAll('.ob-bank-card').forEach(c => {
        c.classList.remove('selected');
        c.style.borderColor = '';
        c.style.background = '';
    });
    el.classList.add('selected');
}

function obSelectCycle(el) {
    document.querySelectorAll('.ob-option-card').forEach(c => {
        c.classList.remove('selected');
        c.querySelector('.ob-option-check').textContent = '';
    });
    el.classList.add('selected');
    el.querySelector('.ob-option-check').textContent = '✓';
}

function obStartConnect() {
    obTo('ob-6');
    obRunProcessing();
}

function obRunProcessing() {
    let count = 0;
    const total = 847;
    const countEl = document.getElementById('ob-proc-count');
    const ticker = setInterval(() => {
        count += Math.floor(Math.random() * 55) + 35;
        if (count >= total) { count = total; clearInterval(ticker); }
        if (countEl) countEl.textContent = count + ' of ~' + total + ' imported';

        if (count >= total) {
            // Step 2 → done, Step 3 → active
            setTimeout(() => {
                const p2icon = document.getElementById('ob-p2-icon');
                if (p2icon) { p2icon.className = 'ob-step-icon ob-step-done'; p2icon.textContent = '✓'; }
                if (countEl) { countEl.style.color = 'var(--green)'; countEl.textContent = total + ' transactions imported'; }
                const p3icon = document.getElementById('ob-p3-icon');
                const p3title = document.getElementById('ob-p3-title');
                const p3sub = document.getElementById('ob-p3-sub');
                if (p3icon)  { p3icon.className = 'ob-step-icon ob-step-active'; p3icon.textContent = '◉'; }
                if (p3title) p3title.style.color = 'var(--text)';
                if (p3sub)   { p3sub.style.color = 'var(--brand)'; p3sub.textContent = 'Categorising 847 transactions…'; }
            }, 400);
            // Step 3 → done, Step 4 → active
            setTimeout(() => {
                const p3icon  = document.getElementById('ob-p3-icon');
                const p3sub   = document.getElementById('ob-p3-sub');
                const p4icon  = document.getElementById('ob-p4-icon');
                const p4title = document.getElementById('ob-p4-title');
                const p4sub   = document.getElementById('ob-p4-sub');
                if (p3icon) { p3icon.className = 'ob-step-icon ob-step-done'; p3icon.textContent = '✓'; }
                if (p3sub)  { p3sub.style.color = 'var(--green)'; p3sub.textContent = 'All transactions categorised'; }
                if (p4icon)  { p4icon.className = 'ob-step-icon ob-step-active'; p4icon.textContent = '◉'; }
                if (p4title) p4title.style.color = 'var(--text)';
                if (p4sub)   { p4sub.style.color = 'var(--brand)'; p4sub.textContent = 'Building your Safe to Spend…'; }
            }, 2200);
            // Step 4 → done, advance to Reveal
            setTimeout(() => {
                const p4icon = document.getElementById('ob-p4-icon');
                const p4sub  = document.getElementById('ob-p4-sub');
                if (p4icon) { p4icon.className = 'ob-step-icon ob-step-done'; p4icon.textContent = '✓'; }
                if (p4sub)  { p4sub.style.color = 'var(--green)'; p4sub.textContent = 'Insights ready'; }
            }, 3400);
            setTimeout(() => obTo('ob-7'), 4000);
        }
    }, 110);
}

/* ════════════════════════════════════════════════
   ONBOARDING — VERIFY STEPS (Screen 7 sub-steps)
════════════════════════════════════════════════ */
function obVerifyStep(step) {
    [1,2,3].forEach(n => {
        const el = document.getElementById('ob-v' + n);
        if (el) el.style.display = 'none';
    });
    const target = document.getElementById('ob-v' + step);
    if (target) target.style.display = '';
    [1,2,3].forEach(n => {
        const pip = document.getElementById('ob-v-pip-' + n);
        if (!pip) return;
        pip.style.width = n === step ? '24px' : '6px';
        pip.style.background = n < step ? 'var(--green)' : (n === step ? 'var(--brand)' : 'var(--text3)');
    });
    const lbl = document.getElementById('ob-v-label');
    if (lbl) lbl.textContent = 'Step ' + step + ' of 3';
}

/* ════════════════════════════════════════════════
   ONBOARDING — SCREEN 8 CATEGORY CHANGE & APPROVE
════════════════════════════════════════════════ */
let ob8PendingItem = null;

function ob8ChangeCat(itemNum, merchantName, currentCat) {
    ob8PendingItem = itemNum;
    const label = document.getElementById('ob8-cat-merchant');
    if (label) label.textContent = merchantName;
    document.getElementById('ob8-cat-backdrop').classList.add('open');
    document.getElementById('ob8-cat-sheet').classList.add('open');
}

function ob8CloseCat() {
    ob8PendingItem = null;
    document.getElementById('ob8-cat-backdrop').classList.remove('open');
    document.getElementById('ob8-cat-sheet').classList.remove('open');
}

function ob8PickCat(catName, icon) {
    const n = ob8PendingItem;
    ob8CloseCat();
    if (!n) return;
    // Update pill
    const pill = document.getElementById('ob8-pill-' + n);
    if (pill) { pill.style.background = 'var(--brand-light)'; pill.style.color = 'var(--brand)'; pill.textContent = icon + ' ' + catName + ' ▾'; }
    // Show bulk apply banner
    const banner = document.getElementById('ob8-bulk-' + n);
    if (banner) banner.style.display = 'flex';
}

function ob8Approve(itemNum) {
    const el = document.getElementById('ob8-txn-' + itemNum);
    if (!el) return;
    el.style.transition = 'opacity 0.3s, max-height 0.3s';
    el.style.overflow = 'hidden';
    el.style.maxHeight = el.offsetHeight + 'px';
    requestAnimationFrame(() => { el.style.opacity = '0'; el.style.maxHeight = '0'; });
    setTimeout(() => el.remove(), 320);
}

/* ════════════════════════════════════════════════
   TO REVIEW — CATEGORY CHANGE (pill tap, no auto-approve)
════════════════════════════════════════════════ */
let acctChangeCatMode = false;

function changeCatForTxn(txnId, merchantName) {
    acctPendingTxn = txnId;
    acctChangeCatMode = true;
    const label = document.getElementById('acct-cat-merchant');
    if (label) label.textContent = merchantName;
    document.getElementById('acct-cat-backdrop').classList.add('open');
    document.getElementById('acct-cat-sheet').classList.add('open');
}

/* ════════════════════════════════════════════════
   TO REVIEW — CREATE RULE SHEET
════════════════════════════════════════════════ */
let ruleSheetTxnId = null;
let ruleSelectedCat = null;

function openRuleSheet(txnId, merchant, category) {
    ruleSheetTxnId = txnId;
    ruleSelectedCat = null;
    const mv = document.getElementById('rule-merchant-val');
    if (mv) mv.value = merchant;
    // Update affected list names
    [1,2,3,4].forEach(n => {
        const el = document.getElementById('rule-aff-name-' + n);
        if (el) el.textContent = merchant;
    });
    // Reset category selection + button
    document.querySelectorAll('#add-rule-cat-grid .acct-cat-option').forEach(o => o.classList.remove('selected'));
    const btn = document.getElementById('rule-apply-btn');
    if (btn) { btn.style.background = 'rgba(139,126,255,0.3)'; btn.style.color = 'var(--text3)'; btn.style.cursor = 'not-allowed'; btn.textContent = 'Select a category first'; }
    document.getElementById('acct-rule-backdrop').classList.add('open');
    document.getElementById('acct-rule-sheet').classList.add('open');
}

function closeRuleSheet() {
    document.getElementById('acct-rule-backdrop').classList.remove('open');
    document.getElementById('acct-rule-sheet').classList.remove('open');
}

function pickAddRuleCat(catName, icon, el) {
    ruleSelectedCat = catName;
    document.querySelectorAll('#add-rule-cat-grid .acct-cat-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    const btn = document.getElementById('rule-apply-btn');
    if (btn) {
        btn.style.background = 'var(--brand)'; btn.style.color = '#fff'; btn.style.cursor = 'pointer';
        btn.textContent = 'Create Rule — Apply "' + catName + '" to 4 transactions';
    }
}

function toggleAmtInput(sel) {
    const v = sel.value;
    const v1 = document.getElementById('rule-amt-val1');
    const v2 = document.getElementById('rule-amt-val2');
    const and = document.getElementById('rule-amt-and');
    const show = v !== '';
    if (v1) v1.style.display = show ? '' : 'none';
    if (v2) v2.style.display = v === 'is between' ? '' : 'none';
    if (and) and.style.display = v === 'is between' ? '' : 'none';
}

function applyRule() {
    if (!ruleSelectedCat) return;
    closeRuleSheet();
    if (ruleSheetTxnId) approveTransaction(ruleSheetTxnId);
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(139,126,255,0.4);color:#fff;padding:10px 20px;border-radius:30px;font-size:12px;font-weight:600;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    toast.textContent = '⚡ Rule created — 4 transactions recategorised';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

/* ════════════════════════════════════════════════
   PLAN — ADD GOAL MULTI-STEP FLOW
════════════════════════════════════════════════ */
const agAllPanels = ['ag-pick','ag-save-1','ag-save-2','ag-save-3','ag-habit-1','ag-habit-2','ag-habit-3','ag-debt-1','ag-debt-2','ag-debt-3'];
let agSaveEmoji = '🏖️';

function agGoStep(type, step) {
    agAllPanels.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    });
    const target = (type && step) ? ('ag-' + type + '-' + step) : 'ag-pick';
    const panel = document.getElementById(target);
    if (panel) panel.style.display = '';
    // Scroll sheet to top
    const sheet = document.getElementById('add-goal-sheet');
    if (sheet) sheet.scrollTop = 0;
}

function agSelectEmoji(type, el, emoji) {
    document.querySelectorAll('#ag-save-emoji-row .ag-emoji-btn').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
    agSaveEmoji = emoji;
    const prev = document.getElementById('ag-save-preview-emoji');
    if (prev) prev.textContent = emoji;
}

function agSelectHabitCat(el, cat, emoji, avg) {
    document.querySelectorAll('#ag-habit-cat-grid .ag-cat-item').forEach(i => i.classList.remove('selected'));
    el.classList.add('selected');
    const banner = document.getElementById('ag-habit-avg-banner');
    const avgVal = document.getElementById('ag-habit-avg-val');
    if (banner) banner.style.display = '';
    if (avgVal) avgVal.textContent = avg + '/mo';
    const btn = document.getElementById('ag-habit-next-1');
    if (btn) { btn.disabled = false; btn.style.background = 'var(--brand)'; btn.style.color = '#fff'; btn.style.cursor = 'pointer'; btn.textContent = 'Next →'; }
    const baseline = document.getElementById('ag-habit-baseline');
    if (baseline) baseline.textContent = avg + '/mo';
}

function agSelectDebt(el, name, balance) {
    // visual only — already pre-selected ANZ card in the prototype
}

function agChip(el, group) {
    el.closest('.ag-option-chips').querySelectorAll('.ag-chip').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
}

function agShowDeadline(show) {
    const picker = document.getElementById('ag-deadline-picker');
    const gap = document.getElementById('ag-deadline-gap');
    if (picker) picker.style.display = show ? '' : 'none';
    if (gap) gap.style.display = show ? 'none' : '';
}

let agAutoTransferOn = true;
function agToggleAutoTransfer() {
    agAutoTransferOn = !agAutoTransferOn;
    const track = document.getElementById('ag-autotransfer-toggle');
    const opts = document.getElementById('ag-autotransfer-opts');
    if (track) track.classList.toggle('off', !agAutoTransferOn);
    if (opts) opts.style.display = agAutoTransferOn ? '' : 'none';
}

function agPublish(type) {
    closeSheet();
    const typeLabels = { save: '🎯 Save Up goal', habit: '📊 Spending Habit', debt: '💳 Debt Paydown' };
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(139,126,255,0.4);color:#fff;padding:10px 20px;border-radius:30px;font-size:12px;font-weight:600;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    toast.textContent = (typeLabels[type] || 'Goal') + ' published! 🎉';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

/* ════════════════════════════════════════════════
   PLAN — GOAL DETAIL SHEET
════════════════════════════════════════════════ */
const goalDetailData = {
    japan: {
        emoji: '🏖️', name: 'Japan Trip', type: 'Save Up Goal',
        badge: '<span class="badge badge-green">On Track</span>',
        progress: 57, amount: '$2,840', target: '$5,000',
        footer: 'ETA August 2026 · Auto-transfer $300/mo',
        acctNote: 'Attributed to ANZ NetSaver · <span style="color:var(--green)">Account dedicated to this goal</span>',
        contributions: [
            { date:'19 Feb', name:'Auto-transfer', source:'ANZ NetSaver', amount:'+$300' },
            { date:'22 Jan', name:'Auto-transfer', source:'ANZ NetSaver', amount:'+$300' },
            { date:'22 Dec', name:'Auto-transfer', source:'ANZ NetSaver', amount:'+$300' },
            { date:'10 Dec', name:'Manual allocation', source:'ANZ NetSaver deposit', amount:'+$500' },
            { date:'22 Nov', name:'Auto-transfer', source:'ANZ NetSaver', amount:'+$300' },
            { date:'22 Oct', name:'Auto-transfer', source:'ANZ NetSaver', amount:'+$300' },
        ]
    },
    dining: {
        emoji: '🍔', name: 'Dining Out', type: 'Spending Habit',
        badge: '<span class="badge badge-amber">At Risk</span>',
        progress: 73, amount: '$341 spent', target: '$464/mo limit',
        footer: 'Month 3 of streak · Feb ends in 8 days',
        acctNote: 'Tracked from your bank transactions — no account needed',
        contributions: [
            { date:'19 Feb', name:'Uber Eats', source:'ANZ Everyday', amount:'−$48.20' },
            { date:'15 Feb', name:'Nobu Melbourne', source:'ANZ Everyday', amount:'−$124.00' },
            { date:'13 Feb', name:'Uber Eats', source:'ANZ Everyday', amount:'−$36.90' },
            { date:'10 Feb', name:'Taco Bell', source:'ANZ Everyday', amount:'−$22.70' },
            { date:'8 Feb',  name:'Grill\'d Burgers', source:'ANZ Everyday', amount:'−$32.40' },
            { date:'5 Feb',  name:'Criniti\'s', source:'ANZ Everyday', amount:'−$76.80' },
        ]
    },
    visa: {
        emoji: '💳', name: 'ANZ Visa', type: 'Debt Paydown',
        badge: '<span class="badge badge-green">Ahead</span>',
        progress: 43, amount: '$2,150 paid', target: '$5,000 total',
        footer: 'Projected payoff Dec 2025 · 2 months ahead of schedule',
        acctNote: 'Linked to ANZ Credit Visa · balance auto-updated via Basiq',
        contributions: [
            { date:'8 Feb',  name:'Manual payment', source:'ANZ Everyday', amount:'+$400' },
            { date:'8 Jan',  name:'Manual payment', source:'ANZ Everyday', amount:'+$350' },
            { date:'8 Dec',  name:'Manual payment', source:'ANZ Everyday', amount:'+$350' },
            { date:'8 Nov',  name:'Manual payment', source:'ANZ Everyday', amount:'+$350' },
            { date:'8 Oct',  name:'Manual payment', source:'ANZ Everyday', amount:'+$300' },
            { date:'8 Sep',  name:'Minimum payment', source:'ANZ Auto', amount:'+$25' },
        ]
    }
};

function openGoalDetail(id) {
    const d = goalDetailData[id];
    if (!d) return;
    const isCredit = id === 'visa';
    const amtColor = id === 'dining' ? 'color:var(--amber)' : (isCredit ? 'color:var(--green)' : '');
    const rowColor = id === 'dining' ? 'color:var(--red)' : 'color:var(--green)';

    let rows = d.contributions.map(c => `
        <div class="goal-contr-row">
            <div class="goal-contr-date">${c.date}</div>
            <div class="goal-contr-info">
                <div class="goal-contr-name">${c.name}</div>
                <div class="goal-contr-source">${c.source}</div>
            </div>
            <div class="goal-contr-amount" style="${rowColor}">${c.amount}</div>
            <div class="goal-contr-reassign" onclick="showReassignToast()">Reassign</div>
        </div>`).join('');

    document.getElementById('goal-detail-content').innerHTML = `
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
            <div style="display:flex;align-items:center;gap:12px;">
                <div style="font-size:30px;">${d.emoji}</div>
                <div><div style="font-size:18px;font-weight:800;color:var(--text);">${d.name}</div><div style="font-size:12px;color:var(--text2);">${d.type}</div></div>
            </div>
            ${d.badge}
        </div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:14px;">
            <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px;">
                <div style="font-size:18px;font-weight:800;${amtColor}">${d.amount}</div>
                <div style="font-size:13px;color:var(--text2);">${d.target}</div>
            </div>
            <div class="progress-track" style="margin-bottom:6px;"><div class="progress-fill fill-brand" style="width:${d.progress}%;${isCredit?'background:var(--green)':''}"></div></div>
            <div style="font-size:11px;color:var(--text2);">${d.footer}</div>
        </div>
        <div style="background:var(--brand-light);border:1px solid rgba(139,126,255,0.2);border-radius:12px;padding:10px 14px;margin-bottom:16px;font-size:12px;color:var(--text2);">🏦 ${d.acctNote}</div>
        <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:8px;">${id === 'dining' ? 'Transactions this month' : 'Contributions'}</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:6px 16px;margin-bottom:16px;">${rows}</div>
        <div style="display:flex;gap:10px;">
            <button onclick="closeGoalDetail()" style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;font-family:inherit;">Edit Goal</button>
            <button onclick="closeGoalDetail()" style="flex:1;background:var(--brand);border:none;border-radius:12px;padding:12px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:inherit;">Done</button>
        </div>`;

    document.getElementById('goal-detail-backdrop').classList.add('open');
    document.getElementById('goal-detail-sheet').classList.add('open');
}

function closeGoalDetail() {
    document.getElementById('goal-detail-backdrop').classList.remove('open');
    document.getElementById('goal-detail-sheet').classList.remove('open');
}

function showReassignToast() {
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(139,126,255,0.4);color:#fff;padding:10px 20px;border-radius:30px;font-size:12px;font-weight:600;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    toast.textContent = '↕ Reassign — select destination goal';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2500);
}

/* ════════════════════════════════════════════════
   PLAN — GOAL ALLOCATION SHEET
════════════════════════════════════════════════ */
let goalAllocTotal = 300;

function goalAllocAll(btn) {
    const allInputs = document.querySelectorAll('#goal-alloc-sheet .goal-alloc-input');
    allInputs.forEach(inp => { inp.value = 0; });
    const row = btn.closest('.goal-alloc-split');
    const rowInput = row ? row.querySelector('.goal-alloc-input') : null;
    if (rowInput) rowInput.value = goalAllocTotal;
}

function openGoalAlloc(type, amount) {
    goalAllocTotal = amount;
    const isDeposit = type === 'deposit';
    const icon = document.getElementById('goal-alloc-icon');
    const lbl = document.getElementById('goal-alloc-type-label');
    const title = document.getElementById('goal-alloc-title');
    const sub = document.getElementById('goal-alloc-sub');
    if (icon) { icon.style.background = isDeposit ? 'var(--green-light)' : 'var(--amber-light)'; icon.textContent = isDeposit ? '💰' : '💸'; }
    if (lbl) { lbl.style.color = isDeposit ? 'var(--green)' : 'var(--amber)'; lbl.textContent = isDeposit ? 'New Deposit Detected' : 'Withdrawal Detected'; }
    if (title) title.textContent = (isDeposit ? 'Allocate ' : 'Account for ') + '$' + amount;
    if (sub) sub.textContent = isDeposit
        ? 'You transferred $' + amount + ' to ANZ NetSaver on Thu 19 Feb. Which goal should this go toward? You can split it across goals.'
        : 'You withdrew $' + amount + ' from ANZ NetSaver on Thu 19 Feb. Which goal are you drawing from?';
    document.getElementById('goal-alloc-backdrop').classList.add('open');
    document.getElementById('goal-alloc-sheet').classList.add('open');
}

function closeGoalAlloc() {
    document.getElementById('goal-alloc-backdrop').classList.remove('open');
    document.getElementById('goal-alloc-sheet').classList.remove('open');
}

function confirmGoalAlloc() {
    closeGoalAlloc();
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(139,126,255,0.4);color:#fff;padding:10px 20px;border-radius:30px;font-size:12px;font-weight:600;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    toast.textContent = '✓ $300 allocated to Japan Trip';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2500);
}

/* ════════════════════════════════════════════════
   PLAN — BUDGET DETAIL SHEET
════════════════════════════════════════════════ */
const budgetDetailData = {
    groceries: {
        emoji:'🛒', name:'Groceries', limit:'$600', spent:'$412', pct:'69', fill:'fill-green', badge:'badge-green', status:'On Track',
        txns: [
            { icon:'🛒', name:'Woolworths', date:'Wed 19 Feb', amount:'−$94.20' },
            { icon:'🛒', name:'Coles', date:'Sat 15 Feb', amount:'−$78.50' },
            { icon:'🌿', name:'Harris Farm Markets', date:'Thu 13 Feb', amount:'−$44.80' },
            { icon:'🛒', name:'Aldi', date:'Mon 10 Feb', amount:'−$62.30' },
            { icon:'🛒', name:'Woolworths', date:'Sat 8 Feb', amount:'−$92.10' },
            { icon:'🛒', name:'IGA', date:'Wed 5 Feb', amount:'−$40.10' },
        ]
    },
    dining: {
        emoji:'🍔', name:'Dining Out', limit:'$464', spent:'$341', pct:'73', fill:'fill-amber', badge:'badge-amber', status:'At Risk',
        txns: [
            { icon:'🍔', name:'Uber Eats', date:'Wed 19 Feb', amount:'−$48.20' },
            { icon:'🍣', name:'Nobu Melbourne', date:'Sat 15 Feb', amount:'−$124.00' },
            { icon:'🍔', name:'Uber Eats', date:'Thu 13 Feb', amount:'−$36.90' },
            { icon:'🌮', name:'Taco Bell', date:'Mon 10 Feb', amount:'−$22.70' },
            { icon:'🍔', name:'Grill\'d', date:'Sat 8 Feb', amount:'−$32.40' },
        ]
    },
    entertainment: {
        emoji:'🎬', name:'Entertainment', limit:'$150', spent:'$60', pct:'40', fill:'fill-green', badge:'badge-green', status:'On Track',
        txns: [
            { icon:'🎬', name:'Event Cinemas', date:'Sat 15 Feb', amount:'−$36.00' },
            { icon:'🎮', name:'Steam Store', date:'Mon 10 Feb', amount:'−$24.00' },
        ]
    },
    transport: {
        emoji:'🚗', name:'Transport', limit:'$250', spent:'$290', pct:'116', fill:'fill-red', badge:'badge-red', status:'Over Budget',
        txns: [
            { icon:'⛽', name:'Shell Coles Express', date:'Wed 19 Feb', amount:'−$82.50' },
            { icon:'🅿️', name:'Wilson Parking', date:'Mon 17 Feb', amount:'−$28.00' },
            { icon:'🚂', name:'Myki', date:'Fri 14 Feb', amount:'−$40.00' },
            { icon:'⛽', name:'BP Fuel', date:'Mon 10 Feb', amount:'−$88.30' },
            { icon:'🅿️', name:'City of Melbourne Parking', date:'Thu 6 Feb', amount:'−$18.00' },
            { icon:'🚕', name:'Uber', date:'Sat 1 Feb', amount:'−$33.20' },
        ]
    },
    shopping: {
        emoji:'🛍️', name:'Shopping', limit:'$500', spent:'$375', pct:'75', fill:'fill-green', badge:'badge-green', status:'On Track',
        txns: [
            { icon:'👕', name:'Zara', date:'Sat 15 Feb', amount:'−$189.00' },
            { icon:'📚', name:'Readings Books', date:'Thu 13 Feb', amount:'−$42.00' },
            { icon:'🛍️', name:'Cotton On', date:'Mon 10 Feb', amount:'−$84.00' },
            { icon:'💊', name:'Chemist Warehouse', date:'Sat 8 Feb', amount:'−$60.00' },
        ]
    }
};

function openBudgetDetail(id) {
    const d = budgetDetailData[id];
    if (!d) return;
    const isDining = id === 'dining';
    const isOver = parseFloat(d.pct) > 100;

    let txnRows = d.txns.map(t => `
        <div class="budget-txn-row">
            <div style="width:32px;height:32px;background:var(--card);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;">${t.icon}</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:600;color:var(--text);">${t.name}</div><div style="font-size:11px;color:var(--text2);">${t.date}</div></div>
            <div style="font-size:13px;font-weight:700;color:${isOver?'var(--red)':'var(--text)'};">${t.amount}</div>
        </div>`).join('');

    document.getElementById('budget-detail-content').innerHTML = `
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
            <div style="display:flex;align-items:center;gap:10px;">
                <div style="font-size:28px;">${d.emoji}</div>
                <div style="font-size:18px;font-weight:800;color:var(--text);">${d.name}</div>
            </div>
            <span class="badge ${d.badge}">${d.status}</span>
        </div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:14px;">
            <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px;">
                <div style="font-size:20px;font-weight:800;color:${isOver?'var(--red)':'var(--text)'};">${d.spent}</div>
                <div style="font-size:13px;color:var(--text2);">of ${d.limit} budget</div>
            </div>
            <div class="progress-track overflow-visible" style="margin-bottom:6px;position:relative;">
                <div class="period-marker" style="left:68%"></div>
                <div class="progress-fill ${d.fill}" style="width:${Math.min(parseFloat(d.pct),100)}%"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text2);margin-top:4px;">
                <span>Day 19 of 28 · 68% elapsed</span><span>${d.pct}% used</span>
            </div>
        </div>
        ${isDining ? '<div style="background:var(--teal-light);border:1px solid rgba(78,205,196,0.2);border-radius:12px;padding:10px 14px;font-size:12px;color:var(--text2);margin-bottom:14px;">⟷ Synced with your Dining Out Spending Habit goal</div>' : ''}
        <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:8px;">${d.txns.length} transactions this month</div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:6px 16px;margin-bottom:16px;">${txnRows}</div>
        <div style="display:flex;gap:10px;">
            <button onclick="openBudgetLimitEdit('${id}')" style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;font-family:inherit;">Edit Limit</button>
            <button onclick="closeBudgetDetail()" style="flex:1;background:var(--brand);border:none;border-radius:12px;padding:12px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:inherit;">Done</button>
        </div>`;

    document.getElementById('budget-detail-backdrop').classList.add('open');
    document.getElementById('budget-detail-sheet').classList.add('open');
}

function closeBudgetDetail() {
    document.getElementById('budget-detail-backdrop').classList.remove('open');
    document.getElementById('budget-detail-sheet').classList.remove('open');
}

function openBudgetLimitEdit(id) {
    const d = budgetDetailData[id];
    if (!d) return;
    const cur = parseInt(d.limit.replace(/[^0-9]/g, ''));
    const tenLess = Math.round(cur * 0.9);

    document.getElementById('budget-detail-content').innerHTML = `
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
            <div style="font-size:28px;">${d.emoji}</div>
            <div>
                <div style="font-size:18px;font-weight:800;color:var(--text);">${d.name}</div>
                <div style="font-size:11px;color:var(--text2);">Adjust monthly limit</div>
            </div>
        </div>
        <div style="font-size:12px;color:var(--text2);margin-bottom:14px;padding:10px 12px;background:var(--card);border-radius:10px;display:flex;justify-content:space-between;">
            <span>Current limit</span><strong style="color:var(--text);">${d.limit}/month</strong>
        </div>
        <div class="ag-option-chips" id="bl-chips" style="margin-bottom:14px;">
            <div class="ag-chip" onclick="blChip(this,'same',${cur})">Keep same</div>
            <div class="ag-chip selected" onclick="blChip(this,'10less',${cur})">10% less</div>
            <div class="ag-chip" onclick="blChip(this,'20less',${cur})">20% less</div>
            <div class="ag-chip" onclick="blChip(this,'custom',${cur})">Custom</div>
        </div>
        <div style="display:flex;align-items:center;background:var(--card);border:1.5px solid var(--brand);border-radius:12px;padding:12px 14px;margin-bottom:10px;">
            <span style="font-size:18px;font-weight:700;color:var(--text2);margin-right:6px;">$</span>
            <input type="number" id="bl-input" value="${tenLess}" style="flex:1;min-width:0;background:transparent;border:none;font-size:20px;font-weight:800;color:var(--text);font-family:inherit;outline:none;">
            <span style="font-size:12px;color:var(--text2);flex-shrink:0;">/month</span>
        </div>
        <div id="bl-info" style="font-size:12px;color:var(--text2);padding:10px 14px;background:var(--card);border-radius:10px;margin-bottom:20px;">
            10% below current $${cur} · saves <strong style="color:var(--text);">$${Math.round(cur * 0.1 * 12)}/year</strong>
        </div>
        <div style="display:flex;gap:10px;">
            <button onclick="openBudgetDetail('${id}')" style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;font-family:inherit;">Cancel</button>
            <button onclick="saveBudgetLimit('${id}')" style="flex:1;background:var(--brand);border:none;border-radius:12px;padding:12px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;font-family:inherit;">Save limit</button>
        </div>`;

    document.getElementById('budget-detail-sheet').scrollTop = 0;
}

function blChip(el, preset, base) {
    document.querySelectorAll('#bl-chips .ag-chip').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    const input = document.getElementById('bl-input');
    const info = document.getElementById('bl-info');
    let val, infoHtml;
    switch (preset) {
        case 'same':
            val = base;
            infoHtml = `Same as current · no change`;
            break;
        case '10less':
            val = Math.round(base * 0.9);
            infoHtml = `10% below $${base} · saves <strong style="color:var(--text);">$${Math.round(base * 0.1 * 12)}/year</strong>`;
            break;
        case '20less':
            val = Math.round(base * 0.8);
            infoHtml = `20% below $${base} · saves <strong style="color:var(--text);">$${Math.round(base * 0.2 * 12)}/year</strong>`;
            break;
        case 'custom':
            if (input) { input.focus(); input.select(); }
            infoHtml = `Enter your own monthly limit above`;
            break;
    }
    if (input && val !== undefined) input.value = val;
    if (info) info.innerHTML = infoHtml || '';
}

function saveBudgetLimit(id) {
    const input = document.getElementById('bl-input');
    if (!input) return;
    const newVal = parseInt(input.value);
    if (!newVal || newVal < 1) return;
    if (budgetDetailData[id]) budgetDetailData[id].limit = '$' + newVal;
    openBudgetDetail(id);
    // Brief green flash on the sheet handle to confirm save
    const handle = document.querySelector('#budget-detail-sheet .sheet-handle');
    if (handle) {
        handle.style.background = 'var(--green)';
        setTimeout(() => { handle.style.background = ''; }, 700);
    }
}

/* ════════════════════════════════════════════════
   PLAN — ADD BUDGET MULTI-STEP FLOW
════════════════════════════════════════════════ */
let abSelectedCat = null;

function openAddBudget() {
    abSelectedCat = null;
    ['ab-step-1','ab-step-2','ab-step-3'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = id === 'ab-step-1' ? '' : 'none';
    });
    document.querySelectorAll('#add-budget-sheet .ag-cat-item').forEach(i => i.classList.remove('selected'));
    const banner = document.getElementById('ab-avg-banner');
    if (banner) banner.style.display = 'none';
    const btn = document.getElementById('ab-next-1');
    if (btn) { btn.disabled = true; btn.style.background = 'rgba(139,126,255,0.3)'; btn.style.color = 'var(--text3)'; btn.style.cursor = 'not-allowed'; btn.textContent = 'Select a category first'; }
    document.getElementById('add-budget-backdrop').classList.add('open');
    document.getElementById('add-budget-sheet').classList.add('open');
}

function closeAddBudget() {
    document.getElementById('add-budget-backdrop').classList.remove('open');
    document.getElementById('add-budget-sheet').classList.remove('open');
}

function abGoStep(step) {
    ['ab-step-1','ab-step-2','ab-step-3'].forEach((id, i) => {
        const el = document.getElementById(id);
        if (el) el.style.display = (i + 1 === step) ? '' : 'none';
    });
    if (step === 2 && abSelectedCat) {
        const avgNum = parseInt(abSelectedCat.avg.replace(/[^0-9]/g, ''));
        abSetPreset(null, '10less', avgNum);
    }
    const sheet = document.getElementById('add-budget-sheet');
    if (sheet) sheet.scrollTop = 0;
}

function abSelectCat(el, name, emoji, avg) {
    abSelectedCat = { name, emoji, avg };
    document.querySelectorAll('#ab-step-1 .ag-cat-item').forEach(i => i.classList.remove('selected'));
    el.classList.add('selected');
    const banner = document.getElementById('ab-avg-banner');
    const avgVal = document.getElementById('ab-avg-val');
    if (banner) banner.style.display = '';
    if (avgVal) avgVal.textContent = avg + '/mo';
    const btn = document.getElementById('ab-next-1');
    if (btn) { btn.disabled = false; btn.style.background = 'var(--brand)'; btn.style.color = '#fff'; btn.style.cursor = 'pointer'; btn.textContent = 'Next →'; }
    // Update step 3 preview
    const pe = document.getElementById('ab-preview-emoji');
    const pn = document.getElementById('ab-preview-name');
    if (pe) pe.textContent = emoji;
    if (pn) pn.textContent = name;
}

function abSetPreset(el, preset, avgOverride) {
    const chipsContainer = document.getElementById('ab-preset-chips');
    if (chipsContainer) {
        chipsContainer.querySelectorAll('.ag-chip').forEach(c => c.classList.remove('selected'));
        if (el) {
            el.classList.add('selected');
        } else {
            const idx = ['same','10less','20less','custom'].indexOf(preset);
            const chips = chipsContainer.querySelectorAll('.ag-chip');
            if (chips[idx]) chips[idx].classList.add('selected');
        }
    }
    const avgNum = avgOverride !== undefined ? avgOverride : (abSelectedCat ? parseInt(abSelectedCat.avg.replace(/[^0-9]/g, '')) : 0);
    const input = document.getElementById('ab-limit-input');
    const info = document.getElementById('ab-limit-info');
    let val, infoHtml;
    switch (preset) {
        case 'same':
            val = avgNum;
            infoHtml = `Same as your $${avgNum} average · Equivalent to <strong style="color:var(--text);">$${Math.round(val / 4.33)}/week</strong>`;
            break;
        case '10less':
            val = Math.round(avgNum * 0.9);
            infoHtml = `10% below your $${avgNum} average · Equivalent to <strong style="color:var(--text);">$${Math.round(val / 4.33)}/week</strong>`;
            break;
        case '20less':
            val = Math.round(avgNum * 0.8);
            infoHtml = `20% below your $${avgNum} average · Equivalent to <strong style="color:var(--text);">$${Math.round(val / 4.33)}/week</strong>`;
            break;
        case 'custom':
            infoHtml = `Enter your own monthly budget above`;
            if (input) { input.focus(); input.select(); }
            break;
    }
    if (input && val !== undefined) input.value = val;
    if (info && infoHtml) info.innerHTML = infoHtml;
    const previewLimit = document.getElementById('ab-preview-limit');
    if (previewLimit && val !== undefined) previewLimit.textContent = `Limit: $${val}/mo`;
}

function abPublish() {
    closeAddBudget();
    const toast = document.createElement('div');
    toast.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:#1a1a2e;border:1px solid rgba(139,126,255,0.4);color:#fff;padding:10px 20px;border-radius:30px;font-size:12px;font-weight:600;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    toast.textContent = '✓ Budget published!';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2500);
}

/* ════════════════════════════════════════════════
   DASHBOARD — SHEET FUNCTIONS
════════════════════════════════════════════════ */
function navigateToPlanBudgets() {
    navigate('plan');
    setTimeout(() => { if (typeof switchPlanTab === 'function') switchPlanTab('budgets'); }, 300);
}

function openProfileSheet() {
    _populateArchetypeProfile();
    document.getElementById('dash-profile-backdrop').classList.add('open');
    document.getElementById('dash-profile-sheet').classList.add('open');
}
function closeProfileSheet() {
    document.getElementById('dash-profile-backdrop').classList.remove('open');
    document.getElementById('dash-profile-sheet').classList.remove('open');
}

function openInsightBreakdown() {
    document.getElementById('dash-insight-backdrop').classList.add('open');
    document.getElementById('dash-insight-sheet').classList.add('open');
}
function closeInsightSheet() {
    document.getElementById('dash-insight-backdrop').classList.remove('open');
    document.getElementById('dash-insight-sheet').classList.remove('open');
}

function openUpcomingAll() {
    document.getElementById('dash-upcoming-backdrop').classList.add('open');
    document.getElementById('dash-upcoming-sheet').classList.add('open');
}
function closeUpcomingSheet() {
    document.getElementById('dash-upcoming-backdrop').classList.remove('open');
    document.getElementById('dash-upcoming-sheet').classList.remove('open');
}

function openSubSheet() {
    document.getElementById('dash-sub-backdrop').classList.add('open');
    document.getElementById('dash-sub-sheet').classList.add('open');
}
function closeSubSheet() {
    document.getElementById('dash-sub-backdrop').classList.remove('open');
    document.getElementById('dash-sub-sheet').classList.remove('open');
}

function toggleSub(id) {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.toggle('off');
}

/* ════════════════════════════════════════════════
   INIT
════════════════════════════════════════════════ */
// Show arrow controls by default (home screen)
document.getElementById('arrow-row').style.display     = 'flex';
document.getElementById('plan-controls').style.display = 'none';
// Cache February grid HTML for month-nav restore
window._febGridHTML = document.getElementById('cal-grid').innerHTML;
</script>
</body>
</html>
